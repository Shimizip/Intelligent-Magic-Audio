<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>I M A (Intelligent Magic Audio): neuronal_network/esp_cubeai_test/Core/Src/audio_classification.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">I M A (Intelligent Magic Audio)
   </div>
   <div id="projectbrief">Audio Sampling Eurorack Module with neuronal based sample classification and intelligent search filtering</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_139b4cd44014659a9dbc10230783e09e.html">neuronal_network</a></li><li class="navelem"><a class="el" href="dir_ec58125193db4ff969d6836460b0ce49.html">esp_cubeai_test</a></li><li class="navelem"><a class="el" href="dir_c806647c6a8efd787aee3fe0d9031776.html">Core</a></li><li class="navelem"><a class="el" href="dir_3c5bba8434eb5ec77804af61cbcdc92b.html">Src</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">audio_classification.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Audio classification implementation for embedded systems via stm32cube.ai (for testing purposes).  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;audio_classification.h&quot;</code><br />
<code>#include &quot;featurescaler.h&quot;</code><br />
<code>#include &lt;math.h&gt;</code><br />
<code>#include &quot;feature_extraction.h&quot;</code><br />
<code>#include &quot;network_1.h&quot;</code><br />
<code>#include &quot;network_1_data.h&quot;</code><br />
<code>#include &quot;network_1_config.h&quot;</code><br />
<code>#include &quot;network_1_data_params.h&quot;</code><br />
<code>#include &quot;utils.h&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:adb2fd0c7b1a7e587cae71795dbe373fd" id="r_adb2fd0c7b1a7e587cae71795dbe373fd"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#adb2fd0c7b1a7e587cae71795dbe373fd">init_nn</a> ()</td></tr>
<tr class="memdesc:adb2fd0c7b1a7e587cae71795dbe373fd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the neural network for audio classification.  <br /></td></tr>
<tr class="separator:adb2fd0c7b1a7e587cae71795dbe373fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32ec07122bc40c96ca43c55ce75a2c28" id="r_a32ec07122bc40c96ca43c55ce75a2c28"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a32ec07122bc40c96ca43c55ce75a2c28">run_nn_classification</a> (ai_float *pSpectrogram, ai_float *classification_result)</td></tr>
<tr class="memdesc:a32ec07122bc40c96ca43c55ce75a2c28"><td class="mdescLeft">&#160;</td><td class="mdescRight">Runs the neural network to classify audio data based on the provided spectrogram.  <br /></td></tr>
<tr class="separator:a32ec07122bc40c96ca43c55ce75a2c28"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a16f618da32af7135f1dffb945d22f94e" id="r_a16f618da32af7135f1dffb945d22f94e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a16f618da32af7135f1dffb945d22f94e">test_call_classification</a> ()</td></tr>
<tr class="memdesc:a16f618da32af7135f1dffb945d22f94e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tests the classification process by simulating the generation and processing of a spectrogram without actually requiring input data. Was used for previous tests.  <br /></td></tr>
<tr class="separator:a16f618da32af7135f1dffb945d22f94e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af914bc6d2d41467a12e3d7aa2febea8a" id="r_af914bc6d2d41467a12e3d7aa2febea8a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af914bc6d2d41467a12e3d7aa2febea8a">Preprocessing_Init</a> (void)</td></tr>
<tr class="memdesc:af914bc6d2d41467a12e3d7aa2febea8a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the mel-spectrogram calculation lib which is part of the audio preprocessing.  <br /></td></tr>
<tr class="separator:af914bc6d2d41467a12e3d7aa2febea8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaefcaf181ee79b12dbc3120610d78ea5" id="r_aaefcaf181ee79b12dbc3120610d78ea5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aaefcaf181ee79b12dbc3120610d78ea5">frame_subsamples</a> (float32_t *subsample)</td></tr>
<tr class="memdesc:aaefcaf181ee79b12dbc3120610d78ea5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Splits an audiosubsample into overlapping frames ready for further processing.  <br /></td></tr>
<tr class="separator:aaefcaf181ee79b12dbc3120610d78ea5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40470456cbea6561d0190bec8cf5ecdd" id="r_a40470456cbea6561d0190bec8cf5ecdd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a40470456cbea6561d0190bec8cf5ecdd">preprocess_frame</a> (float *pFrame)</td></tr>
<tr class="memdesc:a40470456cbea6561d0190bec8cf5ecdd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes a single audio frame and incorporates it into the spectrogram.  <br /></td></tr>
<tr class="separator:a40470456cbea6561d0190bec8cf5ecdd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac4b6da8a976d7d6e0bb32c0eecb98d7b" id="r_ac4b6da8a976d7d6e0bb32c0eecb98d7b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac4b6da8a976d7d6e0bb32c0eecb98d7b">process_subsample</a> (float *pSpectrogram)</td></tr>
<tr class="memdesc:ac4b6da8a976d7d6e0bb32c0eecb98d7b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes a complete spectrogram, runs classification, and measures performance.  <br /></td></tr>
<tr class="separator:ac4b6da8a976d7d6e0bb32c0eecb98d7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6346bd634560cfec3a2cf6a21e99ec42" id="r_a6346bd634560cfec3a2cf6a21e99ec42"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6346bd634560cfec3a2cf6a21e99ec42">PowerToDb</a> (float *pSpectrogram)</td></tr>
<tr class="memdesc:a6346bd634560cfec3a2cf6a21e99ec42"><td class="mdescLeft">&#160;</td><td class="mdescRight">Converts power values in a spectrogram to decibels (dB).  <br /></td></tr>
<tr class="separator:a6346bd634560cfec3a2cf6a21e99ec42"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:acaab4df7cc0db52d6db6dd43a6d355ad" id="r_acaab4df7cc0db52d6db6dd43a6d355ad"><td class="memItemLeft" align="right" valign="top"><a id="acaab4df7cc0db52d6db6dd43a6d355ad" name="acaab4df7cc0db52d6db6dd43a6d355ad"></a>
ai_handle&#160;</td><td class="memItemRight" valign="bottom"><b>network</b></td></tr>
<tr class="memdesc:acaab4df7cc0db52d6db6dd43a6d355ad"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle to the neural network (stm32cube.ai) instance used for audio classification. <br /></td></tr>
<tr class="separator:acaab4df7cc0db52d6db6dd43a6d355ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad77044b96e2a27076019a13bd946f376" id="r_ad77044b96e2a27076019a13bd946f376"><td class="memItemLeft" align="right" valign="top"><a id="ad77044b96e2a27076019a13bd946f376" name="ad77044b96e2a27076019a13bd946f376"></a>
ai_u8&#160;</td><td class="memItemRight" valign="bottom"><b>activations</b> [AI_NETWORK_1_DATA_ACTIVATIONS_SIZE]</td></tr>
<tr class="memdesc:ad77044b96e2a27076019a13bd946f376"><td class="mdescLeft">&#160;</td><td class="mdescRight">Buffer for storing activation data required by stm32cube.ai. <br /></td></tr>
<tr class="separator:ad77044b96e2a27076019a13bd946f376"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b50f4d34c488810a349fcdc358221a6" id="r_a8b50f4d34c488810a349fcdc358221a6"><td class="memItemLeft" align="right" valign="top"><a id="a8b50f4d34c488810a349fcdc358221a6" name="a8b50f4d34c488810a349fcdc358221a6"></a>
ai_buffer *&#160;</td><td class="memItemRight" valign="bottom"><b>ai_input</b></td></tr>
<tr class="memdesc:a8b50f4d34c488810a349fcdc358221a6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pointer to the input buffer of the stm32cube.ai. <br /></td></tr>
<tr class="separator:a8b50f4d34c488810a349fcdc358221a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b53e90f2beb83b673adad35da65d713" id="r_a8b53e90f2beb83b673adad35da65d713"><td class="memItemLeft" align="right" valign="top"><a id="a8b53e90f2beb83b673adad35da65d713" name="a8b53e90f2beb83b673adad35da65d713"></a>
ai_buffer *&#160;</td><td class="memItemRight" valign="bottom"><b>ai_output</b></td></tr>
<tr class="memdesc:a8b53e90f2beb83b673adad35da65d713"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pointer to the output buffer of stm32cube.ai, where classification results are stored. <br /></td></tr>
<tr class="separator:a8b53e90f2beb83b673adad35da65d713"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a503416647290a6138d19561b0b4c0757" id="r_a503416647290a6138d19561b0b4c0757"><td class="memItemLeft" align="right" valign="top"><a id="a503416647290a6138d19561b0b4c0757" name="a503416647290a6138d19561b0b4c0757"></a>
ai_float&#160;</td><td class="memItemRight" valign="bottom"><b>spectrogram</b> [AI_NETWORK_1_IN_1_SIZE]</td></tr>
<tr class="memdesc:a503416647290a6138d19561b0b4c0757"><td class="mdescLeft">&#160;</td><td class="mdescRight">Array to hold the input spectrogram data that feeds into the neural network. <br /></td></tr>
<tr class="separator:a503416647290a6138d19561b0b4c0757"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3bea72754aa19c752200ed543b8709f" id="r_aa3bea72754aa19c752200ed543b8709f"><td class="memItemLeft" align="right" valign="top"><a id="aa3bea72754aa19c752200ed543b8709f" name="aa3bea72754aa19c752200ed543b8709f"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><b>aiOutData</b> [AI_NETWORK_1_OUT_1_SIZE] = {0.0, 0.0, 0.0, 0.0, 0.0}</td></tr>
<tr class="memdesc:aa3bea72754aa19c752200ed543b8709f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Output data from the neural network, containing classification results. <br /></td></tr>
<tr class="separator:aa3bea72754aa19c752200ed543b8709f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a375402b5fe21bff9f8044d0d23a95ee4" id="r_a375402b5fe21bff9f8044d0d23a95ee4"><td class="memItemLeft" align="right" valign="top"><a id="a375402b5fe21bff9f8044d0d23a95ee4" name="a375402b5fe21bff9f8044d0d23a95ee4"></a>
uint32_t&#160;</td><td class="memItemRight" valign="bottom"><b>spectrogram_col_index</b> = 0</td></tr>
<tr class="memdesc:a375402b5fe21bff9f8044d0d23a95ee4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Index to track the current column in the spectrogram buffer during data preprocessing. <br /></td></tr>
<tr class="separator:a375402b5fe21bff9f8044d0d23a95ee4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abaccaa73da8dd7d59fc3d6465440aa1f" id="r_abaccaa73da8dd7d59fc3d6465440aa1f"><td class="memItemLeft" align="right" valign="top"><a id="abaccaa73da8dd7d59fc3d6465440aa1f" name="abaccaa73da8dd7d59fc3d6465440aa1f"></a>
float32_t&#160;</td><td class="memItemRight" valign="bottom"><b>mel_spectrogram_column_buffer</b> [SPECTROGRAM_ROWS]</td></tr>
<tr class="separator:abaccaa73da8dd7d59fc3d6465440aa1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Audio classification implementation for embedded systems via stm32cube.ai (for testing purposes). </p>
<p>This file implements the methods and algorithms required for audio classification using neural networks on embedded systems via stm32cube.ai. It includes initialization and execution of a neural network, preprocessing of audio data to generate spectrograms, and the handling of neural network output.</p>
<dl class="section date"><dt>Date</dt><dd>June 20, 2024 </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Leon Braungardt </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="aaefcaf181ee79b12dbc3120610d78ea5" name="aaefcaf181ee79b12dbc3120610d78ea5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaefcaf181ee79b12dbc3120610d78ea5">&#9670;&#160;</a></span>frame_subsamples()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void frame_subsamples </td>
          <td>(</td>
          <td class="paramtype">float32_t *</td>          <td class="paramname"><span class="paramname"><em>subsample</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Splits an audiosubsample into overlapping frames ready for further processing. </p>
<p>This function segments an audiosubsample into frames 1024 samples with a 512 sample overlap, preparing them for feature extraction (spectrogram calculation). Each frame is extracted based on the hop length and frame length definitions, with zero-padding applied where necessary. The frames are then passed to the <code>preprocess_frame</code> function for following processing steps.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">float32_t*</td><td>subsample Pointer to the array containing the audio subsample data. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="adb2fd0c7b1a7e587cae71795dbe373fd" name="adb2fd0c7b1a7e587cae71795dbe373fd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adb2fd0c7b1a7e587cae71795dbe373fd">&#9670;&#160;</a></span>init_nn()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int init_nn </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the neural network for audio classification. </p>
<p>This function sets up the neural network by creating an instance of the model and initializing it with the required activation buffers. It retrieves the necessary input and output buffers for processing the audio data. Error handling is incorporated to manage potential initialization failures.</p>
<dl class="section return"><dt>Returns</dt><dd>int Returns 0 on successful initialization, or -1 if an error occurs during the network creation or initialization.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>Drived from <a href="https://wiki.st.com/stm32mcu/wiki/AI:How_to_perform_motion_sensing_on_STM32L4_IoTnode#Create_an_STM32Cube-AI_application_using_X-CUBE-AI">https://wiki.st.com/stm32mcu/wiki/AI:How_to_perform_motion_sensing_on_STM32L4_IoTnode#Create_an_STM32Cube-AI_application_using_X-CUBE-AI</a> </dd></dl>

</div>
</div>
<a id="a6346bd634560cfec3a2cf6a21e99ec42" name="a6346bd634560cfec3a2cf6a21e99ec42"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6346bd634560cfec3a2cf6a21e99ec42">&#9670;&#160;</a></span>PowerToDb()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PowerToDb </td>
          <td>(</td>
          <td class="paramtype">float *</td>          <td class="paramname"><span class="paramname"><em>pSpectrogram</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Converts power values in a spectrogram to decibels (dB). </p>
<p>This function scans the spectrogram for the maximum power value to use as a reference for converting all power values to dB scale. It handles special cases where the maximum power is zero (silence) by setting all dB values to -80 dB to avoid division by zero. Values below -80 dB or resulting in NaN are also set to -80 dB to ensure numerical stability.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">float</td><td>*pSpectrogram Pointer to the spectrogram data array. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a40470456cbea6561d0190bec8cf5ecdd" name="a40470456cbea6561d0190bec8cf5ecdd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40470456cbea6561d0190bec8cf5ecdd">&#9670;&#160;</a></span>preprocess_frame()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void preprocess_frame </td>
          <td>(</td>
          <td class="paramtype">float *</td>          <td class="paramname"><span class="paramname"><em>pFrame</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Processes a single audio frame and incorporates it into the spectrogram. </p>
<p>This function takes an audio frame, computes its Mel-scaled spectrogram column, and appends this column to the ongoing spectrogram array. Once the spectrogram is filled with the number of columns determined by SPECTROGRAM_COLS, it triggers the calculation of the spectrogram.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">float*</td><td>pFrame Pointer to the array containing the audio frame data, which is 1024 samples in length.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>This function updates the global <code>spectrogram_col_index</code> to manage the position within the spectrogram array. When the spectrogram array is full, it calls <code>process_subsample</code> to handle the filled spectrogram and resets the index for new data. </dd></dl>

</div>
</div>
<a id="af914bc6d2d41467a12e3d7aa2febea8a" name="af914bc6d2d41467a12e3d7aa2febea8a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af914bc6d2d41467a12e3d7aa2febea8a">&#9670;&#160;</a></span>Preprocessing_Init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Preprocessing_Init </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the mel-spectrogram calculation lib which is part of the audio preprocessing. </p>
<p>This function sets up the components needed for generating Mel spectrograms from audio data.</p>
<dl class="section note"><dt>Note</dt><dd>Derived from the FP-AI-SENSING feature pack: <a href="https://www.st.com/en/embedded-software/fp-ai-sensing1.html">https://www.st.com/en/embedded-software/fp-ai-sensing1.html</a> </dd></dl>

</div>
</div>
<a id="ac4b6da8a976d7d6e0bb32c0eecb98d7b" name="ac4b6da8a976d7d6e0bb32c0eecb98d7b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac4b6da8a976d7d6e0bb32c0eecb98d7b">&#9670;&#160;</a></span>process_subsample()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void process_subsample </td>
          <td>(</td>
          <td class="paramtype">float *</td>          <td class="paramname"><span class="paramname"><em>pSpectrogram</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Processes a complete spectrogram, runs classification, and measures performance. </p>
<p>This function is responsible for converting a power spectrogram into decibel scale, running the neural network to classify the audio data, and measuring the processing time in CPU cycles and milliseconds. It performs a series of operations: conversion of spectrogram values with the predefined scaler (imitating the standardization), neural network classification and performance tracking. The classification results are then contained in aiOutData.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">float*</td><td>pSpectrogram Pointer to the array holding the complete spectrogram data that will be processed and classified. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a32ec07122bc40c96ca43c55ce75a2c28" name="a32ec07122bc40c96ca43c55ce75a2c28"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a32ec07122bc40c96ca43c55ce75a2c28">&#9670;&#160;</a></span>run_nn_classification()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int run_nn_classification </td>
          <td>(</td>
          <td class="paramtype">ai_float *</td>          <td class="paramname"><span class="paramname"><em>pSpectrogram</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ai_float *</td>          <td class="paramname"><span class="paramname"><em>classification_result</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Runs the neural network to classify audio data based on the provided spectrogram. </p>
<p>This function takes a pointer to a spectrogram array, processes it by normalizing with pre-calculated mean and standard deviation values, and then feeds it into the neural network. The output from the neural network is stored in the provided classification_result array.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ai_float*</td><td>pSpectrogram Pointer to the input spectrogram array. </td></tr>
    <tr><td class="paramname">ai_float*</td><td>classification_result Pointer to the array where the neural network's output (classification results) will be stored.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int Returns 0 on successful classification, or -1 if an error occurs during the network run or if the network handle is null. </dd></dl>

</div>
</div>
<a id="a16f618da32af7135f1dffb945d22f94e" name="a16f618da32af7135f1dffb945d22f94e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a16f618da32af7135f1dffb945d22f94e">&#9670;&#160;</a></span>test_call_classification()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void test_call_classification </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Tests the classification process by simulating the generation and processing of a spectrogram without actually requiring input data. Was used for previous tests. </p>
<dl class="section note"><dt>Note</dt><dd>The loop fixed at 32 iterations represents a placeholder for actual Mel spectrogram calculation based on audio input. </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
