<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>I M A (Intelligent Magic Audio): f401_sd_card_audio_codec_test/Core/Src/wavPlayer.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">I M A (Intelligent Magic Audio)
   </div>
   <div id="projectbrief">Audio Sampling Eurorack Module with neuronal based sample classification and intelligent search filtering</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_625273d08e0d1c5e089021868c179bb8.html">f401_sd_card_audio_codec_test</a></li><li class="navelem"><a class="el" href="dir_126587407ce3f01f316e9dab123db759.html">Core</a></li><li class="navelem"><a class="el" href="dir_ead108491b6c2150c9a5c09c884f52f2.html">Src</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">wavPlayer.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Implementation of a WAV player using FATFS and I2S with DMA.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;fatfs.h&quot;</code><br />
<code>#include &quot;<a class="el" href="wavPlayer_8h_source.html">wavPlayer.h</a>&quot;</code><br />
<code>#include &quot;string.h&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a3c131f990069cc240d2afd677a015cc9" id="r_a3c131f990069cc240d2afd677a015cc9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3c131f990069cc240d2afd677a015cc9">initPlayer</a> (<a class="el" href="structWavPlayer.html">WavPlayer</a> *player, FIL *<a class="el" href="f401__display__encoder__fader__test_2Core_2Src_2main_8c.html#a296b3c88b34a2294d0bd990ac963543b">file</a>, <a class="el" href="structwav__header__t.html">wav_header_t</a> *wavHeader)</td></tr>
<tr class="memdesc:a3c131f990069cc240d2afd677a015cc9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes a WAV player with specified file and header.  <br /></td></tr>
<tr class="separator:a3c131f990069cc240d2afd677a015cc9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac04851153a1624b01242f1720208e9f2" id="r_ac04851153a1624b01242f1720208e9f2"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac04851153a1624b01242f1720208e9f2">populateWavHeader</a> (FIL *<a class="el" href="f401__display__encoder__fader__test_2Core_2Src_2main_8c.html#a296b3c88b34a2294d0bd990ac963543b">file</a>, <a class="el" href="structwav__header__t.html">wav_header_t</a> *wavHeader)</td></tr>
<tr class="memdesc:ac04851153a1624b01242f1720208e9f2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads and populates the WAV header from a file.  <br /></td></tr>
<tr class="separator:ac04851153a1624b01242f1720208e9f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7cf4d4f820fce107f3239fc741a56f8c" id="r_a7cf4d4f820fce107f3239fc741a56f8c"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7cf4d4f820fce107f3239fc741a56f8c">checkWav</a> (<a class="el" href="structWavPlayer.html">WavPlayer</a> *player)</td></tr>
<tr class="memdesc:a7cf4d4f820fce107f3239fc741a56f8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Validates the WAV file header for correctness.  <br /></td></tr>
<tr class="separator:a7cf4d4f820fce107f3239fc741a56f8c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9b52876abb4abff5a969b6050b20fbc" id="r_af9b52876abb4abff5a969b6050b20fbc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af9b52876abb4abff5a969b6050b20fbc">playButtonHandler</a> (<a class="el" href="structWavPlayer.html">WavPlayer</a> *player)</td></tr>
<tr class="memdesc:af9b52876abb4abff5a969b6050b20fbc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles the play button action for audio playback.  <br /></td></tr>
<tr class="separator:af9b52876abb4abff5a969b6050b20fbc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81ae4ad2cceb5e50440bee758173922b" id="r_a81ae4ad2cceb5e50440bee758173922b"><td class="memItemLeft" align="right" valign="top">FRESULT&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a81ae4ad2cceb5e50440bee758173922b">wavLoad</a> (<a class="el" href="structWavPlayer.html">WavPlayer</a> *player, const char *filename)</td></tr>
<tr class="memdesc:a81ae4ad2cceb5e50440bee758173922b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Loads a WAV file and validates its header format.  <br /></td></tr>
<tr class="separator:a81ae4ad2cceb5e50440bee758173922b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ef5d87c0f7e4ffb764986329e92ef51" id="r_a7ef5d87c0f7e4ffb764986329e92ef51"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7ef5d87c0f7e4ffb764986329e92ef51">wavPlay</a> (<a class="el" href="structWavPlayer.html">WavPlayer</a> *player)</td></tr>
<tr class="memdesc:a7ef5d87c0f7e4ffb764986329e92ef51"><td class="mdescLeft">&#160;</td><td class="mdescRight">Plays the WAV file from the given <code><a class="el" href="structWavPlayer.html" title="Represents a WAV audio player with playback control and state management.">WavPlayer</a></code>.  <br /></td></tr>
<tr class="separator:a7ef5d87c0f7e4ffb764986329e92ef51"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad05e6abad0601784f005b8b0d4685bad" id="r_ad05e6abad0601784f005b8b0d4685bad"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad05e6abad0601784f005b8b0d4685bad">wavPlayPitched</a> (<a class="el" href="structWavPlayer.html">WavPlayer</a> *player)</td></tr>
<tr class="memdesc:ad05e6abad0601784f005b8b0d4685bad"><td class="mdescLeft">&#160;</td><td class="mdescRight">Plays a WAV file with pitch shifting applied.  <br /></td></tr>
<tr class="separator:ad05e6abad0601784f005b8b0d4685bad"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implementation of a WAV player using FATFS and I2S with DMA. </p>
<p>This file provides functions to:</p><ul>
<li>Initialize the WAV player.</li>
<li>Read and validate WAV file headers.</li>
<li>Handle playback control via button actions.</li>
<li>Load and play WAV files, with optional pitch shifting. </li>
</ul>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a7cf4d4f820fce107f3239fc741a56f8c" name="a7cf4d4f820fce107f3239fc741a56f8c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7cf4d4f820fce107f3239fc741a56f8c">&#9670;&#160;</a></span>checkWav()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t checkWav </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structWavPlayer.html">WavPlayer</a> *</td>          <td class="paramname"><span class="paramname"><em>player</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Validates the WAV file header for correctness. </p>
<p>This function reads the WAV header from the <code><a class="el" href="structWavPlayer.html" title="Represents a WAV audio player with playback control and state management.">WavPlayer</a></code> structure and checks for validity based on key header fields. It verifies the RIFF header and essential "fmt " subchunk to ensure the WAV file conforms to expected formats.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">player</td><td>Pointer to the <code><a class="el" href="structWavPlayer.html" title="Represents a WAV audio player with playback control and state management.">WavPlayer</a></code> structure containing the WAV file and header. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>1</code> if the WAV header is valid, <code>0</code> otherwise. </dd></dl>

</div>
</div>
<a id="a3c131f990069cc240d2afd677a015cc9" name="a3c131f990069cc240d2afd677a015cc9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c131f990069cc240d2afd677a015cc9">&#9670;&#160;</a></span>initPlayer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void initPlayer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structWavPlayer.html">WavPlayer</a> *</td>          <td class="paramname"><span class="paramname"><em>player</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FIL *</td>          <td class="paramname"><span class="paramname"><em>file</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structwav__header__t.html">wav_header_t</a> *</td>          <td class="paramname"><span class="paramname"><em>wavHeader</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes a WAV player with specified file and header. </p>
<p>Sets up the <code><a class="el" href="structWavPlayer.html" title="Represents a WAV audio player with playback control and state management.">WavPlayer</a></code> structure with the given file pointer and WAV header. Initializes playback control flags, header size, and pitch factor to default values.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">player</td><td>Pointer to the <code><a class="el" href="structWavPlayer.html" title="Represents a WAV audio player with playback control and state management.">WavPlayer</a></code> structure to initialize. </td></tr>
    <tr><td class="paramname">file</td><td>Pointer to the <code>FIL</code> object representing the WAV file. </td></tr>
    <tr><td class="paramname">wavHeader</td><td>Pointer to the <code><a class="el" href="structwav__header__t.html" title="Represents the header of a WAV file.">wav_header_t</a></code> structure containing the WAV file header. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="af9b52876abb4abff5a969b6050b20fbc" name="af9b52876abb4abff5a969b6050b20fbc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af9b52876abb4abff5a969b6050b20fbc">&#9670;&#160;</a></span>playButtonHandler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void playButtonHandler </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structWavPlayer.html">WavPlayer</a> *</td>          <td class="paramname"><span class="paramname"><em>player</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles the play button action for audio playback. </p>
<p>This function toggles the playback state of the <code><a class="el" href="structWavPlayer.html" title="Represents a WAV audio player with playback control and state management.">WavPlayer</a></code>. If playback is not active, it sets the <code>playbackActive</code> flag to <code>true</code>. If playback is already active, it sets the <code>restartPlayback</code> flag to <code>true</code> to restart playback.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">player</td><td>Pointer to the <code><a class="el" href="structWavPlayer.html" title="Represents a WAV audio player with playback control and state management.">WavPlayer</a></code> structure managing the audio playback. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ac04851153a1624b01242f1720208e9f2" name="ac04851153a1624b01242f1720208e9f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac04851153a1624b01242f1720208e9f2">&#9670;&#160;</a></span>populateWavHeader()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t populateWavHeader </td>
          <td>(</td>
          <td class="paramtype">FIL *</td>          <td class="paramname"><span class="paramname"><em>file</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structwav__header__t.html">wav_header_t</a> *</td>          <td class="paramname"><span class="paramname"><em>wavHeader</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads and populates the WAV header from a file. </p>
<p>This function reads the WAV file header and fills the provided <code><a class="el" href="structwav__header__t.html" title="Represents the header of a WAV file.">wav_header_t</a></code> structure. It continues reading chunks until it finds the "fmt " subchunk and returns the total size of the WAV header.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file</td><td>Pointer to the <code>FIL</code> object representing the WAV file. </td></tr>
    <tr><td class="paramname">wavHeader</td><td>Pointer to the <code><a class="el" href="structwav__header__t.html" title="Represents the header of a WAV file.">wav_header_t</a></code> structure to be populated with header data. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Size of the WAV header in bytes, or 0 on error. </dd></dl>

</div>
</div>
<a id="a81ae4ad2cceb5e50440bee758173922b" name="a81ae4ad2cceb5e50440bee758173922b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a81ae4ad2cceb5e50440bee758173922b">&#9670;&#160;</a></span>wavLoad()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">FRESULT wavLoad </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structWavPlayer.html">WavPlayer</a> *</td>          <td class="paramname"><span class="paramname"><em>player</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>filename</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Loads a WAV file and validates its header format. </p>
<p>This function opens a WAV file using FATFS, populates the <code><a class="el" href="structwav__header__t.html" title="Represents the header of a WAV file.">wav_header_t</a></code> structure in the <code><a class="el" href="structWavPlayer.html" title="Represents a WAV audio player with playback control and state management.">WavPlayer</a></code>, and checks if the file format is correct. It returns the result of the file opening operation.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">player</td><td>Pointer to the <code><a class="el" href="structWavPlayer.html" title="Represents a WAV audio player with playback control and state management.">WavPlayer</a></code> structure that will be used to manage the WAV file. </td></tr>
    <tr><td class="paramname">filename</td><td>Name of the WAV file to be loaded. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>FR_OK</code> if the file is successfully opened and format is valid, or an error code from FATFS otherwise. </dd></dl>

</div>
</div>
<a id="a7ef5d87c0f7e4ffb764986329e92ef51" name="a7ef5d87c0f7e4ffb764986329e92ef51"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7ef5d87c0f7e4ffb764986329e92ef51">&#9670;&#160;</a></span>wavPlay()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t wavPlay </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structWavPlayer.html">WavPlayer</a> *</td>          <td class="paramname"><span class="paramname"><em>player</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Plays the WAV file from the given <code><a class="el" href="structWavPlayer.html" title="Represents a WAV audio player with playback control and state management.">WavPlayer</a></code>. </p>
<p>This function initializes the DMA stream for I2S transmission, reads data from the WAV file, and plays it through the DAC. It handles playback restarting and manages the remaining bytes of audio data. The function also resets the playback state upon completion.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">player</td><td>Pointer to the <code><a class="el" href="structWavPlayer.html" title="Represents a WAV audio player with playback control and state management.">WavPlayer</a></code> structure containing the WAV file and header. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>0</code> on successful playback completion. Non-zero return values are reserved for error handling. </dd></dl>

</div>
</div>
<a id="ad05e6abad0601784f005b8b0d4685bad" name="ad05e6abad0601784f005b8b0d4685bad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad05e6abad0601784f005b8b0d4685bad">&#9670;&#160;</a></span>wavPlayPitched()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t wavPlayPitched </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structWavPlayer.html">WavPlayer</a> *</td>          <td class="paramname"><span class="paramname"><em>player</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Plays a WAV file with pitch shifting applied. </p>
<p>This function plays a WAV file with pitch adjustment using DMA for I2S transmission. It reads audio data from the file, applies pitch shifting by adjusting the playback speed, and handles playback restarting. The function updates the pitch factor dynamically if changed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">player</td><td>Pointer to the <code><a class="el" href="structWavPlayer.html" title="Represents a WAV audio player with playback control and state management.">WavPlayer</a></code> structure managing the WAV file and playback. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>0</code> on successful playback completion. Non-zero return values are reserved for error handling. </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
