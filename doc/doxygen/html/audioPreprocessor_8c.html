<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>I M A (Intelligent Magic Audio): f401_sd_card_audio_codec_test/Core/Src/audioPreprocessor.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">I M A (Intelligent Magic Audio)
   </div>
   <div id="projectbrief">Audio Sampling Eurorack Module with neuronal based sample classification and intelligent search filtering</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_625273d08e0d1c5e089021868c179bb8.html">f401_sd_card_audio_codec_test</a></li><li class="navelem"><a class="el" href="dir_126587407ce3f01f316e9dab123db759.html">Core</a></li><li class="navelem"><a class="el" href="dir_ead108491b6c2150c9a5c09c884f52f2.html">Src</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">audioPreprocessor.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Audio preprocessing functions for FIR decimation and resampling.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="audioPreprocessor_8h_source.html">audioPreprocessor.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a09c8785a97dca54cfdac46bcb8d1354e" id="r_a09c8785a97dca54cfdac46bcb8d1354e"><td class="memItemLeft" align="right" valign="top"><a id="a09c8785a97dca54cfdac46bcb8d1354e" name="a09c8785a97dca54cfdac46bcb8d1354e"></a>
uint32_t&#160;</td><td class="memItemRight" valign="bottom"><b>DWT_GetCycleCount</b> (void)</td></tr>
<tr class="separator:a09c8785a97dca54cfdac46bcb8d1354e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b4ad63e84db7952f30bf4e0c7d31dfd" id="r_a1b4ad63e84db7952f30bf4e0c7d31dfd"><td class="memItemLeft" align="right" valign="top">arm_status&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1b4ad63e84db7952f30bf4e0c7d31dfd">initFilter</a> ()</td></tr>
<tr class="memdesc:a1b4ad63e84db7952f30bf4e0c7d31dfd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the FIR decimation filter.  <br /></td></tr>
<tr class="separator:a1b4ad63e84db7952f30bf4e0c7d31dfd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f55768903813eb99fb6375c0cbe0bf2" id="r_a4f55768903813eb99fb6375c0cbe0bf2"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4f55768903813eb99fb6375c0cbe0bf2">resampleFile</a> (FIL *inFil, FIL *outFil, <a class="el" href="structwav__header__t.html">wav_header_t</a> *waveHeaderInput, <a class="el" href="structwav__header__t.html">wav_header_t</a> *waveHeaderResampled)</td></tr>
<tr class="memdesc:a4f55768903813eb99fb6375c0cbe0bf2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resamples audio data from an input file and writes to an output file.  <br /></td></tr>
<tr class="separator:a4f55768903813eb99fb6375c0cbe0bf2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a0e70bc477aae30a8eb09466fe12505" id="r_a0a0e70bc477aae30a8eb09466fe12505"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0a0e70bc477aae30a8eb09466fe12505">downsample_Block</a> (int16_t *src, int16_t *dest)</td></tr>
<tr class="memdesc:a0a0e70bc477aae30a8eb09466fe12505"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs downsampling and FIR filtering on a block of audio data.  <br /></td></tr>
<tr class="separator:a0a0e70bc477aae30a8eb09466fe12505"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb523204efdd7bc2de76b58e69823675" id="r_abb523204efdd7bc2de76b58e69823675"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abb523204efdd7bc2de76b58e69823675">get_number_subsamples</a> (FIL *<a class="el" href="f401__display__encoder__fader__test_2Core_2Src_2main_8c.html#a296b3c88b34a2294d0bd990ac963543b">file</a>)</td></tr>
<tr class="memdesc:abb523204efdd7bc2de76b58e69823675"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the number of subsamples based on the WAV file data.  <br /></td></tr>
<tr class="separator:abb523204efdd7bc2de76b58e69823675"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa6af641895199b92a55c307fe0dc9cea" id="r_aa6af641895199b92a55c307fe0dc9cea"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa6af641895199b92a55c307fe0dc9cea">downsample_to_1024_samples</a> (FIL *<a class="el" href="f401__display__encoder__fader__test_2Core_2Src_2main_8c.html#a296b3c88b34a2294d0bd990ac963543b">file</a>, int16_t outChunk[<a class="el" href="audioPreprocessor_8h.html#ad94430c7598dcc3e9342f18554006ec9">NUM_SAMPLES_CHUNK_OUT</a>])</td></tr>
<tr class="memdesc:aa6af641895199b92a55c307fe0dc9cea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Downsamples a chunk of audio data to 1024 samples.  <br /></td></tr>
<tr class="separator:aa6af641895199b92a55c307fe0dc9cea"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a4598f8a5e66e5011c70f5bcf5467c181" id="r_a4598f8a5e66e5011c70f5bcf5467c181"><td class="memItemLeft" align="right" valign="top"><a id="a4598f8a5e66e5011c70f5bcf5467c181" name="a4598f8a5e66e5011c70f5bcf5467c181"></a>
arm_fir_decimate_instance_f32&#160;</td><td class="memItemRight" valign="bottom"><b>FIR_F32_Struct</b></td></tr>
<tr class="separator:a4598f8a5e66e5011c70f5bcf5467c181"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Audio preprocessing functions for FIR decimation and resampling. </p>
<p>Contains functions for initializing FIR decimation filters, resampling audio files, and performing block downsampling of audio data for the neuronal net input. Utilizes the ARM CMSIS DSP library for efficient signal processing. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a0a0e70bc477aae30a8eb09466fe12505" name="a0a0e70bc477aae30a8eb09466fe12505"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a0e70bc477aae30a8eb09466fe12505">&#9670;&#160;</a></span>downsample_Block()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void downsample_Block </td>
          <td>(</td>
          <td class="paramtype">int16_t *</td>          <td class="paramname"><span class="paramname"><em>src</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int16_t *</td>          <td class="paramname"><span class="paramname"><em>dest</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs downsampling and FIR filtering on a block of audio data. </p>
<p>Converts a block of 16-bit integer audio samples to floating-point format, applies FIR filtering and decimation, and then converts the filtered samples back to 16-bit integer format. The processed data is written to the destination buffer.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">src</td><td>Pointer to the source buffer containing 16-bit audio samples to be processed. </td></tr>
    <tr><td class="paramname">dest</td><td>Pointer to the destination buffer where the downsampled 16-bit audio samples will be written. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aa6af641895199b92a55c307fe0dc9cea" name="aa6af641895199b92a55c307fe0dc9cea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa6af641895199b92a55c307fe0dc9cea">&#9670;&#160;</a></span>downsample_to_1024_samples()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t downsample_to_1024_samples </td>
          <td>(</td>
          <td class="paramtype">FIL *</td>          <td class="paramname"><span class="paramname"><em>file</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int16_t</td>          <td class="paramname"><span class="paramname"><em>outChunk</em></span>[NUM_SAMPLES_CHUNK_OUT]&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Downsamples a chunk of audio data to 1024 samples. </p>
<p>Reads a chunk of audio data from the specified file, converts stereo samples to mono, and then performs downsampling. The processed samples are written to the <code>outChunk</code> buffer. The function processes data in blocks and returns the number of downsampled samples. NUM_SAMPLES_CHUNK_OUT * DECIMATION_FACTOR_ROUNDED = NUM_SAMPLES_CHUNK_IN</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file</td><td>Pointer to the input file (<code>FIL</code> structure) containing audio data. </td></tr>
    <tr><td class="paramname">outChunk</td><td>Array to store the downsampled audio samples.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The actual number of samples written to the <code>outChunk</code> buffer. </dd></dl>

</div>
</div>
<a id="abb523204efdd7bc2de76b58e69823675" name="abb523204efdd7bc2de76b58e69823675"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb523204efdd7bc2de76b58e69823675">&#9670;&#160;</a></span>get_number_subsamples()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t get_number_subsamples </td>
          <td>(</td>
          <td class="paramtype">FIL *</td>          <td class="paramname"><span class="paramname"><em>file</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates the number of subsamples based on the WAV file data. </p>
<p>Determines the number of mono subsamples in a WAV file after applying downsampling. It calculates the total number of samples based on the file's audio data size, decimation factor, and header information, then computes the number of frames using the <code>HOP_SIZE</code> and <code>STEP_SIZE</code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file</td><td>Pointer to the WAV file (<code>FIL</code> structure) from which the header information is read.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The number of frames after downsampling, as a <code>uint16_t</code>. </dd></dl>

</div>
</div>
<a id="a1b4ad63e84db7952f30bf4e0c7d31dfd" name="a1b4ad63e84db7952f30bf4e0c7d31dfd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1b4ad63e84db7952f30bf4e0c7d31dfd">&#9670;&#160;</a></span>initFilter()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">arm_status initFilter </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the FIR decimation filter. </p>
<p>Configures the FIR decimation filter using the ARM CMSIS DSP library. Sets up the filter structure with the specified number of taps, decimation factor, filter coefficients, state buffer, and block size.</p>
<dl class="section return"><dt>Returns</dt><dd>Status of the filter initialization (<code>arm_status</code>). </dd></dl>

</div>
</div>
<a id="a4f55768903813eb99fb6375c0cbe0bf2" name="a4f55768903813eb99fb6375c0cbe0bf2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f55768903813eb99fb6375c0cbe0bf2">&#9670;&#160;</a></span>resampleFile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t resampleFile </td>
          <td>(</td>
          <td class="paramtype">FIL *</td>          <td class="paramname"><span class="paramname"><em>inFil</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FIL *</td>          <td class="paramname"><span class="paramname"><em>outFil</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structwav__header__t.html">wav_header_t</a> *</td>          <td class="paramname"><span class="paramname"><em>waveHeaderInput</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structwav__header__t.html">wav_header_t</a> *</td>          <td class="paramname"><span class="paramname"><em>waveHeaderResampled</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Resamples audio data from an input file and writes to an output file. </p>
<p>Reads chunks of audio data from the input file, performs downsampling and resampling, and writes the processed data to the output file. Updates the WAV header of the output file to reflect the new format after resampling.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">inFil</td><td>Pointer to the input file (<code>FIL</code> structure) containing original audio data. </td></tr>
    <tr><td class="paramname">outFil</td><td>Pointer to the output file (<code>FIL</code> structure) to write resampled audio data. </td></tr>
    <tr><td class="paramname">waveHeaderInput</td><td>Pointer to the WAV header of the input file. </td></tr>
    <tr><td class="paramname">waveHeaderResampled</td><td>Pointer to the WAV header to be written to the output file.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The number of bytes written to the resampled file. </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
