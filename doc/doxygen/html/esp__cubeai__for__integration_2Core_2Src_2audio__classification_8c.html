<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>I M A (Intelligent Magic Audio): neuronal_network/esp_cubeai_for_integration/Core/Src/audio_classification.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">I M A (Intelligent Magic Audio)
   </div>
   <div id="projectbrief">Audio Sampling Eurorack Module with neuronal based sample classification and intelligent search filtering</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_139b4cd44014659a9dbc10230783e09e.html">neuronal_network</a></li><li class="navelem"><a class="el" href="dir_bcefc1e81a7cc033cbc5d642d4aeed50.html">esp_cubeai_for_integration</a></li><li class="navelem"><a class="el" href="dir_a68cbbf034eb55f891e29f96713832c3.html">Core</a></li><li class="navelem"><a class="el" href="dir_74462fc7ff83516999984d543b8ec1fb.html">Src</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">audio_classification.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Audio classification implementation for embedded systems via stm32cube.ai (for integration into the system). Everything is untested!  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;audio_classification.h&quot;</code><br />
<code>#include &lt;math.h&gt;</code><br />
<code>#include &quot;feature_extraction.h&quot;</code><br />
<code>#include &quot;network_1.h&quot;</code><br />
<code>#include &quot;network_1_data.h&quot;</code><br />
<code>#include &quot;network_1_config.h&quot;</code><br />
<code>#include &quot;network_1_data_params.h&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:adb2fd0c7b1a7e587cae71795dbe373fd" id="r_adb2fd0c7b1a7e587cae71795dbe373fd"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#adb2fd0c7b1a7e587cae71795dbe373fd">init_nn</a> ()</td></tr>
<tr class="memdesc:adb2fd0c7b1a7e587cae71795dbe373fd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the neural network for audio classification.  <br /></td></tr>
<tr class="separator:adb2fd0c7b1a7e587cae71795dbe373fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40483ac3257ee8a4b986fd6ff6fb8b1c" id="r_a40483ac3257ee8a4b986fd6ff6fb8b1c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a40483ac3257ee8a4b986fd6ff6fb8b1c">de_init_nn</a> ()</td></tr>
<tr class="memdesc:a40483ac3257ee8a4b986fd6ff6fb8b1c"><td class="mdescLeft">&#160;</td><td class="mdescRight">De-initializes the neural network and disables necessary hardware configurations.  <br /></td></tr>
<tr class="separator:a40483ac3257ee8a4b986fd6ff6fb8b1c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32ec07122bc40c96ca43c55ce75a2c28" id="r_a32ec07122bc40c96ca43c55ce75a2c28"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a32ec07122bc40c96ca43c55ce75a2c28">run_nn_classification</a> (ai_float *pSpectrogram, ai_float *classification_result)</td></tr>
<tr class="memdesc:a32ec07122bc40c96ca43c55ce75a2c28"><td class="mdescLeft">&#160;</td><td class="mdescRight">Runs the neural network to classify audio data based on the provided spectrogram.  <br /></td></tr>
<tr class="separator:a32ec07122bc40c96ca43c55ce75a2c28"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0421a114e64f016885a043c9a5ea49ca" id="r_a0421a114e64f016885a043c9a5ea49ca"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0421a114e64f016885a043c9a5ea49ca">spectrogram_generation_init</a> (void)</td></tr>
<tr class="memdesc:a0421a114e64f016885a043c9a5ea49ca"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the mel-spectrogram calculation lib which is part of the audio preprocessing.  <br /></td></tr>
<tr class="separator:a0421a114e64f016885a043c9a5ea49ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab353c6864a0e779783dafdc415a356bb" id="r_ab353c6864a0e779783dafdc415a356bb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab353c6864a0e779783dafdc415a356bb">classify_file</a> (FIL *fil, char *file_name)</td></tr>
<tr class="memdesc:ab353c6864a0e779783dafdc415a356bb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Classifies audio data from a single file using a neural network.  <br /></td></tr>
<tr class="separator:ab353c6864a0e779783dafdc415a356bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a26571aa118be866db187b4e41ac99559" id="r_a26571aa118be866db187b4e41ac99559"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a26571aa118be866db187b4e41ac99559">calculate_spectrogram_column</a> (float *pFrame, int col_index)</td></tr>
<tr class="memdesc:a26571aa118be866db187b4e41ac99559"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generates a Mel-scaled spectrogram column from a frame (1024 samples) and inserts it into a spectrogram array.  <br /></td></tr>
<tr class="separator:a26571aa118be866db187b4e41ac99559"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e249478d750eacf9d22e5605bb7225d" id="r_a8e249478d750eacf9d22e5605bb7225d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8e249478d750eacf9d22e5605bb7225d">spectrogram_power_to_db</a> (float *pSpectrogram)</td></tr>
<tr class="memdesc:a8e249478d750eacf9d22e5605bb7225d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Converts power values in a spectrogram to decibels (dB).  <br /></td></tr>
<tr class="separator:a8e249478d750eacf9d22e5605bb7225d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b90c348ba72a00ce37282328444d907" id="r_a7b90c348ba72a00ce37282328444d907"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7b90c348ba72a00ce37282328444d907">calculate_total_classification_result</a> (float *total_file_classification_result, float classification_results_subsamples[][AI_NETWORK_1_OUT_1_SIZE], int number_subsamples_in_file)</td></tr>
<tr class="memdesc:a7b90c348ba72a00ce37282328444d907"><td class="mdescLeft">&#160;</td><td class="mdescRight">Aggregates classification results from subsamples into a total result.  <br /></td></tr>
<tr class="separator:a7b90c348ba72a00ce37282328444d907"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf1303bfdc898203ebb6bb0bee0870ff" id="r_aaf1303bfdc898203ebb6bb0bee0870ff"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aaf1303bfdc898203ebb6bb0bee0870ff">store_classification_result</a> (FIL *fil, char *file_name, float *classification_result)</td></tr>
<tr class="memdesc:aaf1303bfdc898203ebb6bb0bee0870ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stores the classification results into struct saved to a file.  <br /></td></tr>
<tr class="separator:aaf1303bfdc898203ebb6bb0bee0870ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:acaab4df7cc0db52d6db6dd43a6d355ad" id="r_acaab4df7cc0db52d6db6dd43a6d355ad"><td class="memItemLeft" align="right" valign="top"><a id="acaab4df7cc0db52d6db6dd43a6d355ad" name="acaab4df7cc0db52d6db6dd43a6d355ad"></a>
ai_handle&#160;</td><td class="memItemRight" valign="bottom"><b>network</b></td></tr>
<tr class="memdesc:acaab4df7cc0db52d6db6dd43a6d355ad"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle to the neural network (stm32cube.ai) instance used for audio classification. <br /></td></tr>
<tr class="separator:acaab4df7cc0db52d6db6dd43a6d355ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad77044b96e2a27076019a13bd946f376" id="r_ad77044b96e2a27076019a13bd946f376"><td class="memItemLeft" align="right" valign="top"><a id="ad77044b96e2a27076019a13bd946f376" name="ad77044b96e2a27076019a13bd946f376"></a>
ai_u8&#160;</td><td class="memItemRight" valign="bottom"><b>activations</b> [AI_NETWORK_1_DATA_ACTIVATIONS_SIZE]</td></tr>
<tr class="memdesc:ad77044b96e2a27076019a13bd946f376"><td class="mdescLeft">&#160;</td><td class="mdescRight">Buffer for storing activation data required by stm32cube.ai. <br /></td></tr>
<tr class="separator:ad77044b96e2a27076019a13bd946f376"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b50f4d34c488810a349fcdc358221a6" id="r_a8b50f4d34c488810a349fcdc358221a6"><td class="memItemLeft" align="right" valign="top"><a id="a8b50f4d34c488810a349fcdc358221a6" name="a8b50f4d34c488810a349fcdc358221a6"></a>
ai_buffer *&#160;</td><td class="memItemRight" valign="bottom"><b>ai_input</b></td></tr>
<tr class="memdesc:a8b50f4d34c488810a349fcdc358221a6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pointer to the input buffer of the stm32cube.ai. <br /></td></tr>
<tr class="separator:a8b50f4d34c488810a349fcdc358221a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b53e90f2beb83b673adad35da65d713" id="r_a8b53e90f2beb83b673adad35da65d713"><td class="memItemLeft" align="right" valign="top"><a id="a8b53e90f2beb83b673adad35da65d713" name="a8b53e90f2beb83b673adad35da65d713"></a>
ai_buffer *&#160;</td><td class="memItemRight" valign="bottom"><b>ai_output</b></td></tr>
<tr class="memdesc:a8b53e90f2beb83b673adad35da65d713"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pointer to the output buffer of stm32cube.ai, where classification results are stored. <br /></td></tr>
<tr class="separator:a8b53e90f2beb83b673adad35da65d713"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a503416647290a6138d19561b0b4c0757" id="r_a503416647290a6138d19561b0b4c0757"><td class="memItemLeft" align="right" valign="top"><a id="a503416647290a6138d19561b0b4c0757" name="a503416647290a6138d19561b0b4c0757"></a>
ai_float&#160;</td><td class="memItemRight" valign="bottom"><b>spectrogram</b> [AI_NETWORK_1_IN_1_SIZE]</td></tr>
<tr class="memdesc:a503416647290a6138d19561b0b4c0757"><td class="mdescLeft">&#160;</td><td class="mdescRight">Array to hold the input spectrogram data that feeds into the neural network. <br /></td></tr>
<tr class="separator:a503416647290a6138d19561b0b4c0757"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3bea72754aa19c752200ed543b8709f" id="r_aa3bea72754aa19c752200ed543b8709f"><td class="memItemLeft" align="right" valign="top"><a id="aa3bea72754aa19c752200ed543b8709f" name="aa3bea72754aa19c752200ed543b8709f"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><b>aiOutData</b> [AI_NETWORK_1_OUT_1_SIZE] = {0.0, 0.0, 0.0, 0.0, 0.0}</td></tr>
<tr class="memdesc:aa3bea72754aa19c752200ed543b8709f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Output data from the neural network, containing classification results. <br /></td></tr>
<tr class="separator:aa3bea72754aa19c752200ed543b8709f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a936fcc9e9022ff72e207fdd1b44ecfa5" id="r_a936fcc9e9022ff72e207fdd1b44ecfa5"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a936fcc9e9022ff72e207fdd1b44ecfa5">aiOutDataLabels</a> [AI_NETWORK_1_OUT_1_SIZE][10]</td></tr>
<tr class="memdesc:a936fcc9e9022ff72e207fdd1b44ecfa5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Labels for the classification outputs of the neural network.  <br /></td></tr>
<tr class="separator:a936fcc9e9022ff72e207fdd1b44ecfa5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abaccaa73da8dd7d59fc3d6465440aa1f" id="r_abaccaa73da8dd7d59fc3d6465440aa1f"><td class="memItemLeft" align="right" valign="top"><a id="abaccaa73da8dd7d59fc3d6465440aa1f" name="abaccaa73da8dd7d59fc3d6465440aa1f"></a>
float32_t&#160;</td><td class="memItemRight" valign="bottom"><b>mel_spectrogram_column_buffer</b> [SPECTROGRAM_ROWS]</td></tr>
<tr class="memdesc:abaccaa73da8dd7d59fc3d6465440aa1f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Buffer to store a single column of the Mel spectrogram during preprocessing. <br /></td></tr>
<tr class="separator:abaccaa73da8dd7d59fc3d6465440aa1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Audio classification implementation for embedded systems via stm32cube.ai (for integration into the system). Everything is untested! </p>
<p>This file includes the complete integration of audio classification functions tailored for an embedded environment using STM32 hardware. It covers the initialization and de-initialization of neural network components, the generation and processing of spectrograms from audio data, classification of these spectrograms, and the handling of classification results. The code supports operations on audio data that involve feature scaling, neural network inference, and post-processing to interpret the network's output.</p>
<p>Functions in this file demonstrate the full pipeline from reading raw audio data, converting it into Mel-spectrogram columns, classifying these spectrograms using a pre-trained neural network, and storing the results.</p>
<dl class="section date"><dt>Date</dt><dd>June 20, 2024 </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Leon Braungardt </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a26571aa118be866db187b4e41ac99559" name="a26571aa118be866db187b4e41ac99559"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a26571aa118be866db187b4e41ac99559">&#9670;&#160;</a></span>calculate_spectrogram_column()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void calculate_spectrogram_column </td>
          <td>(</td>
          <td class="paramtype">float *</td>          <td class="paramname"><span class="paramname"><em>pFrame</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>col_index</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Generates a Mel-scaled spectrogram column from a frame (1024 samples) and inserts it into a spectrogram array. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">float*</td><td>pFrame Pointer to the audio frame. </td></tr>
    <tr><td class="paramname">int</td><td>col_index Index at which the spectrogram column will be inserted into the main spectrogram array. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a7b90c348ba72a00ce37282328444d907" name="a7b90c348ba72a00ce37282328444d907"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7b90c348ba72a00ce37282328444d907">&#9670;&#160;</a></span>calculate_total_classification_result()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void calculate_total_classification_result </td>
          <td>(</td>
          <td class="paramtype">float *</td>          <td class="paramname"><span class="paramname"><em>total_file_classification_result</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>classification_results_subsamples</em></span>[][AI_NETWORK_1_OUT_1_SIZE], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>number_subsamples_in_file</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Aggregates classification results from subsamples into a total result. </p>
<p>This function calculates the total classification results by summing and then averaging the results of individual subsamples.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">float*</td><td>total_file_classification_result Array to store the final averaged classification results. </td></tr>
    <tr><td class="paramname">float</td><td>classification_results_subsamples[][AI_NETWORK_1_OUT_1_SIZE] Two-dimensional array containing classification results for each subsample. </td></tr>
    <tr><td class="paramname">int</td><td>number_subsamples_in_file The total number of subsamples processed, used for averaging. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ab353c6864a0e779783dafdc415a356bb" name="ab353c6864a0e779783dafdc415a356bb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab353c6864a0e779783dafdc415a356bb">&#9670;&#160;</a></span>classify_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void classify_file </td>
          <td>(</td>
          <td class="paramtype">FIL *</td>          <td class="paramname"><span class="paramname"><em>fil</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>file_name</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Classifies audio data from a single file using a neural network. </p>
<p>This function processes an audio file and splits it into audiosubsamples. It handles reading data from the file, generating spectrogram columns, converting them to dB, running neural network classifications, and aggregating the results. The entire classification result for the file is stored afterwards.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">FIL</td><td>*fil Pointer to the file on the SD card. </td></tr>
    <tr><td class="paramname">char*</td><td>file_name Name of the file being classified, used for storing results. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a40483ac3257ee8a4b986fd6ff6fb8b1c" name="a40483ac3257ee8a4b986fd6ff6fb8b1c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40483ac3257ee8a4b986fd6ff6fb8b1c">&#9670;&#160;</a></span>de_init_nn()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int de_init_nn </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>De-initializes the neural network and disables necessary hardware configurations. </p>
<p>This function is responsible for safely shutting down the neural network instance by destroying it and deallocating any associated resources. Additionally, it disables the CRC (Cyclic Redundancy Check) clock used by the STM32Cube.AI library.</p>
<dl class="section return"><dt>Returns</dt><dd>int Returns 0 on successful de-initialization or -1 if an error occurs during the destruction of the neural network. </dd></dl>

</div>
</div>
<a id="adb2fd0c7b1a7e587cae71795dbe373fd" name="adb2fd0c7b1a7e587cae71795dbe373fd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adb2fd0c7b1a7e587cae71795dbe373fd">&#9670;&#160;</a></span>init_nn()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int init_nn </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the neural network for audio classification. </p>
<p>This function sets up the neural network by creating an instance of the model and initializing it with the required activation buffers. It retrieves the necessary input and output buffers for processing the audio data. Error handling is incorporated to manage potential initialization failures.</p>
<dl class="section return"><dt>Returns</dt><dd>int Returns 0 on successful initialization, or -1 if an error occurs during the network creation or initialization.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>Drived from <a href="https://wiki.st.com/stm32mcu/wiki/AI:How_to_perform_motion_sensing_on_STM32L4_IoTnode#Create_an_STM32Cube-AI_application_using_X-CUBE-AI">https://wiki.st.com/stm32mcu/wiki/AI:How_to_perform_motion_sensing_on_STM32L4_IoTnode#Create_an_STM32Cube-AI_application_using_X-CUBE-AI</a> </dd></dl>

</div>
</div>
<a id="a32ec07122bc40c96ca43c55ce75a2c28" name="a32ec07122bc40c96ca43c55ce75a2c28"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a32ec07122bc40c96ca43c55ce75a2c28">&#9670;&#160;</a></span>run_nn_classification()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int run_nn_classification </td>
          <td>(</td>
          <td class="paramtype">ai_float *</td>          <td class="paramname"><span class="paramname"><em>pSpectrogram</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ai_float *</td>          <td class="paramname"><span class="paramname"><em>classification_result</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Runs the neural network to classify audio data based on the provided spectrogram. </p>
<p>This function takes a pointer to a spectrogram array, processes it by normalizing with pre-calculated mean and standard deviation values, and then feeds it into the neural network. The output from the neural network is stored in the provided classification_result array.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ai_float*</td><td>pSpectrogram Pointer to the input spectrogram array. </td></tr>
    <tr><td class="paramname">ai_float*</td><td>classification_result Pointer to the array where the neural network's output (classification results) will be stored.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int Returns 0 on successful classification, or -1 if an error occurs during the network run or if the network handle is null. </dd></dl>

</div>
</div>
<a id="a0421a114e64f016885a043c9a5ea49ca" name="a0421a114e64f016885a043c9a5ea49ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0421a114e64f016885a043c9a5ea49ca">&#9670;&#160;</a></span>spectrogram_generation_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void spectrogram_generation_init </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the mel-spectrogram calculation lib which is part of the audio preprocessing. </p>
<p>This function sets up the components needed for generating Mel spectrograms from audio data.</p>
<dl class="section note"><dt>Note</dt><dd>Derived from the FP-AI-SENSING feature pack: <a href="https://www.st.com/en/embedded-software/fp-ai-sensing1.html">https://www.st.com/en/embedded-software/fp-ai-sensing1.html</a> </dd></dl>

</div>
</div>
<a id="a8e249478d750eacf9d22e5605bb7225d" name="a8e249478d750eacf9d22e5605bb7225d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e249478d750eacf9d22e5605bb7225d">&#9670;&#160;</a></span>spectrogram_power_to_db()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void spectrogram_power_to_db </td>
          <td>(</td>
          <td class="paramtype">float *</td>          <td class="paramname"><span class="paramname"><em>pSpectrogram</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Converts power values in a spectrogram to decibels (dB). </p>
<p>This function scans the spectrogram for the maximum power value to use as a reference for converting all power values to dB scale. It handles special cases where the maximum power is zero (silence) by setting all dB values to -80 dB to avoid division by zero. Values below -80 dB or resulting in NaN are also set to -80 dB to ensure numerical stability.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">float</td><td>*pSpectrogram Pointer to the spectrogram data array. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aaf1303bfdc898203ebb6bb0bee0870ff" name="aaf1303bfdc898203ebb6bb0bee0870ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf1303bfdc898203ebb6bb0bee0870ff">&#9670;&#160;</a></span>store_classification_result()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void store_classification_result </td>
          <td>(</td>
          <td class="paramtype">FIL *</td>          <td class="paramname"><span class="paramname"><em>fil</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>file_name</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *</td>          <td class="paramname"><span class="paramname"><em>classification_result</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stores the classification results into struct saved to a file. </p>
<p>This function is intended to write the classification results for an audiosample to the file containing the struct with all classification results as an object.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">FIL</td><td>*fil Pointer to the file structure representing the file containing the struct (with all classification results) as an object. </td></tr>
    <tr><td class="paramname">char*</td><td>file_name Name of the file where the classification results will be stored. </td></tr>
    <tr><td class="paramname">float*</td><td>classification_result Array containing the neural network's classification results to be stored.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Unfortunately, this function was not implemented due to the full system integration never happening because the project reached its time limit. </dd></dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a936fcc9e9022ff72e207fdd1b44ecfa5" name="a936fcc9e9022ff72e207fdd1b44ecfa5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a936fcc9e9022ff72e207fdd1b44ecfa5">&#9670;&#160;</a></span>aiOutDataLabels</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char aiOutDataLabels[AI_NETWORK_1_OUT_1_SIZE][10]</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div>
<div class="line">        <span class="stringliteral">&quot;bass&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;pitched&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;sustained&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;rhythmic&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;melodic&quot;</span></div>
<div class="line">}</div>
</div><!-- fragment -->
<p>Labels for the classification outputs of the neural network. </p>
<p>This array stores string labels corresponding to the classification categories of the neural network outputs. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
