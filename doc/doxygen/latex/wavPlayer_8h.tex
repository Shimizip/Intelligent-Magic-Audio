\doxysection{f401\+\_\+sd\+\_\+card\+\_\+audio\+\_\+codec\+\_\+test/\+Core/\+Inc/wav\+Player.h File Reference}
\hypertarget{wavPlayer_8h}{}\label{wavPlayer_8h}\index{f401\_sd\_card\_audio\_codec\_test/Core/Inc/wavPlayer.h@{f401\_sd\_card\_audio\_codec\_test/Core/Inc/wavPlayer.h}}


Header file for WAV audio player functionality.  


{\ttfamily \#include $<$stdint.\+h$>$}\newline
{\ttfamily \#include "{}fatfs.\+h"{}}\newline
{\ttfamily \#include "{}audio.\+h"{}}\newline
\doxysubsubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structwav__header__t}{wav\+\_\+header\+\_\+t}}
\begin{DoxyCompactList}\small\item\em Represents the header of a WAV file. \end{DoxyCompactList}\item 
struct \mbox{\hyperlink{structWavPlayer}{Wav\+Player}}
\begin{DoxyCompactList}\small\item\em Represents a WAV audio player with playback control and state management. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef struct wav\+\_\+header\+\_\+t \mbox{\hyperlink{wavPlayer_8h_a5cbb7563ccf1966ae8225f012fde8bdb}{wav\+\_\+header\+\_\+t}}
\begin{DoxyCompactList}\small\item\em Represents the header of a WAV file. \end{DoxyCompactList}\item 
typedef struct Wav\+Player \mbox{\hyperlink{wavPlayer_8h_abb05621f887c2ffce5b03a93be9f56dd}{Wav\+Player}}
\begin{DoxyCompactList}\small\item\em Represents a WAV audio player with playback control and state management. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{wavPlayer_8h_a3c131f990069cc240d2afd677a015cc9}{init\+Player}} (\mbox{\hyperlink{structWavPlayer}{Wav\+Player}} \texorpdfstring{$\ast$}{*}player, FIL \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{f401__display__encoder__fader__test_2Core_2Src_2main_8c_a296b3c88b34a2294d0bd990ac963543b}{file}}, \mbox{\hyperlink{structwav__header__t}{wav\+\_\+header\+\_\+t}} \texorpdfstring{$\ast$}{*}wav\+Header)
\begin{DoxyCompactList}\small\item\em Initializes a WAV player with specified file and header. \end{DoxyCompactList}\item 
FRESULT \mbox{\hyperlink{wavPlayer_8h_a81ae4ad2cceb5e50440bee758173922b}{wav\+Load}} (\mbox{\hyperlink{structWavPlayer}{Wav\+Player}} \texorpdfstring{$\ast$}{*}player, const char \texorpdfstring{$\ast$}{*}filename)
\begin{DoxyCompactList}\small\item\em Loads a WAV file and validates its header format. \end{DoxyCompactList}\item 
uint32\+\_\+t \mbox{\hyperlink{wavPlayer_8h_ac04851153a1624b01242f1720208e9f2}{populate\+Wav\+Header}} (FIL \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{f401__display__encoder__fader__test_2Core_2Src_2main_8c_a296b3c88b34a2294d0bd990ac963543b}{file}}, \mbox{\hyperlink{structwav__header__t}{wav\+\_\+header\+\_\+t}} \texorpdfstring{$\ast$}{*}wav\+Header)
\begin{DoxyCompactList}\small\item\em Reads and populates the WAV header from a file. \end{DoxyCompactList}\item 
uint8\+\_\+t \mbox{\hyperlink{wavPlayer_8h_a7cf4d4f820fce107f3239fc741a56f8c}{check\+Wav}} (\mbox{\hyperlink{structWavPlayer}{Wav\+Player}} \texorpdfstring{$\ast$}{*}player)
\begin{DoxyCompactList}\small\item\em Validates the WAV file header for correctness. \end{DoxyCompactList}\item 
uint8\+\_\+t \mbox{\hyperlink{wavPlayer_8h_a7ef5d87c0f7e4ffb764986329e92ef51}{wav\+Play}} (\mbox{\hyperlink{structWavPlayer}{Wav\+Player}} \texorpdfstring{$\ast$}{*}player)
\begin{DoxyCompactList}\small\item\em Plays the WAV file from the given {\ttfamily \doxylink{structWavPlayer}{Wav\+Player}}. \end{DoxyCompactList}\item 
uint8\+\_\+t \mbox{\hyperlink{wavPlayer_8h_ad05e6abad0601784f005b8b0d4685bad}{wav\+Play\+Pitched}} (\mbox{\hyperlink{structWavPlayer}{Wav\+Player}} \texorpdfstring{$\ast$}{*}player)
\begin{DoxyCompactList}\small\item\em Plays a WAV file with pitch shifting applied. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{wavPlayer_8h_af9b52876abb4abff5a969b6050b20fbc}{play\+Button\+Handler}} (\mbox{\hyperlink{structWavPlayer}{Wav\+Player}} \texorpdfstring{$\ast$}{*}player)
\begin{DoxyCompactList}\small\item\em Handles the play button action for audio playback. \end{DoxyCompactList}\item 
\Hypertarget{wavPlayer_8h_a9c619e408edf0c9826498861855895c8}\label{wavPlayer_8h_a9c619e408edf0c9826498861855895c8} 
void {\bfseries wav\+Stop} (void)
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Header file for WAV audio player functionality. 

Defines the structures and function prototypes for handling WAV file playback. 

\doxysubsection{Typedef Documentation}
\Hypertarget{wavPlayer_8h_a5cbb7563ccf1966ae8225f012fde8bdb}\index{wavPlayer.h@{wavPlayer.h}!wav\_header\_t@{wav\_header\_t}}
\index{wav\_header\_t@{wav\_header\_t}!wavPlayer.h@{wavPlayer.h}}
\doxysubsubsection{\texorpdfstring{wav\_header\_t}{wav\_header\_t}}
{\footnotesize\ttfamily \label{wavPlayer_8h_a5cbb7563ccf1966ae8225f012fde8bdb} 
typedef struct wav\+\_\+header\+\_\+t wav\+\_\+header\+\_\+t}



Represents the header of a WAV file. 

This structure defines the layout of the WAV file header, which includes information about the RIFF chunk, format details, and the data chunk. It provides essential metadata for interpreting the WAV file\textquotesingle{}s audio data. \Hypertarget{wavPlayer_8h_abb05621f887c2ffce5b03a93be9f56dd}\index{wavPlayer.h@{wavPlayer.h}!WavPlayer@{WavPlayer}}
\index{WavPlayer@{WavPlayer}!wavPlayer.h@{wavPlayer.h}}
\doxysubsubsection{\texorpdfstring{WavPlayer}{WavPlayer}}
{\footnotesize\ttfamily \label{wavPlayer_8h_abb05621f887c2ffce5b03a93be9f56dd} 
typedef struct Wav\+Player Wav\+Player}



Represents a WAV audio player with playback control and state management. 

This structure contains information and control flags related to WAV audio playback, including file handling, playback status, and pitch adjustment. 

\doxysubsection{Function Documentation}
\Hypertarget{wavPlayer_8h_a7cf4d4f820fce107f3239fc741a56f8c}\index{wavPlayer.h@{wavPlayer.h}!checkWav@{checkWav}}
\index{checkWav@{checkWav}!wavPlayer.h@{wavPlayer.h}}
\doxysubsubsection{\texorpdfstring{checkWav()}{checkWav()}}
{\footnotesize\ttfamily \label{wavPlayer_8h_a7cf4d4f820fce107f3239fc741a56f8c} 
uint8\+\_\+t check\+Wav (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structWavPlayer}{Wav\+Player}} \texorpdfstring{$\ast$}{*}}]{player}{}\end{DoxyParamCaption})}



Validates the WAV file header for correctness. 

This function reads the WAV header from the {\ttfamily \doxylink{structWavPlayer}{Wav\+Player}} structure and checks for validity based on key header fields. It verifies the RIFF header and essential "{}fmt "{} subchunk to ensure the WAV file conforms to expected formats.


\begin{DoxyParams}{Parameters}
{\em player} & Pointer to the {\ttfamily \doxylink{structWavPlayer}{Wav\+Player}} structure containing the WAV file and header. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
{\ttfamily 1} if the WAV header is valid, {\ttfamily 0} otherwise. 
\end{DoxyReturn}
\Hypertarget{wavPlayer_8h_a3c131f990069cc240d2afd677a015cc9}\index{wavPlayer.h@{wavPlayer.h}!initPlayer@{initPlayer}}
\index{initPlayer@{initPlayer}!wavPlayer.h@{wavPlayer.h}}
\doxysubsubsection{\texorpdfstring{initPlayer()}{initPlayer()}}
{\footnotesize\ttfamily \label{wavPlayer_8h_a3c131f990069cc240d2afd677a015cc9} 
void init\+Player (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structWavPlayer}{Wav\+Player}} \texorpdfstring{$\ast$}{*}}]{player}{, }\item[{FIL \texorpdfstring{$\ast$}{*}}]{file}{, }\item[{\mbox{\hyperlink{structwav__header__t}{wav\+\_\+header\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{wav\+Header}{}\end{DoxyParamCaption})}



Initializes a WAV player with specified file and header. 

Sets up the {\ttfamily \doxylink{structWavPlayer}{Wav\+Player}} structure with the given file pointer and WAV header. Initializes playback control flags, header size, and pitch factor to default values.


\begin{DoxyParams}{Parameters}
{\em player} & Pointer to the {\ttfamily \doxylink{structWavPlayer}{Wav\+Player}} structure to initialize. \\
\hline
{\em file} & Pointer to the {\ttfamily FIL} object representing the WAV file. \\
\hline
{\em wav\+Header} & Pointer to the {\ttfamily \doxylink{structwav__header__t}{wav\+\_\+header\+\_\+t}} structure containing the WAV file header. \\
\hline
\end{DoxyParams}
\Hypertarget{wavPlayer_8h_af9b52876abb4abff5a969b6050b20fbc}\index{wavPlayer.h@{wavPlayer.h}!playButtonHandler@{playButtonHandler}}
\index{playButtonHandler@{playButtonHandler}!wavPlayer.h@{wavPlayer.h}}
\doxysubsubsection{\texorpdfstring{playButtonHandler()}{playButtonHandler()}}
{\footnotesize\ttfamily \label{wavPlayer_8h_af9b52876abb4abff5a969b6050b20fbc} 
void play\+Button\+Handler (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structWavPlayer}{Wav\+Player}} \texorpdfstring{$\ast$}{*}}]{player}{}\end{DoxyParamCaption})}



Handles the play button action for audio playback. 

This function toggles the playback state of the {\ttfamily \doxylink{structWavPlayer}{Wav\+Player}}. If playback is not active, it sets the {\ttfamily playback\+Active} flag to {\ttfamily true}. If playback is already active, it sets the {\ttfamily restart\+Playback} flag to {\ttfamily true} to restart playback.


\begin{DoxyParams}{Parameters}
{\em player} & Pointer to the {\ttfamily \doxylink{structWavPlayer}{Wav\+Player}} structure managing the audio playback. \\
\hline
\end{DoxyParams}
\Hypertarget{wavPlayer_8h_ac04851153a1624b01242f1720208e9f2}\index{wavPlayer.h@{wavPlayer.h}!populateWavHeader@{populateWavHeader}}
\index{populateWavHeader@{populateWavHeader}!wavPlayer.h@{wavPlayer.h}}
\doxysubsubsection{\texorpdfstring{populateWavHeader()}{populateWavHeader()}}
{\footnotesize\ttfamily \label{wavPlayer_8h_ac04851153a1624b01242f1720208e9f2} 
uint32\+\_\+t populate\+Wav\+Header (\begin{DoxyParamCaption}\item[{FIL \texorpdfstring{$\ast$}{*}}]{file}{, }\item[{\mbox{\hyperlink{structwav__header__t}{wav\+\_\+header\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{wav\+Header}{}\end{DoxyParamCaption})}



Reads and populates the WAV header from a file. 

This function reads the WAV file header and fills the provided {\ttfamily \doxylink{structwav__header__t}{wav\+\_\+header\+\_\+t}} structure. It continues reading chunks until it finds the "{}fmt "{} subchunk and returns the total size of the WAV header.


\begin{DoxyParams}{Parameters}
{\em file} & Pointer to the {\ttfamily FIL} object representing the WAV file. \\
\hline
{\em wav\+Header} & Pointer to the {\ttfamily \doxylink{structwav__header__t}{wav\+\_\+header\+\_\+t}} structure to be populated with header data. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Size of the WAV header in bytes, or 0 on error. 
\end{DoxyReturn}
\Hypertarget{wavPlayer_8h_a81ae4ad2cceb5e50440bee758173922b}\index{wavPlayer.h@{wavPlayer.h}!wavLoad@{wavLoad}}
\index{wavLoad@{wavLoad}!wavPlayer.h@{wavPlayer.h}}
\doxysubsubsection{\texorpdfstring{wavLoad()}{wavLoad()}}
{\footnotesize\ttfamily \label{wavPlayer_8h_a81ae4ad2cceb5e50440bee758173922b} 
FRESULT wav\+Load (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structWavPlayer}{Wav\+Player}} \texorpdfstring{$\ast$}{*}}]{player}{, }\item[{const char \texorpdfstring{$\ast$}{*}}]{filename}{}\end{DoxyParamCaption})}



Loads a WAV file and validates its header format. 

This function opens a WAV file using FATFS, populates the {\ttfamily \doxylink{structwav__header__t}{wav\+\_\+header\+\_\+t}} structure in the {\ttfamily \doxylink{structWavPlayer}{Wav\+Player}}, and checks if the file format is correct. It returns the result of the file opening operation.


\begin{DoxyParams}{Parameters}
{\em player} & Pointer to the {\ttfamily \doxylink{structWavPlayer}{Wav\+Player}} structure that will be used to manage the WAV file. \\
\hline
{\em filename} & Name of the WAV file to be loaded. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
{\ttfamily FR\+\_\+\+OK} if the file is successfully opened and format is valid, or an error code from FATFS otherwise. 
\end{DoxyReturn}
\Hypertarget{wavPlayer_8h_a7ef5d87c0f7e4ffb764986329e92ef51}\index{wavPlayer.h@{wavPlayer.h}!wavPlay@{wavPlay}}
\index{wavPlay@{wavPlay}!wavPlayer.h@{wavPlayer.h}}
\doxysubsubsection{\texorpdfstring{wavPlay()}{wavPlay()}}
{\footnotesize\ttfamily \label{wavPlayer_8h_a7ef5d87c0f7e4ffb764986329e92ef51} 
uint8\+\_\+t wav\+Play (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structWavPlayer}{Wav\+Player}} \texorpdfstring{$\ast$}{*}}]{player}{}\end{DoxyParamCaption})}



Plays the WAV file from the given {\ttfamily \doxylink{structWavPlayer}{Wav\+Player}}. 

This function initializes the DMA stream for I2S transmission, reads data from the WAV file, and plays it through the DAC. It handles playback restarting and manages the remaining bytes of audio data. The function also resets the playback state upon completion.


\begin{DoxyParams}{Parameters}
{\em player} & Pointer to the {\ttfamily \doxylink{structWavPlayer}{Wav\+Player}} structure containing the WAV file and header. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
{\ttfamily 0} on successful playback completion. Non-\/zero return values are reserved for error handling. 
\end{DoxyReturn}
\Hypertarget{wavPlayer_8h_ad05e6abad0601784f005b8b0d4685bad}\index{wavPlayer.h@{wavPlayer.h}!wavPlayPitched@{wavPlayPitched}}
\index{wavPlayPitched@{wavPlayPitched}!wavPlayer.h@{wavPlayer.h}}
\doxysubsubsection{\texorpdfstring{wavPlayPitched()}{wavPlayPitched()}}
{\footnotesize\ttfamily \label{wavPlayer_8h_ad05e6abad0601784f005b8b0d4685bad} 
uint8\+\_\+t wav\+Play\+Pitched (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structWavPlayer}{Wav\+Player}} \texorpdfstring{$\ast$}{*}}]{player}{}\end{DoxyParamCaption})}



Plays a WAV file with pitch shifting applied. 

This function plays a WAV file with pitch adjustment using DMA for I2S transmission. It reads audio data from the file, applies pitch shifting by adjusting the playback speed, and handles playback restarting. The function updates the pitch factor dynamically if changed.


\begin{DoxyParams}{Parameters}
{\em player} & Pointer to the {\ttfamily \doxylink{structWavPlayer}{Wav\+Player}} structure managing the WAV file and playback. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
{\ttfamily 0} on successful playback completion. Non-\/zero return values are reserved for error handling. 
\end{DoxyReturn}
