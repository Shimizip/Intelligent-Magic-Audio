\doxysection{f401\+\_\+sd\+\_\+card\+\_\+audio\+\_\+codec\+\_\+test/\+Core/\+Src/wav\+Player.c File Reference}
\hypertarget{wavPlayer_8c}{}\label{wavPlayer_8c}\index{f401\_sd\_card\_audio\_codec\_test/Core/Src/wavPlayer.c@{f401\_sd\_card\_audio\_codec\_test/Core/Src/wavPlayer.c}}


Implementation of a WAV player using FATFS and I2S with DMA.  


{\ttfamily \#include "{}fatfs.\+h"{}}\newline
{\ttfamily \#include "{}wav\+Player.\+h"{}}\newline
{\ttfamily \#include "{}string.\+h"{}}\newline
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{wavPlayer_8c_a3c131f990069cc240d2afd677a015cc9}{init\+Player}} (\mbox{\hyperlink{structWavPlayer}{Wav\+Player}} \texorpdfstring{$\ast$}{*}player, FIL \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{f401__display__encoder__fader__test_2Core_2Src_2main_8c_a296b3c88b34a2294d0bd990ac963543b}{file}}, \mbox{\hyperlink{structwav__header__t}{wav\+\_\+header\+\_\+t}} \texorpdfstring{$\ast$}{*}wav\+Header)
\begin{DoxyCompactList}\small\item\em Initializes a WAV player with specified file and header. \end{DoxyCompactList}\item 
uint32\+\_\+t \mbox{\hyperlink{wavPlayer_8c_ac04851153a1624b01242f1720208e9f2}{populate\+Wav\+Header}} (FIL \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{f401__display__encoder__fader__test_2Core_2Src_2main_8c_a296b3c88b34a2294d0bd990ac963543b}{file}}, \mbox{\hyperlink{structwav__header__t}{wav\+\_\+header\+\_\+t}} \texorpdfstring{$\ast$}{*}wav\+Header)
\begin{DoxyCompactList}\small\item\em Reads and populates the WAV header from a file. \end{DoxyCompactList}\item 
uint8\+\_\+t \mbox{\hyperlink{wavPlayer_8c_a7cf4d4f820fce107f3239fc741a56f8c}{check\+Wav}} (\mbox{\hyperlink{structWavPlayer}{Wav\+Player}} \texorpdfstring{$\ast$}{*}player)
\begin{DoxyCompactList}\small\item\em Validates the WAV file header for correctness. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{wavPlayer_8c_af9b52876abb4abff5a969b6050b20fbc}{play\+Button\+Handler}} (\mbox{\hyperlink{structWavPlayer}{Wav\+Player}} \texorpdfstring{$\ast$}{*}player)
\begin{DoxyCompactList}\small\item\em Handles the play button action for audio playback. \end{DoxyCompactList}\item 
FRESULT \mbox{\hyperlink{wavPlayer_8c_a81ae4ad2cceb5e50440bee758173922b}{wav\+Load}} (\mbox{\hyperlink{structWavPlayer}{Wav\+Player}} \texorpdfstring{$\ast$}{*}player, const char \texorpdfstring{$\ast$}{*}filename)
\begin{DoxyCompactList}\small\item\em Loads a WAV file and validates its header format. \end{DoxyCompactList}\item 
uint8\+\_\+t \mbox{\hyperlink{wavPlayer_8c_a7ef5d87c0f7e4ffb764986329e92ef51}{wav\+Play}} (\mbox{\hyperlink{structWavPlayer}{Wav\+Player}} \texorpdfstring{$\ast$}{*}player)
\begin{DoxyCompactList}\small\item\em Plays the WAV file from the given {\ttfamily \doxylink{structWavPlayer}{Wav\+Player}}. \end{DoxyCompactList}\item 
uint8\+\_\+t \mbox{\hyperlink{wavPlayer_8c_ad05e6abad0601784f005b8b0d4685bad}{wav\+Play\+Pitched}} (\mbox{\hyperlink{structWavPlayer}{Wav\+Player}} \texorpdfstring{$\ast$}{*}player)
\begin{DoxyCompactList}\small\item\em Plays a WAV file with pitch shifting applied. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Implementation of a WAV player using FATFS and I2S with DMA. 

This file provides functions to\+:
\begin{DoxyItemize}
\item Initialize the WAV player.
\item Read and validate WAV file headers.
\item Handle playback control via button actions.
\item Load and play WAV files, with optional pitch shifting. 
\end{DoxyItemize}

\doxysubsection{Function Documentation}
\Hypertarget{wavPlayer_8c_a7cf4d4f820fce107f3239fc741a56f8c}\index{wavPlayer.c@{wavPlayer.c}!checkWav@{checkWav}}
\index{checkWav@{checkWav}!wavPlayer.c@{wavPlayer.c}}
\doxysubsubsection{\texorpdfstring{checkWav()}{checkWav()}}
{\footnotesize\ttfamily \label{wavPlayer_8c_a7cf4d4f820fce107f3239fc741a56f8c} 
uint8\+\_\+t check\+Wav (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structWavPlayer}{Wav\+Player}} \texorpdfstring{$\ast$}{*}}]{player}{}\end{DoxyParamCaption})}



Validates the WAV file header for correctness. 

This function reads the WAV header from the {\ttfamily \doxylink{structWavPlayer}{Wav\+Player}} structure and checks for validity based on key header fields. It verifies the RIFF header and essential "{}fmt "{} subchunk to ensure the WAV file conforms to expected formats.


\begin{DoxyParams}{Parameters}
{\em player} & Pointer to the {\ttfamily \doxylink{structWavPlayer}{Wav\+Player}} structure containing the WAV file and header. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
{\ttfamily 1} if the WAV header is valid, {\ttfamily 0} otherwise. 
\end{DoxyReturn}
\Hypertarget{wavPlayer_8c_a3c131f990069cc240d2afd677a015cc9}\index{wavPlayer.c@{wavPlayer.c}!initPlayer@{initPlayer}}
\index{initPlayer@{initPlayer}!wavPlayer.c@{wavPlayer.c}}
\doxysubsubsection{\texorpdfstring{initPlayer()}{initPlayer()}}
{\footnotesize\ttfamily \label{wavPlayer_8c_a3c131f990069cc240d2afd677a015cc9} 
void init\+Player (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structWavPlayer}{Wav\+Player}} \texorpdfstring{$\ast$}{*}}]{player}{, }\item[{FIL \texorpdfstring{$\ast$}{*}}]{file}{, }\item[{\mbox{\hyperlink{structwav__header__t}{wav\+\_\+header\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{wav\+Header}{}\end{DoxyParamCaption})}



Initializes a WAV player with specified file and header. 

Sets up the {\ttfamily \doxylink{structWavPlayer}{Wav\+Player}} structure with the given file pointer and WAV header. Initializes playback control flags, header size, and pitch factor to default values.


\begin{DoxyParams}{Parameters}
{\em player} & Pointer to the {\ttfamily \doxylink{structWavPlayer}{Wav\+Player}} structure to initialize. \\
\hline
{\em file} & Pointer to the {\ttfamily FIL} object representing the WAV file. \\
\hline
{\em wav\+Header} & Pointer to the {\ttfamily \doxylink{structwav__header__t}{wav\+\_\+header\+\_\+t}} structure containing the WAV file header. \\
\hline
\end{DoxyParams}
\Hypertarget{wavPlayer_8c_af9b52876abb4abff5a969b6050b20fbc}\index{wavPlayer.c@{wavPlayer.c}!playButtonHandler@{playButtonHandler}}
\index{playButtonHandler@{playButtonHandler}!wavPlayer.c@{wavPlayer.c}}
\doxysubsubsection{\texorpdfstring{playButtonHandler()}{playButtonHandler()}}
{\footnotesize\ttfamily \label{wavPlayer_8c_af9b52876abb4abff5a969b6050b20fbc} 
void play\+Button\+Handler (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structWavPlayer}{Wav\+Player}} \texorpdfstring{$\ast$}{*}}]{player}{}\end{DoxyParamCaption})}



Handles the play button action for audio playback. 

This function toggles the playback state of the {\ttfamily \doxylink{structWavPlayer}{Wav\+Player}}. If playback is not active, it sets the {\ttfamily playback\+Active} flag to {\ttfamily true}. If playback is already active, it sets the {\ttfamily restart\+Playback} flag to {\ttfamily true} to restart playback.


\begin{DoxyParams}{Parameters}
{\em player} & Pointer to the {\ttfamily \doxylink{structWavPlayer}{Wav\+Player}} structure managing the audio playback. \\
\hline
\end{DoxyParams}
\Hypertarget{wavPlayer_8c_ac04851153a1624b01242f1720208e9f2}\index{wavPlayer.c@{wavPlayer.c}!populateWavHeader@{populateWavHeader}}
\index{populateWavHeader@{populateWavHeader}!wavPlayer.c@{wavPlayer.c}}
\doxysubsubsection{\texorpdfstring{populateWavHeader()}{populateWavHeader()}}
{\footnotesize\ttfamily \label{wavPlayer_8c_ac04851153a1624b01242f1720208e9f2} 
uint32\+\_\+t populate\+Wav\+Header (\begin{DoxyParamCaption}\item[{FIL \texorpdfstring{$\ast$}{*}}]{file}{, }\item[{\mbox{\hyperlink{structwav__header__t}{wav\+\_\+header\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{wav\+Header}{}\end{DoxyParamCaption})}



Reads and populates the WAV header from a file. 

This function reads the WAV file header and fills the provided {\ttfamily \doxylink{structwav__header__t}{wav\+\_\+header\+\_\+t}} structure. It continues reading chunks until it finds the "{}fmt "{} subchunk and returns the total size of the WAV header.


\begin{DoxyParams}{Parameters}
{\em file} & Pointer to the {\ttfamily FIL} object representing the WAV file. \\
\hline
{\em wav\+Header} & Pointer to the {\ttfamily \doxylink{structwav__header__t}{wav\+\_\+header\+\_\+t}} structure to be populated with header data. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Size of the WAV header in bytes, or 0 on error. 
\end{DoxyReturn}
\Hypertarget{wavPlayer_8c_a81ae4ad2cceb5e50440bee758173922b}\index{wavPlayer.c@{wavPlayer.c}!wavLoad@{wavLoad}}
\index{wavLoad@{wavLoad}!wavPlayer.c@{wavPlayer.c}}
\doxysubsubsection{\texorpdfstring{wavLoad()}{wavLoad()}}
{\footnotesize\ttfamily \label{wavPlayer_8c_a81ae4ad2cceb5e50440bee758173922b} 
FRESULT wav\+Load (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structWavPlayer}{Wav\+Player}} \texorpdfstring{$\ast$}{*}}]{player}{, }\item[{const char \texorpdfstring{$\ast$}{*}}]{filename}{}\end{DoxyParamCaption})}



Loads a WAV file and validates its header format. 

This function opens a WAV file using FATFS, populates the {\ttfamily \doxylink{structwav__header__t}{wav\+\_\+header\+\_\+t}} structure in the {\ttfamily \doxylink{structWavPlayer}{Wav\+Player}}, and checks if the file format is correct. It returns the result of the file opening operation.


\begin{DoxyParams}{Parameters}
{\em player} & Pointer to the {\ttfamily \doxylink{structWavPlayer}{Wav\+Player}} structure that will be used to manage the WAV file. \\
\hline
{\em filename} & Name of the WAV file to be loaded. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
{\ttfamily FR\+\_\+\+OK} if the file is successfully opened and format is valid, or an error code from FATFS otherwise. 
\end{DoxyReturn}
\Hypertarget{wavPlayer_8c_a7ef5d87c0f7e4ffb764986329e92ef51}\index{wavPlayer.c@{wavPlayer.c}!wavPlay@{wavPlay}}
\index{wavPlay@{wavPlay}!wavPlayer.c@{wavPlayer.c}}
\doxysubsubsection{\texorpdfstring{wavPlay()}{wavPlay()}}
{\footnotesize\ttfamily \label{wavPlayer_8c_a7ef5d87c0f7e4ffb764986329e92ef51} 
uint8\+\_\+t wav\+Play (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structWavPlayer}{Wav\+Player}} \texorpdfstring{$\ast$}{*}}]{player}{}\end{DoxyParamCaption})}



Plays the WAV file from the given {\ttfamily \doxylink{structWavPlayer}{Wav\+Player}}. 

This function initializes the DMA stream for I2S transmission, reads data from the WAV file, and plays it through the DAC. It handles playback restarting and manages the remaining bytes of audio data. The function also resets the playback state upon completion.


\begin{DoxyParams}{Parameters}
{\em player} & Pointer to the {\ttfamily \doxylink{structWavPlayer}{Wav\+Player}} structure containing the WAV file and header. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
{\ttfamily 0} on successful playback completion. Non-\/zero return values are reserved for error handling. 
\end{DoxyReturn}
\Hypertarget{wavPlayer_8c_ad05e6abad0601784f005b8b0d4685bad}\index{wavPlayer.c@{wavPlayer.c}!wavPlayPitched@{wavPlayPitched}}
\index{wavPlayPitched@{wavPlayPitched}!wavPlayer.c@{wavPlayer.c}}
\doxysubsubsection{\texorpdfstring{wavPlayPitched()}{wavPlayPitched()}}
{\footnotesize\ttfamily \label{wavPlayer_8c_ad05e6abad0601784f005b8b0d4685bad} 
uint8\+\_\+t wav\+Play\+Pitched (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structWavPlayer}{Wav\+Player}} \texorpdfstring{$\ast$}{*}}]{player}{}\end{DoxyParamCaption})}



Plays a WAV file with pitch shifting applied. 

This function plays a WAV file with pitch adjustment using DMA for I2S transmission. It reads audio data from the file, applies pitch shifting by adjusting the playback speed, and handles playback restarting. The function updates the pitch factor dynamically if changed.


\begin{DoxyParams}{Parameters}
{\em player} & Pointer to the {\ttfamily \doxylink{structWavPlayer}{Wav\+Player}} structure managing the WAV file and playback. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
{\ttfamily 0} on successful playback completion. Non-\/zero return values are reserved for error handling. 
\end{DoxyReturn}
