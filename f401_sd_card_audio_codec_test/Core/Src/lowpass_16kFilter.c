#include "lowpass_16kFilter.h"

static float filter_taps[LOWPASS_16KFILTER_TAP_NUM] = {
  -0.005235201012228237,
  -0.01490555829435906,
  -0.0043658732828319195,
  0.0066238463352104315,
  -0.0027085335119225867,
  -0.0022128565819366703,
  0.0049151750908137054,
  -0.0037260343405081976,
  -0.0005843978664308764,
  0.004777031640376045,
  -0.005305025267641451,
  0.001229804064479364,
  0.0045027419887832725,
  -0.007025188700970271,
  0.003606080873909892,
  0.0035668196322275274,
  -0.008601109235513587,
  0.006622349152062531,
  0.0016525391296908086,
  -0.009705166604152621,
  0.010224657817474536,
  -0.0015667363055003518,
  -0.00989767394152904,
  0.01425335754529964,
  -0.006387275431072958,
  -0.008651719998405858,
  0.01848292539646677,
  -0.013212554890722272,
  -0.005218904883197916,
  0.022576655032140024,
  -0.022745350028224053,
  0.0017253829836087464,
  0.02622228935675785,
  -0.03694424366042322,
  0.015297411488117009,
  0.029093060012096245,
  -0.06269832098820768,
  0.04775587905039306,
  0.030944561747463174,
  -0.15044733797095058,
  0.258408455603219,
  0.6982354722545531,
  0.258408455603219,
  -0.15044733797095058,
  0.030944561747463174,
  0.04775587905039306,
  -0.06269832098820768,
  0.029093060012096245,
  0.015297411488117009,
  -0.03694424366042322,
  0.02622228935675785,
  0.0017253829836087464,
  -0.022745350028224053,
  0.022576655032140024,
  -0.005218904883197916,
  -0.013212554890722272,
  0.01848292539646677,
  -0.008651719998405858,
  -0.006387275431072958,
  0.01425335754529964,
  -0.00989767394152904,
  -0.0015667363055003518,
  0.010224657817474536,
  -0.009705166604152621,
  0.0016525391296908086,
  0.006622349152062531,
  -0.008601109235513587,
  0.0035668196322275274,
  0.003606080873909892,
  -0.007025188700970271,
  0.0045027419887832725,
  0.001229804064479364,
  -0.005305025267641451,
  0.004777031640376045,
  -0.0005843978664308764,
  -0.0037260343405081976,
  0.0049151750908137054,
  -0.0022128565819366703,
  -0.0027085335119225867,
  0.0066238463352104315,
  -0.0043658732828319195,
  -0.01490555829435906,
  -0.005235201012228237
};

void lowpass_16kFilter_init(lowpass_16kFilter* f) {
  int i;
  for(i = 0; i < LOWPASS_16KFILTER_TAP_NUM; ++i)
    f->history[i] = 0;
  f->last_index = 0;
}

void lowpass_16kFilter_put(lowpass_16kFilter* f, float input) {
  f->history[f->last_index++] = input;
  if(f->last_index == LOWPASS_16KFILTER_TAP_NUM)
    f->last_index = 0;
}

float lowpass_16kFilter_get(lowpass_16kFilter* f) {
  float acc = 0;
  int index = f->last_index, i;
  for(i = 0; i < LOWPASS_16KFILTER_TAP_NUM; ++i) {
    index = index != 0 ? index-1 : LOWPASS_16KFILTER_TAP_NUM-1;
    acc += f->history[index] * filter_taps[i];
  };
  return acc;
}