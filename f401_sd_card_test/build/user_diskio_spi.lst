ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 1


   1              		.cpu cortex-m4
   2              		.arch armv7e-m
   3              		.fpu fpv4-sp-d16
   4              		.eabi_attribute 27, 1
   5              		.eabi_attribute 28, 1
   6              		.eabi_attribute 20, 1
   7              		.eabi_attribute 21, 1
   8              		.eabi_attribute 23, 3
   9              		.eabi_attribute 24, 1
  10              		.eabi_attribute 25, 1
  11              		.eabi_attribute 26, 1
  12              		.eabi_attribute 30, 1
  13              		.eabi_attribute 34, 1
  14              		.eabi_attribute 18, 4
  15              		.file	"user_diskio_spi.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.file 1 "Core/Src/user_diskio_spi.c"
  20              		.section	.text.xchg_spi,"ax",%progbits
  21              		.align	1
  22              		.syntax unified
  23              		.thumb
  24              		.thumb_func
  26              	xchg_spi:
  27              	.LVL0:
  28              	.LFB136:
   1:Core/Src/user_diskio_spi.c **** /**
   2:Core/Src/user_diskio_spi.c ****  ******************************************************************************
   3:Core/Src/user_diskio_spi.c ****   * @file    user_diskio_spi.c
   4:Core/Src/user_diskio_spi.c ****   * @brief   This file contains the implementation of the user_diskio_spi FatFs
   5:Core/Src/user_diskio_spi.c ****   *          driver.
   6:Core/Src/user_diskio_spi.c ****   ******************************************************************************
   7:Core/Src/user_diskio_spi.c ****   * Portions copyright (C) 2014, ChaN, all rights reserved.
   8:Core/Src/user_diskio_spi.c ****   * Portions copyright (C) 2017, kiwih, all rights reserved.
   9:Core/Src/user_diskio_spi.c ****   *
  10:Core/Src/user_diskio_spi.c ****   * This software is a free software and there is NO WARRANTY.
  11:Core/Src/user_diskio_spi.c ****   * No restriction on use. You can use, modify and redistribute it for
  12:Core/Src/user_diskio_spi.c ****   * personal, non-profit or commercial products UNDER YOUR RESPONSIBILITY.
  13:Core/Src/user_diskio_spi.c ****   * Redistributions of source code must retain the above copyright notice.
  14:Core/Src/user_diskio_spi.c ****   *
  15:Core/Src/user_diskio_spi.c ****   ******************************************************************************
  16:Core/Src/user_diskio_spi.c ****   */
  17:Core/Src/user_diskio_spi.c **** 
  18:Core/Src/user_diskio_spi.c **** //This code was ported by kiwih from a copywrited (C) library written by ChaN
  19:Core/Src/user_diskio_spi.c **** //available at http://elm-chan.org/fsw/ff/ffsample.zip
  20:Core/Src/user_diskio_spi.c **** //(text at http://elm-chan.org/fsw/ff/00index_e.html)
  21:Core/Src/user_diskio_spi.c **** 
  22:Core/Src/user_diskio_spi.c **** //This file provides the FatFs driver functions and SPI code required to manage
  23:Core/Src/user_diskio_spi.c **** //an SPI-connected MMC or compatible SD card with FAT
  24:Core/Src/user_diskio_spi.c **** 
  25:Core/Src/user_diskio_spi.c **** //It is designed to be wrapped by a cubemx generated user_diskio.c file.
  26:Core/Src/user_diskio_spi.c **** 
  27:Core/Src/user_diskio_spi.c **** #include "stm32f4xx_hal.h" /* Provide the low-level HAL functions */
  28:Core/Src/user_diskio_spi.c **** #include "user_diskio_spi.h"
  29:Core/Src/user_diskio_spi.c **** 
  30:Core/Src/user_diskio_spi.c **** //Make sure you set #define SD_SPI_HANDLE as some hspix in main.h
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 2


  31:Core/Src/user_diskio_spi.c **** //Make sure you set #define SD_CS_GPIO_Port as some GPIO port in main.h
  32:Core/Src/user_diskio_spi.c **** //Make sure you set #define SD_CS_Pin as some GPIO pin in main.h
  33:Core/Src/user_diskio_spi.c **** extern SPI_HandleTypeDef SD_SPI_HANDLE;
  34:Core/Src/user_diskio_spi.c **** 
  35:Core/Src/user_diskio_spi.c **** /* Function prototypes */
  36:Core/Src/user_diskio_spi.c **** 
  37:Core/Src/user_diskio_spi.c **** //(Note that the _256 is used as a mask to clear the prescalar bits as it provides binary 111 in th
  38:Core/Src/user_diskio_spi.c **** #define FCLK_SLOW() { MODIFY_REG(SD_SPI_HANDLE.Instance->CR1, SPI_BAUDRATEPRESCALER_256, SPI_BAUDRA
  39:Core/Src/user_diskio_spi.c **** #define FCLK_FAST() { MODIFY_REG(SD_SPI_HANDLE.Instance->CR1, SPI_BAUDRATEPRESCALER_256, SPI_BAUDRA
  40:Core/Src/user_diskio_spi.c **** 
  41:Core/Src/user_diskio_spi.c **** #define CS_HIGH()	{HAL_GPIO_WritePin(SD_CS_GPIO_Port, SD_CS_Pin, GPIO_PIN_SET);}
  42:Core/Src/user_diskio_spi.c **** #define CS_LOW()	{HAL_GPIO_WritePin(SD_CS_GPIO_Port, SD_CS_Pin, GPIO_PIN_RESET);}
  43:Core/Src/user_diskio_spi.c **** 
  44:Core/Src/user_diskio_spi.c **** /*--------------------------------------------------------------------------
  45:Core/Src/user_diskio_spi.c **** 
  46:Core/Src/user_diskio_spi.c ****    Module Private Functions
  47:Core/Src/user_diskio_spi.c **** 
  48:Core/Src/user_diskio_spi.c **** ---------------------------------------------------------------------------*/
  49:Core/Src/user_diskio_spi.c **** 
  50:Core/Src/user_diskio_spi.c **** /* MMC/SD command */
  51:Core/Src/user_diskio_spi.c **** #define CMD0	(0)			/* GO_IDLE_STATE */
  52:Core/Src/user_diskio_spi.c **** #define CMD1	(1)			/* SEND_OP_COND (MMC) */
  53:Core/Src/user_diskio_spi.c **** #define	ACMD41	(0x80+41)	/* SEND_OP_COND (SDC) */
  54:Core/Src/user_diskio_spi.c **** #define CMD8	(8)			/* SEND_IF_COND */
  55:Core/Src/user_diskio_spi.c **** #define CMD9	(9)			/* SEND_CSD */
  56:Core/Src/user_diskio_spi.c **** #define CMD10	(10)		/* SEND_CID */
  57:Core/Src/user_diskio_spi.c **** #define CMD12	(12)		/* STOP_TRANSMISSION */
  58:Core/Src/user_diskio_spi.c **** #define ACMD13	(0x80+13)	/* SD_STATUS (SDC) */
  59:Core/Src/user_diskio_spi.c **** #define CMD16	(16)		/* SET_BLOCKLEN */
  60:Core/Src/user_diskio_spi.c **** #define CMD17	(17)		/* READ_SINGLE_BLOCK */
  61:Core/Src/user_diskio_spi.c **** #define CMD18	(18)		/* READ_MULTIPLE_BLOCK */
  62:Core/Src/user_diskio_spi.c **** #define CMD23	(23)		/* SET_BLOCK_COUNT (MMC) */
  63:Core/Src/user_diskio_spi.c **** #define	ACMD23	(0x80+23)	/* SET_WR_BLK_ERASE_COUNT (SDC) */
  64:Core/Src/user_diskio_spi.c **** #define CMD24	(24)		/* WRITE_BLOCK */
  65:Core/Src/user_diskio_spi.c **** #define CMD25	(25)		/* WRITE_MULTIPLE_BLOCK */
  66:Core/Src/user_diskio_spi.c **** #define CMD32	(32)		/* ERASE_ER_BLK_START */
  67:Core/Src/user_diskio_spi.c **** #define CMD33	(33)		/* ERASE_ER_BLK_END */
  68:Core/Src/user_diskio_spi.c **** #define CMD38	(38)		/* ERASE */
  69:Core/Src/user_diskio_spi.c **** #define CMD55	(55)		/* APP_CMD */
  70:Core/Src/user_diskio_spi.c **** #define CMD58	(58)		/* READ_OCR */
  71:Core/Src/user_diskio_spi.c **** 
  72:Core/Src/user_diskio_spi.c **** /* MMC card type flags (MMC_GET_TYPE) */
  73:Core/Src/user_diskio_spi.c **** #define CT_MMC		0x01		/* MMC ver 3 */
  74:Core/Src/user_diskio_spi.c **** #define CT_SD1		0x02		/* SD ver 1 */
  75:Core/Src/user_diskio_spi.c **** #define CT_SD2		0x04		/* SD ver 2 */
  76:Core/Src/user_diskio_spi.c **** #define CT_SDC		(CT_SD1|CT_SD2)	/* SD */
  77:Core/Src/user_diskio_spi.c **** #define CT_BLOCK	0x08		/* Block addressing */
  78:Core/Src/user_diskio_spi.c **** 
  79:Core/Src/user_diskio_spi.c **** static volatile
  80:Core/Src/user_diskio_spi.c **** DSTATUS Stat = STA_NOINIT;	/* Physical drive status */
  81:Core/Src/user_diskio_spi.c **** 
  82:Core/Src/user_diskio_spi.c **** 
  83:Core/Src/user_diskio_spi.c **** static
  84:Core/Src/user_diskio_spi.c **** BYTE CardType;			/* Card type flags */
  85:Core/Src/user_diskio_spi.c **** 
  86:Core/Src/user_diskio_spi.c **** uint32_t spiTimerTickStart;
  87:Core/Src/user_diskio_spi.c **** uint32_t spiTimerTickDelay;
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 3


  88:Core/Src/user_diskio_spi.c **** 
  89:Core/Src/user_diskio_spi.c **** void SPI_Timer_On(uint32_t waitTicks) {
  90:Core/Src/user_diskio_spi.c ****     spiTimerTickStart = HAL_GetTick();
  91:Core/Src/user_diskio_spi.c ****     spiTimerTickDelay = waitTicks;
  92:Core/Src/user_diskio_spi.c **** }
  93:Core/Src/user_diskio_spi.c **** 
  94:Core/Src/user_diskio_spi.c **** uint8_t SPI_Timer_Status() {
  95:Core/Src/user_diskio_spi.c ****     return ((HAL_GetTick() - spiTimerTickStart) < spiTimerTickDelay);
  96:Core/Src/user_diskio_spi.c **** }
  97:Core/Src/user_diskio_spi.c **** 
  98:Core/Src/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
  99:Core/Src/user_diskio_spi.c **** /* SPI controls (Platform dependent)                                     */
 100:Core/Src/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 101:Core/Src/user_diskio_spi.c **** 
 102:Core/Src/user_diskio_spi.c **** /* Exchange a byte */
 103:Core/Src/user_diskio_spi.c **** static
 104:Core/Src/user_diskio_spi.c **** BYTE xchg_spi (
 105:Core/Src/user_diskio_spi.c **** 	BYTE dat	/* Data to send */
 106:Core/Src/user_diskio_spi.c **** )
 107:Core/Src/user_diskio_spi.c **** {
  29              		.loc 1 107 1 view -0
  30              		.cfi_startproc
  31              		@ args = 0, pretend = 0, frame = 16
  32              		@ frame_needed = 0, uses_anonymous_args = 0
  33              		.loc 1 107 1 is_stmt 0 view .LVU1
  34 0000 00B5     		push	{lr}
  35              		.cfi_def_cfa_offset 4
  36              		.cfi_offset 14, -4
  37 0002 87B0     		sub	sp, sp, #28
  38              		.cfi_def_cfa_offset 32
  39 0004 8DF80F00 		strb	r0, [sp, #15]
 108:Core/Src/user_diskio_spi.c **** 	BYTE rxDat;
  40              		.loc 1 108 2 is_stmt 1 view .LVU2
 109:Core/Src/user_diskio_spi.c ****     HAL_SPI_TransmitReceive(&SD_SPI_HANDLE, &dat, &rxDat, 1, 50);
  41              		.loc 1 109 5 view .LVU3
  42 0008 3223     		movs	r3, #50
  43 000a 0093     		str	r3, [sp]
  44 000c 0123     		movs	r3, #1
  45 000e 0DF11702 		add	r2, sp, #23
  46 0012 0DF10F01 		add	r1, sp, #15
  47 0016 0448     		ldr	r0, .L3
  48              	.LVL1:
  49              		.loc 1 109 5 is_stmt 0 view .LVU4
  50 0018 FFF7FEFF 		bl	HAL_SPI_TransmitReceive
  51              	.LVL2:
 110:Core/Src/user_diskio_spi.c ****     return rxDat;
  52              		.loc 1 110 5 is_stmt 1 view .LVU5
 111:Core/Src/user_diskio_spi.c **** }
  53              		.loc 1 111 1 is_stmt 0 view .LVU6
  54 001c 9DF81700 		ldrb	r0, [sp, #23]	@ zero_extendqisi2
  55 0020 07B0     		add	sp, sp, #28
  56              		.cfi_def_cfa_offset 4
  57              		@ sp needed
  58 0022 5DF804FB 		ldr	pc, [sp], #4
  59              	.L4:
  60 0026 00BF     		.align	2
  61              	.L3:
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 4


  62 0028 00000000 		.word	hspi2
  63              		.cfi_endproc
  64              	.LFE136:
  66              		.section	.text.wait_ready,"ax",%progbits
  67              		.align	1
  68              		.syntax unified
  69              		.thumb
  70              		.thumb_func
  72              	wait_ready:
  73              	.LVL3:
  74              	.LFB139:
 112:Core/Src/user_diskio_spi.c **** 
 113:Core/Src/user_diskio_spi.c **** 
 114:Core/Src/user_diskio_spi.c **** /* Receive multiple byte */
 115:Core/Src/user_diskio_spi.c **** static
 116:Core/Src/user_diskio_spi.c **** void rcvr_spi_multi (
 117:Core/Src/user_diskio_spi.c **** 	BYTE *buff,		/* Pointer to data buffer */
 118:Core/Src/user_diskio_spi.c **** 	UINT btr		/* Number of bytes to receive (even number) */
 119:Core/Src/user_diskio_spi.c **** )
 120:Core/Src/user_diskio_spi.c **** {
 121:Core/Src/user_diskio_spi.c **** 	for(UINT i=0; i<btr; i++) {
 122:Core/Src/user_diskio_spi.c **** 		*(buff+i) = xchg_spi(0xFF);
 123:Core/Src/user_diskio_spi.c **** 	}
 124:Core/Src/user_diskio_spi.c **** }
 125:Core/Src/user_diskio_spi.c **** 
 126:Core/Src/user_diskio_spi.c **** 
 127:Core/Src/user_diskio_spi.c **** #if _USE_WRITE
 128:Core/Src/user_diskio_spi.c **** /* Send multiple byte */
 129:Core/Src/user_diskio_spi.c **** static
 130:Core/Src/user_diskio_spi.c **** void xmit_spi_multi (
 131:Core/Src/user_diskio_spi.c **** 	const BYTE *buff,	/* Pointer to the data */
 132:Core/Src/user_diskio_spi.c **** 	UINT btx			/* Number of bytes to send (even number) */
 133:Core/Src/user_diskio_spi.c **** )
 134:Core/Src/user_diskio_spi.c **** {
 135:Core/Src/user_diskio_spi.c **** 	HAL_SPI_Transmit(&SD_SPI_HANDLE, buff, btx, HAL_MAX_DELAY);
 136:Core/Src/user_diskio_spi.c **** }
 137:Core/Src/user_diskio_spi.c **** #endif
 138:Core/Src/user_diskio_spi.c **** 
 139:Core/Src/user_diskio_spi.c **** 
 140:Core/Src/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 141:Core/Src/user_diskio_spi.c **** /* Wait for card ready                                                   */
 142:Core/Src/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 143:Core/Src/user_diskio_spi.c **** 
 144:Core/Src/user_diskio_spi.c **** static
 145:Core/Src/user_diskio_spi.c **** int wait_ready (	/* 1:Ready, 0:Timeout */
 146:Core/Src/user_diskio_spi.c **** 	UINT wt			/* Timeout [ms] */
 147:Core/Src/user_diskio_spi.c **** )
 148:Core/Src/user_diskio_spi.c **** {
  75              		.loc 1 148 1 is_stmt 1 view -0
  76              		.cfi_startproc
  77              		@ args = 0, pretend = 0, frame = 0
  78              		@ frame_needed = 0, uses_anonymous_args = 0
  79              		.loc 1 148 1 is_stmt 0 view .LVU8
  80 0000 70B5     		push	{r4, r5, r6, lr}
  81              		.cfi_def_cfa_offset 16
  82              		.cfi_offset 4, -16
  83              		.cfi_offset 5, -12
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 5


  84              		.cfi_offset 6, -8
  85              		.cfi_offset 14, -4
  86 0002 0646     		mov	r6, r0
 149:Core/Src/user_diskio_spi.c **** 	BYTE d;
  87              		.loc 1 149 2 is_stmt 1 view .LVU9
 150:Core/Src/user_diskio_spi.c **** 	//wait_ready needs its own timer, unfortunately, so it can't use the
 151:Core/Src/user_diskio_spi.c **** 	//spi_timer functions
 152:Core/Src/user_diskio_spi.c **** 	uint32_t waitSpiTimerTickStart;
  88              		.loc 1 152 2 view .LVU10
 153:Core/Src/user_diskio_spi.c **** 	uint32_t waitSpiTimerTickDelay;
  89              		.loc 1 153 2 view .LVU11
 154:Core/Src/user_diskio_spi.c **** 
 155:Core/Src/user_diskio_spi.c **** 	waitSpiTimerTickStart = HAL_GetTick();
  90              		.loc 1 155 2 view .LVU12
  91              		.loc 1 155 26 is_stmt 0 view .LVU13
  92 0004 FFF7FEFF 		bl	HAL_GetTick
  93              	.LVL4:
  94              		.loc 1 155 26 view .LVU14
  95 0008 0546     		mov	r5, r0
  96              	.LVL5:
 156:Core/Src/user_diskio_spi.c **** 	waitSpiTimerTickDelay = (uint32_t)wt;
  97              		.loc 1 156 2 is_stmt 1 view .LVU15
  98              	.L7:
 157:Core/Src/user_diskio_spi.c **** 	do {
  99              		.loc 1 157 2 view .LVU16
 158:Core/Src/user_diskio_spi.c **** 		d = xchg_spi(0xFF);
 100              		.loc 1 158 3 view .LVU17
 101              		.loc 1 158 7 is_stmt 0 view .LVU18
 102 000a FF20     		movs	r0, #255
 103 000c FFF7FEFF 		bl	xchg_spi
 104              	.LVL6:
 105 0010 0446     		mov	r4, r0
 106              	.LVL7:
 159:Core/Src/user_diskio_spi.c **** 		/* This loop takes a time. Insert rot_rdq() here for multitask envilonment. */
 160:Core/Src/user_diskio_spi.c **** 	} while (d != 0xFF && ((HAL_GetTick() - waitSpiTimerTickStart) < waitSpiTimerTickDelay));	/* Wait 
 107              		.loc 1 160 21 is_stmt 1 discriminator 2 view .LVU19
 108 0012 FF28     		cmp	r0, #255
 109 0014 04D0     		beq	.L6
 110              		.loc 1 160 26 is_stmt 0 discriminator 1 view .LVU20
 111 0016 FFF7FEFF 		bl	HAL_GetTick
 112              	.LVL8:
 113              		.loc 1 160 40 discriminator 1 view .LVU21
 114 001a 401B     		subs	r0, r0, r5
 115              		.loc 1 160 21 discriminator 1 view .LVU22
 116 001c B042     		cmp	r0, r6
 117 001e F4D3     		bcc	.L7
 118              	.L6:
 161:Core/Src/user_diskio_spi.c **** 
 162:Core/Src/user_diskio_spi.c **** 	return (d == 0xFF) ? 1 : 0;
 119              		.loc 1 162 2 is_stmt 1 view .LVU23
 163:Core/Src/user_diskio_spi.c **** }
 120              		.loc 1 163 1 is_stmt 0 view .LVU24
 121 0020 FF2C     		cmp	r4, #255
 122 0022 14BF     		ite	ne
 123 0024 0020     		movne	r0, #0
 124 0026 0120     		moveq	r0, #1
 125 0028 70BD     		pop	{r4, r5, r6, pc}
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 6


 126              		.loc 1 163 1 view .LVU25
 127              		.cfi_endproc
 128              	.LFE139:
 130              		.section	.text.rcvr_spi_multi,"ax",%progbits
 131              		.align	1
 132              		.syntax unified
 133              		.thumb
 134              		.thumb_func
 136              	rcvr_spi_multi:
 137              	.LVL9:
 138              	.LFB137:
 120:Core/Src/user_diskio_spi.c **** 	for(UINT i=0; i<btr; i++) {
 139              		.loc 1 120 1 is_stmt 1 view -0
 140              		.cfi_startproc
 141              		@ args = 0, pretend = 0, frame = 0
 142              		@ frame_needed = 0, uses_anonymous_args = 0
 120:Core/Src/user_diskio_spi.c **** 	for(UINT i=0; i<btr; i++) {
 143              		.loc 1 120 1 is_stmt 0 view .LVU27
 144 0000 70B5     		push	{r4, r5, r6, lr}
 145              		.cfi_def_cfa_offset 16
 146              		.cfi_offset 4, -16
 147              		.cfi_offset 5, -12
 148              		.cfi_offset 6, -8
 149              		.cfi_offset 14, -4
 150 0002 0646     		mov	r6, r0
 151 0004 0D46     		mov	r5, r1
 121:Core/Src/user_diskio_spi.c **** 		*(buff+i) = xchg_spi(0xFF);
 152              		.loc 1 121 2 is_stmt 1 view .LVU28
 153              	.LBB2:
 121:Core/Src/user_diskio_spi.c **** 		*(buff+i) = xchg_spi(0xFF);
 154              		.loc 1 121 6 view .LVU29
 155              	.LVL10:
 121:Core/Src/user_diskio_spi.c **** 		*(buff+i) = xchg_spi(0xFF);
 156              		.loc 1 121 11 is_stmt 0 view .LVU30
 157 0006 0024     		movs	r4, #0
 121:Core/Src/user_diskio_spi.c **** 		*(buff+i) = xchg_spi(0xFF);
 158              		.loc 1 121 2 view .LVU31
 159 0008 04E0     		b	.L10
 160              	.LVL11:
 161              	.L11:
 122:Core/Src/user_diskio_spi.c **** 	}
 162              		.loc 1 122 3 is_stmt 1 view .LVU32
 122:Core/Src/user_diskio_spi.c **** 	}
 163              		.loc 1 122 15 is_stmt 0 view .LVU33
 164 000a FF20     		movs	r0, #255
 165 000c FFF7FEFF 		bl	xchg_spi
 166              	.LVL12:
 122:Core/Src/user_diskio_spi.c **** 	}
 167              		.loc 1 122 13 discriminator 1 view .LVU34
 168 0010 3055     		strb	r0, [r6, r4]
 121:Core/Src/user_diskio_spi.c **** 		*(buff+i) = xchg_spi(0xFF);
 169              		.loc 1 121 24 is_stmt 1 discriminator 3 view .LVU35
 170 0012 0134     		adds	r4, r4, #1
 171              	.LVL13:
 172              	.L10:
 121:Core/Src/user_diskio_spi.c **** 		*(buff+i) = xchg_spi(0xFF);
 173              		.loc 1 121 17 discriminator 1 view .LVU36
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 7


 174 0014 AC42     		cmp	r4, r5
 175 0016 F8D3     		bcc	.L11
 176              	.LBE2:
 124:Core/Src/user_diskio_spi.c **** 
 177              		.loc 1 124 1 is_stmt 0 view .LVU37
 178 0018 70BD     		pop	{r4, r5, r6, pc}
 124:Core/Src/user_diskio_spi.c **** 
 179              		.loc 1 124 1 view .LVU38
 180              		.cfi_endproc
 181              	.LFE137:
 183              		.section	.text.despiselect,"ax",%progbits
 184              		.align	1
 185              		.syntax unified
 186              		.thumb
 187              		.thumb_func
 189              	despiselect:
 190              	.LFB140:
 164:Core/Src/user_diskio_spi.c **** 
 165:Core/Src/user_diskio_spi.c **** 
 166:Core/Src/user_diskio_spi.c **** 
 167:Core/Src/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 168:Core/Src/user_diskio_spi.c **** /* Despiselect card and release SPI                                         */
 169:Core/Src/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 170:Core/Src/user_diskio_spi.c **** 
 171:Core/Src/user_diskio_spi.c **** static
 172:Core/Src/user_diskio_spi.c **** void despiselect (void)
 173:Core/Src/user_diskio_spi.c **** {
 191              		.loc 1 173 1 is_stmt 1 view -0
 192              		.cfi_startproc
 193              		@ args = 0, pretend = 0, frame = 0
 194              		@ frame_needed = 0, uses_anonymous_args = 0
 195 0000 08B5     		push	{r3, lr}
 196              		.cfi_def_cfa_offset 8
 197              		.cfi_offset 3, -8
 198              		.cfi_offset 14, -4
 174:Core/Src/user_diskio_spi.c **** 	CS_HIGH();		/* Set CS# high */
 199              		.loc 1 174 2 view .LVU40
 200 0002 0122     		movs	r2, #1
 201 0004 0221     		movs	r1, #2
 202 0006 0348     		ldr	r0, .L15
 203 0008 FFF7FEFF 		bl	HAL_GPIO_WritePin
 204              	.LVL14:
 205              		.loc 1 174 11 discriminator 1 view .LVU41
 175:Core/Src/user_diskio_spi.c **** 	xchg_spi(0xFF);	/* Dummy clock (force DO hi-z for multiple slave SPI) */
 206              		.loc 1 175 2 view .LVU42
 207 000c FF20     		movs	r0, #255
 208 000e FFF7FEFF 		bl	xchg_spi
 209              	.LVL15:
 176:Core/Src/user_diskio_spi.c **** 
 177:Core/Src/user_diskio_spi.c **** }
 210              		.loc 1 177 1 is_stmt 0 view .LVU43
 211 0012 08BD     		pop	{r3, pc}
 212              	.L16:
 213              		.align	2
 214              	.L15:
 215 0014 00040240 		.word	1073873920
 216              		.cfi_endproc
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 8


 217              	.LFE140:
 219              		.section	.text.spiselect,"ax",%progbits
 220              		.align	1
 221              		.syntax unified
 222              		.thumb
 223              		.thumb_func
 225              	spiselect:
 226              	.LFB141:
 178:Core/Src/user_diskio_spi.c **** 
 179:Core/Src/user_diskio_spi.c **** 
 180:Core/Src/user_diskio_spi.c **** 
 181:Core/Src/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 182:Core/Src/user_diskio_spi.c **** /* Select card and wait for ready                                        */
 183:Core/Src/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 184:Core/Src/user_diskio_spi.c **** 
 185:Core/Src/user_diskio_spi.c **** static
 186:Core/Src/user_diskio_spi.c **** int spiselect (void)	/* 1:OK, 0:Timeout */
 187:Core/Src/user_diskio_spi.c **** {
 227              		.loc 1 187 1 is_stmt 1 view -0
 228              		.cfi_startproc
 229              		@ args = 0, pretend = 0, frame = 0
 230              		@ frame_needed = 0, uses_anonymous_args = 0
 231 0000 10B5     		push	{r4, lr}
 232              		.cfi_def_cfa_offset 8
 233              		.cfi_offset 4, -8
 234              		.cfi_offset 14, -4
 188:Core/Src/user_diskio_spi.c **** 	CS_LOW();		/* Set CS# low */
 235              		.loc 1 188 2 view .LVU45
 236 0002 0022     		movs	r2, #0
 237 0004 0221     		movs	r1, #2
 238 0006 0948     		ldr	r0, .L22
 239 0008 FFF7FEFF 		bl	HAL_GPIO_WritePin
 240              	.LVL16:
 241              		.loc 1 188 10 discriminator 1 view .LVU46
 189:Core/Src/user_diskio_spi.c **** 	xchg_spi(0xFF);	/* Dummy clock (force DO enabled) */
 242              		.loc 1 189 2 view .LVU47
 243 000c FF20     		movs	r0, #255
 244 000e FFF7FEFF 		bl	xchg_spi
 245              	.LVL17:
 190:Core/Src/user_diskio_spi.c **** 	if (wait_ready(500)) return 1;	/* Wait for card ready */
 246              		.loc 1 190 2 view .LVU48
 247              		.loc 1 190 6 is_stmt 0 view .LVU49
 248 0012 4FF4FA70 		mov	r0, #500
 249 0016 FFF7FEFF 		bl	wait_ready
 250              	.LVL18:
 251              		.loc 1 190 5 discriminator 1 view .LVU50
 252 001a 10B1     		cbz	r0, .L21
 253              		.loc 1 190 30 discriminator 1 view .LVU51
 254 001c 0124     		movs	r4, #1
 255              	.L17:
 191:Core/Src/user_diskio_spi.c **** 
 192:Core/Src/user_diskio_spi.c **** 	despiselect();
 193:Core/Src/user_diskio_spi.c **** 	return 0;	/* Timeout */
 194:Core/Src/user_diskio_spi.c **** }
 256              		.loc 1 194 1 view .LVU52
 257 001e 2046     		mov	r0, r4
 258 0020 10BD     		pop	{r4, pc}
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 9


 259              	.L21:
 260 0022 0446     		mov	r4, r0
 192:Core/Src/user_diskio_spi.c **** 	return 0;	/* Timeout */
 261              		.loc 1 192 2 is_stmt 1 view .LVU53
 262 0024 FFF7FEFF 		bl	despiselect
 263              	.LVL19:
 193:Core/Src/user_diskio_spi.c **** }
 264              		.loc 1 193 2 view .LVU54
 193:Core/Src/user_diskio_spi.c **** }
 265              		.loc 1 193 9 is_stmt 0 view .LVU55
 266 0028 F9E7     		b	.L17
 267              	.L23:
 268 002a 00BF     		.align	2
 269              	.L22:
 270 002c 00040240 		.word	1073873920
 271              		.cfi_endproc
 272              	.LFE141:
 274              		.section	.text.send_cmd,"ax",%progbits
 275              		.align	1
 276              		.syntax unified
 277              		.thumb
 278              		.thumb_func
 280              	send_cmd:
 281              	.LVL20:
 282              	.LFB144:
 195:Core/Src/user_diskio_spi.c **** 
 196:Core/Src/user_diskio_spi.c **** 
 197:Core/Src/user_diskio_spi.c **** 
 198:Core/Src/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 199:Core/Src/user_diskio_spi.c **** /* Receive a data packet from the MMC                                    */
 200:Core/Src/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 201:Core/Src/user_diskio_spi.c **** 
 202:Core/Src/user_diskio_spi.c **** static
 203:Core/Src/user_diskio_spi.c **** int rcvr_datablock (	/* 1:OK, 0:Error */
 204:Core/Src/user_diskio_spi.c **** 	BYTE *buff,			/* Data buffer */
 205:Core/Src/user_diskio_spi.c **** 	UINT btr			/* Data block length (byte) */
 206:Core/Src/user_diskio_spi.c **** )
 207:Core/Src/user_diskio_spi.c **** {
 208:Core/Src/user_diskio_spi.c **** 	BYTE token;
 209:Core/Src/user_diskio_spi.c **** 
 210:Core/Src/user_diskio_spi.c **** 
 211:Core/Src/user_diskio_spi.c **** 	SPI_Timer_On(200);
 212:Core/Src/user_diskio_spi.c **** 	do {							/* Wait for DataStart token in timeout of 200ms */
 213:Core/Src/user_diskio_spi.c **** 		token = xchg_spi(0xFF);
 214:Core/Src/user_diskio_spi.c **** 		/* This loop will take a time. Insert rot_rdq() here for multitask envilonment. */
 215:Core/Src/user_diskio_spi.c **** 	} while ((token == 0xFF) && SPI_Timer_Status());
 216:Core/Src/user_diskio_spi.c **** 	if(token != 0xFE) return 0;		/* Function fails if invalid DataStart token or timeout */
 217:Core/Src/user_diskio_spi.c **** 
 218:Core/Src/user_diskio_spi.c **** 	rcvr_spi_multi(buff, btr);		/* Store trailing data to the buffer */
 219:Core/Src/user_diskio_spi.c **** 	xchg_spi(0xFF); xchg_spi(0xFF);			/* Discard CRC */
 220:Core/Src/user_diskio_spi.c **** 
 221:Core/Src/user_diskio_spi.c **** 	return 1;						/* Function succeeded */
 222:Core/Src/user_diskio_spi.c **** }
 223:Core/Src/user_diskio_spi.c **** 
 224:Core/Src/user_diskio_spi.c **** 
 225:Core/Src/user_diskio_spi.c **** 
 226:Core/Src/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 10


 227:Core/Src/user_diskio_spi.c **** /* Send a data packet to the MMC                                         */
 228:Core/Src/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 229:Core/Src/user_diskio_spi.c **** 
 230:Core/Src/user_diskio_spi.c **** #if _USE_WRITE
 231:Core/Src/user_diskio_spi.c **** static
 232:Core/Src/user_diskio_spi.c **** int xmit_datablock (	/* 1:OK, 0:Failed */
 233:Core/Src/user_diskio_spi.c **** 	const BYTE *buff,	/* Ponter to 512 byte data to be sent */
 234:Core/Src/user_diskio_spi.c **** 	BYTE token			/* Token */
 235:Core/Src/user_diskio_spi.c **** )
 236:Core/Src/user_diskio_spi.c **** {
 237:Core/Src/user_diskio_spi.c **** 	BYTE resp;
 238:Core/Src/user_diskio_spi.c **** 
 239:Core/Src/user_diskio_spi.c **** 
 240:Core/Src/user_diskio_spi.c **** 	if (!wait_ready(500)) return 0;		/* Wait for card ready */
 241:Core/Src/user_diskio_spi.c **** 
 242:Core/Src/user_diskio_spi.c **** 	xchg_spi(token);					/* Send token */
 243:Core/Src/user_diskio_spi.c **** 	if (token != 0xFD) {				/* Send data if token is other than StopTran */
 244:Core/Src/user_diskio_spi.c **** 		xmit_spi_multi(buff, 512);		/* Data */
 245:Core/Src/user_diskio_spi.c **** 		xchg_spi(0xFF); xchg_spi(0xFF);	/* Dummy CRC */
 246:Core/Src/user_diskio_spi.c **** 
 247:Core/Src/user_diskio_spi.c **** 		resp = xchg_spi(0xFF);				/* Receive data resp */
 248:Core/Src/user_diskio_spi.c **** 		if ((resp & 0x1F) != 0x05) return 0;	/* Function fails if the data packet was not accepted */
 249:Core/Src/user_diskio_spi.c **** 	}
 250:Core/Src/user_diskio_spi.c **** 	return 1;
 251:Core/Src/user_diskio_spi.c **** }
 252:Core/Src/user_diskio_spi.c **** #endif
 253:Core/Src/user_diskio_spi.c **** 
 254:Core/Src/user_diskio_spi.c **** 
 255:Core/Src/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 256:Core/Src/user_diskio_spi.c **** /* Send a command packet to the MMC                                      */
 257:Core/Src/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 258:Core/Src/user_diskio_spi.c **** 
 259:Core/Src/user_diskio_spi.c **** static
 260:Core/Src/user_diskio_spi.c **** BYTE send_cmd (		/* Return value: R1 resp (bit7==1:Failed to send) */
 261:Core/Src/user_diskio_spi.c **** 	BYTE cmd,		/* Command index */
 262:Core/Src/user_diskio_spi.c **** 	DWORD arg		/* Argument */
 263:Core/Src/user_diskio_spi.c **** )
 264:Core/Src/user_diskio_spi.c **** {
 283              		.loc 1 264 1 is_stmt 1 view -0
 284              		.cfi_startproc
 285              		@ args = 0, pretend = 0, frame = 8
 286              		@ frame_needed = 0, uses_anonymous_args = 0
 287              		.loc 1 264 1 is_stmt 0 view .LVU57
 288 0000 30B5     		push	{r4, r5, lr}
 289              		.cfi_def_cfa_offset 12
 290              		.cfi_offset 4, -12
 291              		.cfi_offset 5, -8
 292              		.cfi_offset 14, -4
 293 0002 83B0     		sub	sp, sp, #12
 294              		.cfi_def_cfa_offset 24
 295 0004 0446     		mov	r4, r0
 296 0006 0D46     		mov	r5, r1
 265:Core/Src/user_diskio_spi.c **** 	volatile BYTE n, res;
 297              		.loc 1 265 2 is_stmt 1 view .LVU58
 266:Core/Src/user_diskio_spi.c **** 
 267:Core/Src/user_diskio_spi.c **** 
 268:Core/Src/user_diskio_spi.c **** 	if (cmd & 0x80) {	/* Send a CMD55 prior to ACMD<n> */
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 11


 298              		.loc 1 268 2 view .LVU59
 299              		.loc 1 268 5 is_stmt 0 view .LVU60
 300 0008 10F0800F 		tst	r0, #128
 301 000c 40D1     		bne	.L35
 302              	.LVL21:
 303              	.L25:
 269:Core/Src/user_diskio_spi.c **** 		cmd &= 0x7F;
 270:Core/Src/user_diskio_spi.c **** 		res = send_cmd(CMD55, 0);
 271:Core/Src/user_diskio_spi.c **** 		if (res > 1) return res;
 272:Core/Src/user_diskio_spi.c **** 	}
 273:Core/Src/user_diskio_spi.c **** 
 274:Core/Src/user_diskio_spi.c **** 	/* Select the card and wait for ready except to stop multiple block read */
 275:Core/Src/user_diskio_spi.c **** 	if (cmd != CMD12) {
 304              		.loc 1 275 2 is_stmt 1 view .LVU61
 305              		.loc 1 275 5 is_stmt 0 view .LVU62
 306 000e 0C2C     		cmp	r4, #12
 307 0010 05D0     		beq	.L27
 276:Core/Src/user_diskio_spi.c **** 		despiselect();
 308              		.loc 1 276 3 is_stmt 1 view .LVU63
 309 0012 FFF7FEFF 		bl	despiselect
 310              	.LVL22:
 277:Core/Src/user_diskio_spi.c **** 		if (!spiselect()) return 0xFF;
 311              		.loc 1 277 3 view .LVU64
 312              		.loc 1 277 8 is_stmt 0 view .LVU65
 313 0016 FFF7FEFF 		bl	spiselect
 314              	.LVL23:
 315              		.loc 1 277 6 discriminator 1 view .LVU66
 316 001a 0028     		cmp	r0, #0
 317 001c 53D0     		beq	.L33
 318              	.L27:
 278:Core/Src/user_diskio_spi.c **** 	}
 279:Core/Src/user_diskio_spi.c **** 
 280:Core/Src/user_diskio_spi.c **** 	/* Send command packet */
 281:Core/Src/user_diskio_spi.c **** 	xchg_spi(0x40 | cmd);				/* Start + command index */
 319              		.loc 1 281 2 is_stmt 1 view .LVU67
 320 001e 44F04000 		orr	r0, r4, #64
 321 0022 FFF7FEFF 		bl	xchg_spi
 322              	.LVL24:
 282:Core/Src/user_diskio_spi.c **** 	xchg_spi((BYTE)(arg >> 24));		/* Argument[31..24] */
 323              		.loc 1 282 2 view .LVU68
 324 0026 280E     		lsrs	r0, r5, #24
 325 0028 FFF7FEFF 		bl	xchg_spi
 326              	.LVL25:
 283:Core/Src/user_diskio_spi.c **** 	xchg_spi((BYTE)(arg >> 16));		/* Argument[23..16] */
 327              		.loc 1 283 2 view .LVU69
 328 002c C5F30740 		ubfx	r0, r5, #16, #8
 329 0030 FFF7FEFF 		bl	xchg_spi
 330              	.LVL26:
 284:Core/Src/user_diskio_spi.c **** 	xchg_spi((BYTE)(arg >> 8));			/* Argument[15..8] */
 331              		.loc 1 284 2 view .LVU70
 332 0034 C5F30720 		ubfx	r0, r5, #8, #8
 333 0038 FFF7FEFF 		bl	xchg_spi
 334              	.LVL27:
 285:Core/Src/user_diskio_spi.c **** 	xchg_spi((BYTE)arg);				/* Argument[7..0] */
 335              		.loc 1 285 2 view .LVU71
 336 003c E8B2     		uxtb	r0, r5
 337 003e FFF7FEFF 		bl	xchg_spi
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 12


 338              	.LVL28:
 286:Core/Src/user_diskio_spi.c **** 	n = 0x01;							/* Dummy CRC + Stop */
 339              		.loc 1 286 2 view .LVU72
 340              		.loc 1 286 4 is_stmt 0 view .LVU73
 341 0042 0123     		movs	r3, #1
 342 0044 8DF80730 		strb	r3, [sp, #7]
 287:Core/Src/user_diskio_spi.c **** 	if (cmd == CMD0) n = 0x95;			/* Valid CRC for CMD0(0) */
 343              		.loc 1 287 2 is_stmt 1 view .LVU74
 344              		.loc 1 287 5 is_stmt 0 view .LVU75
 345 0048 9CBB     		cbnz	r4, .L28
 346              		.loc 1 287 19 is_stmt 1 discriminator 1 view .LVU76
 347              		.loc 1 287 21 is_stmt 0 discriminator 1 view .LVU77
 348 004a 9523     		movs	r3, #149
 349 004c 8DF80730 		strb	r3, [sp, #7]
 288:Core/Src/user_diskio_spi.c **** 	if (cmd == CMD8) n = 0x87;			/* Valid CRC for CMD8(0x1AA) */
 350              		.loc 1 288 2 is_stmt 1 view .LVU78
 351              	.L29:
 289:Core/Src/user_diskio_spi.c **** 	xchg_spi(n);
 352              		.loc 1 289 2 view .LVU79
 353 0050 9DF80700 		ldrb	r0, [sp, #7]	@ zero_extendqisi2
 354 0054 FFF7FEFF 		bl	xchg_spi
 355              	.LVL29:
 290:Core/Src/user_diskio_spi.c **** 
 291:Core/Src/user_diskio_spi.c **** 	/* Receive command resp */
 292:Core/Src/user_diskio_spi.c **** 	if (cmd == CMD12) xchg_spi(0xFF);	/* Diacard following one byte when CMD12 */
 356              		.loc 1 292 2 view .LVU80
 357              		.loc 1 292 5 is_stmt 0 view .LVU81
 358 0058 0C2C     		cmp	r4, #12
 359 005a 30D0     		beq	.L36
 360              	.L30:
 293:Core/Src/user_diskio_spi.c **** 	n = 10;								/* Wait for response (10 bytes max) */
 361              		.loc 1 293 2 is_stmt 1 view .LVU82
 362              		.loc 1 293 4 is_stmt 0 view .LVU83
 363 005c 0A23     		movs	r3, #10
 364 005e 8DF80730 		strb	r3, [sp, #7]
 365              	.L32:
 294:Core/Src/user_diskio_spi.c **** 	do {
 366              		.loc 1 294 2 is_stmt 1 view .LVU84
 295:Core/Src/user_diskio_spi.c **** 		res = xchg_spi(0xFF);
 367              		.loc 1 295 3 view .LVU85
 368              		.loc 1 295 9 is_stmt 0 view .LVU86
 369 0062 FF20     		movs	r0, #255
 370 0064 FFF7FEFF 		bl	xchg_spi
 371              	.LVL30:
 372              		.loc 1 295 7 discriminator 1 view .LVU87
 373 0068 8DF80600 		strb	r0, [sp, #6]
 296:Core/Src/user_diskio_spi.c **** 	} while ((res & 0x80) && --n);
 374              		.loc 1 296 24 is_stmt 1 discriminator 2 view .LVU88
 375              		.loc 1 296 11 is_stmt 0 discriminator 2 view .LVU89
 376 006c 9DF80630 		ldrb	r3, [sp, #6]	@ zero_extendqisi2
 377              		.loc 1 296 24 discriminator 2 view .LVU90
 378 0070 13F0800F 		tst	r3, #128
 379 0074 07D0     		beq	.L31
 380              		.loc 1 296 27 discriminator 1 view .LVU91
 381 0076 9DF80730 		ldrb	r3, [sp, #7]	@ zero_extendqisi2
 382 007a 013B     		subs	r3, r3, #1
 383 007c DBB2     		uxtb	r3, r3
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 13


 384              		.loc 1 296 24 discriminator 1 view .LVU92
 385 007e 8DF80730 		strb	r3, [sp, #7]
 386 0082 002B     		cmp	r3, #0
 387 0084 EDD1     		bne	.L32
 388              	.L31:
 297:Core/Src/user_diskio_spi.c **** 
 298:Core/Src/user_diskio_spi.c **** 	return res;							/* Return received response */
 389              		.loc 1 298 2 is_stmt 1 view .LVU93
 390              		.loc 1 298 9 is_stmt 0 view .LVU94
 391 0086 9DF80600 		ldrb	r0, [sp, #6]	@ zero_extendqisi2
 392 008a C0B2     		uxtb	r0, r0
 393              	.L26:
 299:Core/Src/user_diskio_spi.c **** }
 394              		.loc 1 299 1 view .LVU95
 395 008c 03B0     		add	sp, sp, #12
 396              		.cfi_remember_state
 397              		.cfi_def_cfa_offset 12
 398              		@ sp needed
 399 008e 30BD     		pop	{r4, r5, pc}
 400              	.LVL31:
 401              	.L35:
 402              		.cfi_restore_state
 269:Core/Src/user_diskio_spi.c **** 		res = send_cmd(CMD55, 0);
 403              		.loc 1 269 3 is_stmt 1 view .LVU96
 269:Core/Src/user_diskio_spi.c **** 		res = send_cmd(CMD55, 0);
 404              		.loc 1 269 7 is_stmt 0 view .LVU97
 405 0090 00F07F04 		and	r4, r0, #127
 406              	.LVL32:
 270:Core/Src/user_diskio_spi.c **** 		if (res > 1) return res;
 407              		.loc 1 270 3 is_stmt 1 view .LVU98
 270:Core/Src/user_diskio_spi.c **** 		if (res > 1) return res;
 408              		.loc 1 270 9 is_stmt 0 view .LVU99
 409 0094 0021     		movs	r1, #0
 410              	.LVL33:
 270:Core/Src/user_diskio_spi.c **** 		if (res > 1) return res;
 411              		.loc 1 270 9 view .LVU100
 412 0096 3720     		movs	r0, #55
 413 0098 FFF7B2FF 		bl	send_cmd
 414              	.LVL34:
 270:Core/Src/user_diskio_spi.c **** 		if (res > 1) return res;
 415              		.loc 1 270 7 discriminator 1 view .LVU101
 416 009c 8DF80600 		strb	r0, [sp, #6]
 271:Core/Src/user_diskio_spi.c **** 	}
 417              		.loc 1 271 3 is_stmt 1 view .LVU102
 271:Core/Src/user_diskio_spi.c **** 	}
 418              		.loc 1 271 11 is_stmt 0 view .LVU103
 419 00a0 9DF80630 		ldrb	r3, [sp, #6]	@ zero_extendqisi2
 420 00a4 DBB2     		uxtb	r3, r3
 271:Core/Src/user_diskio_spi.c **** 	}
 421              		.loc 1 271 6 view .LVU104
 422 00a6 012B     		cmp	r3, #1
 423 00a8 B1D9     		bls	.L25
 271:Core/Src/user_diskio_spi.c **** 	}
 424              		.loc 1 271 16 is_stmt 1 discriminator 1 view .LVU105
 271:Core/Src/user_diskio_spi.c **** 	}
 425              		.loc 1 271 23 is_stmt 0 discriminator 1 view .LVU106
 426 00aa 9DF80600 		ldrb	r0, [sp, #6]	@ zero_extendqisi2
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 14


 427 00ae C0B2     		uxtb	r0, r0
 271:Core/Src/user_diskio_spi.c **** 	}
 428              		.loc 1 271 23 view .LVU107
 429 00b0 ECE7     		b	.L26
 430              	.L28:
 288:Core/Src/user_diskio_spi.c **** 	xchg_spi(n);
 431              		.loc 1 288 2 is_stmt 1 view .LVU108
 288:Core/Src/user_diskio_spi.c **** 	xchg_spi(n);
 432              		.loc 1 288 5 is_stmt 0 view .LVU109
 433 00b2 082C     		cmp	r4, #8
 434 00b4 CCD1     		bne	.L29
 288:Core/Src/user_diskio_spi.c **** 	xchg_spi(n);
 435              		.loc 1 288 19 is_stmt 1 discriminator 1 view .LVU110
 288:Core/Src/user_diskio_spi.c **** 	xchg_spi(n);
 436              		.loc 1 288 21 is_stmt 0 discriminator 1 view .LVU111
 437 00b6 8723     		movs	r3, #135
 438 00b8 8DF80730 		strb	r3, [sp, #7]
 439 00bc C8E7     		b	.L29
 440              	.L36:
 292:Core/Src/user_diskio_spi.c **** 	n = 10;								/* Wait for response (10 bytes max) */
 441              		.loc 1 292 20 is_stmt 1 discriminator 1 view .LVU112
 442 00be FF20     		movs	r0, #255
 443 00c0 FFF7FEFF 		bl	xchg_spi
 444              	.LVL35:
 445 00c4 CAE7     		b	.L30
 446              	.L33:
 277:Core/Src/user_diskio_spi.c **** 	}
 447              		.loc 1 277 28 is_stmt 0 discriminator 1 view .LVU113
 448 00c6 FF20     		movs	r0, #255
 449 00c8 E0E7     		b	.L26
 450              		.cfi_endproc
 451              	.LFE144:
 453              		.section	.text.xmit_spi_multi,"ax",%progbits
 454              		.align	1
 455              		.syntax unified
 456              		.thumb
 457              		.thumb_func
 459              	xmit_spi_multi:
 460              	.LVL36:
 461              	.LFB138:
 134:Core/Src/user_diskio_spi.c **** 	HAL_SPI_Transmit(&SD_SPI_HANDLE, buff, btx, HAL_MAX_DELAY);
 462              		.loc 1 134 1 is_stmt 1 view -0
 463              		.cfi_startproc
 464              		@ args = 0, pretend = 0, frame = 0
 465              		@ frame_needed = 0, uses_anonymous_args = 0
 134:Core/Src/user_diskio_spi.c **** 	HAL_SPI_Transmit(&SD_SPI_HANDLE, buff, btx, HAL_MAX_DELAY);
 466              		.loc 1 134 1 is_stmt 0 view .LVU115
 467 0000 08B5     		push	{r3, lr}
 468              		.cfi_def_cfa_offset 8
 469              		.cfi_offset 3, -8
 470              		.cfi_offset 14, -4
 135:Core/Src/user_diskio_spi.c **** }
 471              		.loc 1 135 2 is_stmt 1 view .LVU116
 472 0002 4FF0FF33 		mov	r3, #-1
 473 0006 8AB2     		uxth	r2, r1
 474 0008 0146     		mov	r1, r0
 475              	.LVL37:
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 15


 135:Core/Src/user_diskio_spi.c **** }
 476              		.loc 1 135 2 is_stmt 0 view .LVU117
 477 000a 0248     		ldr	r0, .L39
 478              	.LVL38:
 135:Core/Src/user_diskio_spi.c **** }
 479              		.loc 1 135 2 view .LVU118
 480 000c FFF7FEFF 		bl	HAL_SPI_Transmit
 481              	.LVL39:
 136:Core/Src/user_diskio_spi.c **** #endif
 482              		.loc 1 136 1 view .LVU119
 483 0010 08BD     		pop	{r3, pc}
 484              	.L40:
 485 0012 00BF     		.align	2
 486              	.L39:
 487 0014 00000000 		.word	hspi2
 488              		.cfi_endproc
 489              	.LFE138:
 491              		.section	.text.xmit_datablock,"ax",%progbits
 492              		.align	1
 493              		.syntax unified
 494              		.thumb
 495              		.thumb_func
 497              	xmit_datablock:
 498              	.LVL40:
 499              	.LFB143:
 236:Core/Src/user_diskio_spi.c **** 	BYTE resp;
 500              		.loc 1 236 1 is_stmt 1 view -0
 501              		.cfi_startproc
 502              		@ args = 0, pretend = 0, frame = 0
 503              		@ frame_needed = 0, uses_anonymous_args = 0
 236:Core/Src/user_diskio_spi.c **** 	BYTE resp;
 504              		.loc 1 236 1 is_stmt 0 view .LVU121
 505 0000 38B5     		push	{r3, r4, r5, lr}
 506              		.cfi_def_cfa_offset 16
 507              		.cfi_offset 3, -16
 508              		.cfi_offset 4, -12
 509              		.cfi_offset 5, -8
 510              		.cfi_offset 14, -4
 511 0002 0546     		mov	r5, r0
 512 0004 0C46     		mov	r4, r1
 237:Core/Src/user_diskio_spi.c **** 
 513              		.loc 1 237 2 is_stmt 1 view .LVU122
 240:Core/Src/user_diskio_spi.c **** 
 514              		.loc 1 240 2 view .LVU123
 240:Core/Src/user_diskio_spi.c **** 
 515              		.loc 1 240 7 is_stmt 0 view .LVU124
 516 0006 4FF4FA70 		mov	r0, #500
 517              	.LVL41:
 240:Core/Src/user_diskio_spi.c **** 
 518              		.loc 1 240 7 view .LVU125
 519 000a FFF7FEFF 		bl	wait_ready
 520              	.LVL42:
 240:Core/Src/user_diskio_spi.c **** 
 521              		.loc 1 240 5 discriminator 1 view .LVU126
 522 000e 00B9     		cbnz	r0, .L46
 523              	.L41:
 251:Core/Src/user_diskio_spi.c **** #endif
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 16


 524              		.loc 1 251 1 view .LVU127
 525 0010 38BD     		pop	{r3, r4, r5, pc}
 526              	.LVL43:
 527              	.L46:
 242:Core/Src/user_diskio_spi.c **** 	if (token != 0xFD) {				/* Send data if token is other than StopTran */
 528              		.loc 1 242 2 is_stmt 1 view .LVU128
 529 0012 2046     		mov	r0, r4
 530 0014 FFF7FEFF 		bl	xchg_spi
 531              	.LVL44:
 243:Core/Src/user_diskio_spi.c **** 		xmit_spi_multi(buff, 512);		/* Data */
 532              		.loc 1 243 2 view .LVU129
 243:Core/Src/user_diskio_spi.c **** 		xmit_spi_multi(buff, 512);		/* Data */
 533              		.loc 1 243 5 is_stmt 0 view .LVU130
 534 0018 FD2C     		cmp	r4, #253
 535 001a 01D1     		bne	.L47
 250:Core/Src/user_diskio_spi.c **** }
 536              		.loc 1 250 9 view .LVU131
 537 001c 0120     		movs	r0, #1
 538 001e F7E7     		b	.L41
 539              	.L47:
 244:Core/Src/user_diskio_spi.c **** 		xchg_spi(0xFF); xchg_spi(0xFF);	/* Dummy CRC */
 540              		.loc 1 244 3 is_stmt 1 view .LVU132
 541 0020 4FF40071 		mov	r1, #512
 542 0024 2846     		mov	r0, r5
 543 0026 FFF7FEFF 		bl	xmit_spi_multi
 544              	.LVL45:
 245:Core/Src/user_diskio_spi.c **** 
 545              		.loc 1 245 3 view .LVU133
 546 002a FF20     		movs	r0, #255
 547 002c FFF7FEFF 		bl	xchg_spi
 548              	.LVL46:
 245:Core/Src/user_diskio_spi.c **** 
 549              		.loc 1 245 19 discriminator 1 view .LVU134
 550 0030 FF20     		movs	r0, #255
 551 0032 FFF7FEFF 		bl	xchg_spi
 552              	.LVL47:
 247:Core/Src/user_diskio_spi.c **** 		if ((resp & 0x1F) != 0x05) return 0;	/* Function fails if the data packet was not accepted */
 553              		.loc 1 247 3 view .LVU135
 247:Core/Src/user_diskio_spi.c **** 		if ((resp & 0x1F) != 0x05) return 0;	/* Function fails if the data packet was not accepted */
 554              		.loc 1 247 10 is_stmt 0 view .LVU136
 555 0036 FF20     		movs	r0, #255
 556 0038 FFF7FEFF 		bl	xchg_spi
 557              	.LVL48:
 248:Core/Src/user_diskio_spi.c **** 	}
 558              		.loc 1 248 3 is_stmt 1 view .LVU137
 248:Core/Src/user_diskio_spi.c **** 	}
 559              		.loc 1 248 6 is_stmt 0 view .LVU138
 560 003c 00F01F00 		and	r0, r0, #31
 561              	.LVL49:
 248:Core/Src/user_diskio_spi.c **** 	}
 562              		.loc 1 248 6 view .LVU139
 563 0040 0528     		cmp	r0, #5
 564 0042 01D1     		bne	.L44
 250:Core/Src/user_diskio_spi.c **** }
 565              		.loc 1 250 9 view .LVU140
 566 0044 0120     		movs	r0, #1
 567 0046 E3E7     		b	.L41
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 17


 568              	.L44:
 248:Core/Src/user_diskio_spi.c **** 	}
 569              		.loc 1 248 37 discriminator 1 view .LVU141
 570 0048 0020     		movs	r0, #0
 571 004a E1E7     		b	.L41
 572              		.cfi_endproc
 573              	.LFE143:
 575              		.section	.text.SPI_Timer_On,"ax",%progbits
 576              		.align	1
 577              		.global	SPI_Timer_On
 578              		.syntax unified
 579              		.thumb
 580              		.thumb_func
 582              	SPI_Timer_On:
 583              	.LVL50:
 584              	.LFB134:
  89:Core/Src/user_diskio_spi.c ****     spiTimerTickStart = HAL_GetTick();
 585              		.loc 1 89 39 is_stmt 1 view -0
 586              		.cfi_startproc
 587              		@ args = 0, pretend = 0, frame = 0
 588              		@ frame_needed = 0, uses_anonymous_args = 0
  89:Core/Src/user_diskio_spi.c ****     spiTimerTickStart = HAL_GetTick();
 589              		.loc 1 89 39 is_stmt 0 view .LVU143
 590 0000 10B5     		push	{r4, lr}
 591              		.cfi_def_cfa_offset 8
 592              		.cfi_offset 4, -8
 593              		.cfi_offset 14, -4
 594 0002 0446     		mov	r4, r0
  90:Core/Src/user_diskio_spi.c ****     spiTimerTickDelay = waitTicks;
 595              		.loc 1 90 5 is_stmt 1 view .LVU144
  90:Core/Src/user_diskio_spi.c ****     spiTimerTickDelay = waitTicks;
 596              		.loc 1 90 25 is_stmt 0 view .LVU145
 597 0004 FFF7FEFF 		bl	HAL_GetTick
 598              	.LVL51:
  90:Core/Src/user_diskio_spi.c ****     spiTimerTickDelay = waitTicks;
 599              		.loc 1 90 23 discriminator 1 view .LVU146
 600 0008 024B     		ldr	r3, .L50
 601 000a 1860     		str	r0, [r3]
  91:Core/Src/user_diskio_spi.c **** }
 602              		.loc 1 91 5 is_stmt 1 view .LVU147
  91:Core/Src/user_diskio_spi.c **** }
 603              		.loc 1 91 23 is_stmt 0 view .LVU148
 604 000c 024B     		ldr	r3, .L50+4
 605 000e 1C60     		str	r4, [r3]
  92:Core/Src/user_diskio_spi.c **** 
 606              		.loc 1 92 1 view .LVU149
 607 0010 10BD     		pop	{r4, pc}
 608              	.LVL52:
 609              	.L51:
  92:Core/Src/user_diskio_spi.c **** 
 610              		.loc 1 92 1 view .LVU150
 611 0012 00BF     		.align	2
 612              	.L50:
 613 0014 00000000 		.word	spiTimerTickStart
 614 0018 00000000 		.word	spiTimerTickDelay
 615              		.cfi_endproc
 616              	.LFE134:
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 18


 618              		.section	.text.SPI_Timer_Status,"ax",%progbits
 619              		.align	1
 620              		.global	SPI_Timer_Status
 621              		.syntax unified
 622              		.thumb
 623              		.thumb_func
 625              	SPI_Timer_Status:
 626              	.LFB135:
  94:Core/Src/user_diskio_spi.c ****     return ((HAL_GetTick() - spiTimerTickStart) < spiTimerTickDelay);
 627              		.loc 1 94 28 is_stmt 1 view -0
 628              		.cfi_startproc
 629              		@ args = 0, pretend = 0, frame = 0
 630              		@ frame_needed = 0, uses_anonymous_args = 0
 631 0000 08B5     		push	{r3, lr}
 632              		.cfi_def_cfa_offset 8
 633              		.cfi_offset 3, -8
 634              		.cfi_offset 14, -4
  95:Core/Src/user_diskio_spi.c **** }
 635              		.loc 1 95 5 view .LVU152
  95:Core/Src/user_diskio_spi.c **** }
 636              		.loc 1 95 14 is_stmt 0 view .LVU153
 637 0002 FFF7FEFF 		bl	HAL_GetTick
 638              	.LVL53:
  95:Core/Src/user_diskio_spi.c **** }
 639              		.loc 1 95 28 discriminator 1 view .LVU154
 640 0006 054B     		ldr	r3, .L54
 641 0008 1B68     		ldr	r3, [r3]
 642 000a C01A     		subs	r0, r0, r3
  95:Core/Src/user_diskio_spi.c **** }
 643              		.loc 1 95 49 discriminator 1 view .LVU155
 644 000c 044B     		ldr	r3, .L54+4
 645 000e 1B68     		ldr	r3, [r3]
  96:Core/Src/user_diskio_spi.c **** 
 646              		.loc 1 96 1 view .LVU156
 647 0010 9842     		cmp	r0, r3
 648 0012 2CBF     		ite	cs
 649 0014 0020     		movcs	r0, #0
 650 0016 0120     		movcc	r0, #1
 651 0018 08BD     		pop	{r3, pc}
 652              	.L55:
 653 001a 00BF     		.align	2
 654              	.L54:
 655 001c 00000000 		.word	spiTimerTickStart
 656 0020 00000000 		.word	spiTimerTickDelay
 657              		.cfi_endproc
 658              	.LFE135:
 660              		.section	.text.rcvr_datablock,"ax",%progbits
 661              		.align	1
 662              		.syntax unified
 663              		.thumb
 664              		.thumb_func
 666              	rcvr_datablock:
 667              	.LVL54:
 668              	.LFB142:
 207:Core/Src/user_diskio_spi.c **** 	BYTE token;
 669              		.loc 1 207 1 is_stmt 1 view -0
 670              		.cfi_startproc
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 19


 671              		@ args = 0, pretend = 0, frame = 0
 672              		@ frame_needed = 0, uses_anonymous_args = 0
 207:Core/Src/user_diskio_spi.c **** 	BYTE token;
 673              		.loc 1 207 1 is_stmt 0 view .LVU158
 674 0000 70B5     		push	{r4, r5, r6, lr}
 675              		.cfi_def_cfa_offset 16
 676              		.cfi_offset 4, -16
 677              		.cfi_offset 5, -12
 678              		.cfi_offset 6, -8
 679              		.cfi_offset 14, -4
 680 0002 0546     		mov	r5, r0
 681 0004 0E46     		mov	r6, r1
 208:Core/Src/user_diskio_spi.c **** 
 682              		.loc 1 208 2 is_stmt 1 view .LVU159
 211:Core/Src/user_diskio_spi.c **** 	do {							/* Wait for DataStart token in timeout of 200ms */
 683              		.loc 1 211 2 view .LVU160
 684 0006 C820     		movs	r0, #200
 685              	.LVL55:
 211:Core/Src/user_diskio_spi.c **** 	do {							/* Wait for DataStart token in timeout of 200ms */
 686              		.loc 1 211 2 is_stmt 0 view .LVU161
 687 0008 FFF7FEFF 		bl	SPI_Timer_On
 688              	.LVL56:
 689              	.L58:
 212:Core/Src/user_diskio_spi.c **** 		token = xchg_spi(0xFF);
 690              		.loc 1 212 2 is_stmt 1 view .LVU162
 213:Core/Src/user_diskio_spi.c **** 		/* This loop will take a time. Insert rot_rdq() here for multitask envilonment. */
 691              		.loc 1 213 3 view .LVU163
 213:Core/Src/user_diskio_spi.c **** 		/* This loop will take a time. Insert rot_rdq() here for multitask envilonment. */
 692              		.loc 1 213 11 is_stmt 0 view .LVU164
 693 000c FF20     		movs	r0, #255
 694 000e FFF7FEFF 		bl	xchg_spi
 695              	.LVL57:
 696 0012 0446     		mov	r4, r0
 697              	.LVL58:
 215:Core/Src/user_diskio_spi.c **** 	if(token != 0xFE) return 0;		/* Function fails if invalid DataStart token or timeout */
 698              		.loc 1 215 27 is_stmt 1 discriminator 2 view .LVU165
 699 0014 FF28     		cmp	r0, #255
 700 0016 03D1     		bne	.L57
 215:Core/Src/user_diskio_spi.c **** 	if(token != 0xFE) return 0;		/* Function fails if invalid DataStart token or timeout */
 701              		.loc 1 215 30 is_stmt 0 discriminator 1 view .LVU166
 702 0018 FFF7FEFF 		bl	SPI_Timer_Status
 703              	.LVL59:
 215:Core/Src/user_diskio_spi.c **** 	if(token != 0xFE) return 0;		/* Function fails if invalid DataStart token or timeout */
 704              		.loc 1 215 27 discriminator 1 view .LVU167
 705 001c 0028     		cmp	r0, #0
 706 001e F5D1     		bne	.L58
 707              	.L57:
 216:Core/Src/user_diskio_spi.c **** 
 708              		.loc 1 216 2 is_stmt 1 view .LVU168
 216:Core/Src/user_diskio_spi.c **** 
 709              		.loc 1 216 4 is_stmt 0 view .LVU169
 710 0020 FE2C     		cmp	r4, #254
 711 0022 01D0     		beq	.L62
 216:Core/Src/user_diskio_spi.c **** 
 712              		.loc 1 216 27 discriminator 1 view .LVU170
 713 0024 0020     		movs	r0, #0
 714              	.L56:
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 20


 222:Core/Src/user_diskio_spi.c **** 
 715              		.loc 1 222 1 view .LVU171
 716 0026 70BD     		pop	{r4, r5, r6, pc}
 717              	.LVL60:
 718              	.L62:
 218:Core/Src/user_diskio_spi.c **** 	xchg_spi(0xFF); xchg_spi(0xFF);			/* Discard CRC */
 719              		.loc 1 218 2 is_stmt 1 view .LVU172
 720 0028 3146     		mov	r1, r6
 721 002a 2846     		mov	r0, r5
 722 002c FFF7FEFF 		bl	rcvr_spi_multi
 723              	.LVL61:
 219:Core/Src/user_diskio_spi.c **** 
 724              		.loc 1 219 2 view .LVU173
 725 0030 FF20     		movs	r0, #255
 726 0032 FFF7FEFF 		bl	xchg_spi
 727              	.LVL62:
 219:Core/Src/user_diskio_spi.c **** 
 728              		.loc 1 219 18 discriminator 1 view .LVU174
 729 0036 FF20     		movs	r0, #255
 730 0038 FFF7FEFF 		bl	xchg_spi
 731              	.LVL63:
 221:Core/Src/user_diskio_spi.c **** }
 732              		.loc 1 221 2 view .LVU175
 221:Core/Src/user_diskio_spi.c **** }
 733              		.loc 1 221 9 is_stmt 0 view .LVU176
 734 003c 0120     		movs	r0, #1
 735 003e F2E7     		b	.L56
 736              		.cfi_endproc
 737              	.LFE142:
 739              		.section	.text.USER_SPI_initialize,"ax",%progbits
 740              		.align	1
 741              		.global	USER_SPI_initialize
 742              		.syntax unified
 743              		.thumb
 744              		.thumb_func
 746              	USER_SPI_initialize:
 747              	.LVL64:
 748              	.LFB145:
 300:Core/Src/user_diskio_spi.c **** 
 301:Core/Src/user_diskio_spi.c **** 
 302:Core/Src/user_diskio_spi.c **** /*--------------------------------------------------------------------------
 303:Core/Src/user_diskio_spi.c **** 
 304:Core/Src/user_diskio_spi.c ****    Public FatFs Functions (wrapped in user_diskio.c)
 305:Core/Src/user_diskio_spi.c **** 
 306:Core/Src/user_diskio_spi.c **** ---------------------------------------------------------------------------*/
 307:Core/Src/user_diskio_spi.c **** 
 308:Core/Src/user_diskio_spi.c **** //The following functions are defined as inline because they aren't the functions that
 309:Core/Src/user_diskio_spi.c **** //are passed to FatFs - they are wrapped by autogenerated (non-inline) cubemx template
 310:Core/Src/user_diskio_spi.c **** //code.
 311:Core/Src/user_diskio_spi.c **** //If you do not wish to use cubemx, remove the "inline" from these functions here
 312:Core/Src/user_diskio_spi.c **** //and in the associated .h
 313:Core/Src/user_diskio_spi.c **** 
 314:Core/Src/user_diskio_spi.c **** 
 315:Core/Src/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 316:Core/Src/user_diskio_spi.c **** /* Initialize disk drive                                                 */
 317:Core/Src/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 318:Core/Src/user_diskio_spi.c **** 
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 21


 319:Core/Src/user_diskio_spi.c **** inline DSTATUS USER_SPI_initialize (
 320:Core/Src/user_diskio_spi.c **** 	BYTE drv		/* Physical drive number (0) */
 321:Core/Src/user_diskio_spi.c **** )
 322:Core/Src/user_diskio_spi.c **** {
 749              		.loc 1 322 1 is_stmt 1 view -0
 750              		.cfi_startproc
 751              		@ args = 0, pretend = 0, frame = 8
 752              		@ frame_needed = 0, uses_anonymous_args = 0
 323:Core/Src/user_diskio_spi.c **** 	BYTE n, cmd, ty, ocr[4];
 753              		.loc 1 323 2 view .LVU178
 324:Core/Src/user_diskio_spi.c **** 
 325:Core/Src/user_diskio_spi.c **** 	if (drv != 0) return STA_NOINIT;		/* Supports only drive 0 */
 754              		.loc 1 325 2 view .LVU179
 755              		.loc 1 325 5 is_stmt 0 view .LVU180
 756 0000 0028     		cmp	r0, #0
 757 0002 40F0AD80 		bne	.L81
 326:Core/Src/user_diskio_spi.c **** 	//assume SPI already init init_spi();	/* Initialize SPI */
 327:Core/Src/user_diskio_spi.c **** 
 328:Core/Src/user_diskio_spi.c **** 	if (Stat & STA_NODISK) return Stat;	/* Is card existing in the soket? */
 758              		.loc 1 328 2 is_stmt 1 view .LVU181
 759              		.loc 1 328 11 is_stmt 0 view .LVU182
 760 0006 574B     		ldr	r3, .L97
 761 0008 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 762              		.loc 1 328 5 view .LVU183
 763 000a 13F0020F 		tst	r3, #2
 764 000e 0BD1     		bne	.L91
 322:Core/Src/user_diskio_spi.c **** 	BYTE n, cmd, ty, ocr[4];
 765              		.loc 1 322 1 view .LVU184
 766 0010 70B5     		push	{r4, r5, r6, lr}
 767              		.cfi_def_cfa_offset 16
 768              		.cfi_offset 4, -16
 769              		.cfi_offset 5, -12
 770              		.cfi_offset 6, -8
 771              		.cfi_offset 14, -4
 772 0012 82B0     		sub	sp, sp, #8
 773              		.cfi_def_cfa_offset 24
 329:Core/Src/user_diskio_spi.c **** 
 330:Core/Src/user_diskio_spi.c **** 	FCLK_SLOW();
 774              		.loc 1 330 2 is_stmt 1 view .LVU185
 775 0014 544B     		ldr	r3, .L97+4
 776 0016 1A68     		ldr	r2, [r3]
 777 0018 1368     		ldr	r3, [r2]
 778 001a 23F03803 		bic	r3, r3, #56
 779 001e 43F03003 		orr	r3, r3, #48
 780 0022 1360     		str	r3, [r2]
 781              		.loc 1 330 13 view .LVU186
 331:Core/Src/user_diskio_spi.c **** 	for (n = 10; n; n--) xchg_spi(0xFF);	/* Send 80 dummy clocks */
 782              		.loc 1 331 2 view .LVU187
 783              	.LVL65:
 784              		.loc 1 331 9 is_stmt 0 view .LVU188
 785 0024 0A24     		movs	r4, #10
 786              		.loc 1 331 2 view .LVU189
 787 0026 08E0     		b	.L66
 788              	.LVL66:
 789              	.L91:
 790              		.cfi_def_cfa_offset 0
 791              		.cfi_restore 4
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 22


 792              		.cfi_restore 5
 793              		.cfi_restore 6
 794              		.cfi_restore 14
 328:Core/Src/user_diskio_spi.c **** 
 795              		.loc 1 328 25 is_stmt 1 discriminator 1 view .LVU190
 328:Core/Src/user_diskio_spi.c **** 
 796              		.loc 1 328 32 is_stmt 0 discriminator 1 view .LVU191
 797 0028 4E4B     		ldr	r3, .L97
 798 002a 1878     		ldrb	r0, [r3]	@ zero_extendqisi2
 799              	.LVL67:
 328:Core/Src/user_diskio_spi.c **** 
 800              		.loc 1 328 32 discriminator 1 view .LVU192
 801 002c C0B2     		uxtb	r0, r0
 328:Core/Src/user_diskio_spi.c **** 
 802              		.loc 1 328 32 view .LVU193
 803 002e 7047     		bx	lr
 804              	.LVL68:
 805              	.L67:
 806              		.cfi_def_cfa_offset 24
 807              		.cfi_offset 4, -16
 808              		.cfi_offset 5, -12
 809              		.cfi_offset 6, -8
 810              		.cfi_offset 14, -4
 811              		.loc 1 331 23 is_stmt 1 discriminator 3 view .LVU194
 812 0030 FF20     		movs	r0, #255
 813 0032 FFF7FEFF 		bl	xchg_spi
 814              	.LVL69:
 815              		.loc 1 331 19 discriminator 3 view .LVU195
 816 0036 013C     		subs	r4, r4, #1
 817              	.LVL70:
 818              		.loc 1 331 19 is_stmt 0 discriminator 3 view .LVU196
 819 0038 E4B2     		uxtb	r4, r4
 820              	.LVL71:
 821              	.L66:
 822              		.loc 1 331 15 is_stmt 1 discriminator 2 view .LVU197
 823 003a 002C     		cmp	r4, #0
 824 003c F8D1     		bne	.L67
 332:Core/Src/user_diskio_spi.c **** 
 333:Core/Src/user_diskio_spi.c **** 	ty = 0;
 825              		.loc 1 333 2 view .LVU198
 826              	.LVL72:
 334:Core/Src/user_diskio_spi.c **** 	if (send_cmd(CMD0, 0) == 1) {			/* Put the card SPI/Idle state */
 827              		.loc 1 334 2 view .LVU199
 828              		.loc 1 334 6 is_stmt 0 view .LVU200
 829 003e 0021     		movs	r1, #0
 830 0040 0846     		mov	r0, r1
 831 0042 FFF7FEFF 		bl	send_cmd
 832              	.LVL73:
 833 0046 0546     		mov	r5, r0
 834              		.loc 1 334 5 discriminator 1 view .LVU201
 835 0048 0128     		cmp	r0, #1
 836 004a 17D0     		beq	.L92
 837              	.LVL74:
 838              	.L68:
 335:Core/Src/user_diskio_spi.c **** 		SPI_Timer_On(1000);					/* Initialization timeout = 1 sec */
 336:Core/Src/user_diskio_spi.c **** 		if (send_cmd(CMD8, 0x1AA) == 1) {	/* SDv2? */
 337:Core/Src/user_diskio_spi.c **** 			for (n = 0; n < 4; n++) ocr[n] = xchg_spi(0xFF);	/* Get 32 bit return value of R7 resp */
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 23


 338:Core/Src/user_diskio_spi.c **** 			if (ocr[2] == 0x01 && ocr[3] == 0xAA) {				/* Is the card supports vcc of 2.7-3.6V? */
 339:Core/Src/user_diskio_spi.c **** 				while (SPI_Timer_Status() && send_cmd(ACMD41, 1UL << 30)) ;	/* Wait for end of initialization w
 340:Core/Src/user_diskio_spi.c **** 				if (SPI_Timer_Status() && send_cmd(CMD58, 0) == 0) {		/* Check CCS bit in the OCR */
 341:Core/Src/user_diskio_spi.c **** 					for (n = 0; n < 4; n++) ocr[n] = xchg_spi(0xFF);
 342:Core/Src/user_diskio_spi.c **** 					ty = (ocr[0] & 0x40) ? CT_SD2 | CT_BLOCK : CT_SD2;	/* Card id SDv2 */
 343:Core/Src/user_diskio_spi.c **** 				}
 344:Core/Src/user_diskio_spi.c **** 			}
 345:Core/Src/user_diskio_spi.c **** 		} else {	/* Not SDv2 card */
 346:Core/Src/user_diskio_spi.c **** 			if (send_cmd(ACMD41, 0) <= 1) 	{	/* SDv1 or MMC? */
 347:Core/Src/user_diskio_spi.c **** 				ty = CT_SD1; cmd = ACMD41;	/* SDv1 (ACMD41(0)) */
 348:Core/Src/user_diskio_spi.c **** 			} else {
 349:Core/Src/user_diskio_spi.c **** 				ty = CT_MMC; cmd = CMD1;	/* MMCv3 (CMD1(0)) */
 350:Core/Src/user_diskio_spi.c **** 			}
 351:Core/Src/user_diskio_spi.c **** 			while (SPI_Timer_Status() && send_cmd(cmd, 0)) ;		/* Wait for end of initialization */
 352:Core/Src/user_diskio_spi.c **** 			if (!SPI_Timer_Status() || send_cmd(CMD16, 512) != 0)	/* Set block length: 512 */
 353:Core/Src/user_diskio_spi.c **** 				ty = 0;
 354:Core/Src/user_diskio_spi.c **** 		}
 355:Core/Src/user_diskio_spi.c **** 	}
 356:Core/Src/user_diskio_spi.c **** 	CardType = ty;	/* Card type */
 839              		.loc 1 356 2 is_stmt 1 view .LVU202
 840              		.loc 1 356 11 is_stmt 0 view .LVU203
 841 004c 474B     		ldr	r3, .L97+8
 842 004e 1C70     		strb	r4, [r3]
 357:Core/Src/user_diskio_spi.c **** 	despiselect();
 843              		.loc 1 357 2 is_stmt 1 view .LVU204
 844 0050 FFF7FEFF 		bl	despiselect
 845              	.LVL75:
 358:Core/Src/user_diskio_spi.c **** 
 359:Core/Src/user_diskio_spi.c **** 	if (ty) {			/* OK */
 846              		.loc 1 359 2 view .LVU205
 847              		.loc 1 359 5 is_stmt 0 view .LVU206
 848 0054 002C     		cmp	r4, #0
 849 0056 7FD0     		beq	.L79
 360:Core/Src/user_diskio_spi.c **** 		FCLK_FAST();			/* Set fast clock */
 850              		.loc 1 360 3 is_stmt 1 view .LVU207
 851 0058 434B     		ldr	r3, .L97+4
 852 005a 1A68     		ldr	r2, [r3]
 853 005c 1368     		ldr	r3, [r2]
 854 005e 23F03803 		bic	r3, r3, #56
 855 0062 43F01003 		orr	r3, r3, #16
 856 0066 1360     		str	r3, [r2]
 857              		.loc 1 360 14 view .LVU208
 361:Core/Src/user_diskio_spi.c **** 		Stat &= ~STA_NOINIT;	/* Clear STA_NOINIT flag */
 858              		.loc 1 361 3 view .LVU209
 859              		.loc 1 361 8 is_stmt 0 view .LVU210
 860 0068 3E4A     		ldr	r2, .L97
 861 006a 1378     		ldrb	r3, [r2]	@ zero_extendqisi2
 862 006c 03F0FE03 		and	r3, r3, #254
 863 0070 1370     		strb	r3, [r2]
 864              	.L80:
 362:Core/Src/user_diskio_spi.c **** 	} else {			/* Failed */
 363:Core/Src/user_diskio_spi.c **** 		Stat = STA_NOINIT;
 364:Core/Src/user_diskio_spi.c **** 	}
 365:Core/Src/user_diskio_spi.c **** 
 366:Core/Src/user_diskio_spi.c **** 	return Stat;
 865              		.loc 1 366 2 is_stmt 1 view .LVU211
 866              		.loc 1 366 9 is_stmt 0 view .LVU212
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 24


 867 0072 3C4B     		ldr	r3, .L97
 868 0074 1878     		ldrb	r0, [r3]	@ zero_extendqisi2
 869 0076 C0B2     		uxtb	r0, r0
 367:Core/Src/user_diskio_spi.c **** }
 870              		.loc 1 367 1 view .LVU213
 871 0078 02B0     		add	sp, sp, #8
 872              		.cfi_remember_state
 873              		.cfi_def_cfa_offset 16
 874              		@ sp needed
 875 007a 70BD     		pop	{r4, r5, r6, pc}
 876              	.LVL76:
 877              	.L92:
 878              		.cfi_restore_state
 335:Core/Src/user_diskio_spi.c **** 		if (send_cmd(CMD8, 0x1AA) == 1) {	/* SDv2? */
 879              		.loc 1 335 3 is_stmt 1 view .LVU214
 880 007c 4FF47A70 		mov	r0, #1000
 881 0080 FFF7FEFF 		bl	SPI_Timer_On
 882              	.LVL77:
 336:Core/Src/user_diskio_spi.c **** 			for (n = 0; n < 4; n++) ocr[n] = xchg_spi(0xFF);	/* Get 32 bit return value of R7 resp */
 883              		.loc 1 336 3 view .LVU215
 336:Core/Src/user_diskio_spi.c **** 			for (n = 0; n < 4; n++) ocr[n] = xchg_spi(0xFF);	/* Get 32 bit return value of R7 resp */
 884              		.loc 1 336 7 is_stmt 0 view .LVU216
 885 0084 4FF4D571 		mov	r1, #426
 886 0088 0820     		movs	r0, #8
 887 008a FFF7FEFF 		bl	send_cmd
 888              	.LVL78:
 336:Core/Src/user_diskio_spi.c **** 			for (n = 0; n < 4; n++) ocr[n] = xchg_spi(0xFF);	/* Get 32 bit return value of R7 resp */
 889              		.loc 1 336 6 discriminator 1 view .LVU217
 890 008e 0128     		cmp	r0, #1
 891 0090 3ED1     		bne	.L93
 337:Core/Src/user_diskio_spi.c **** 			if (ocr[2] == 0x01 && ocr[3] == 0xAA) {				/* Is the card supports vcc of 2.7-3.6V? */
 892              		.loc 1 337 11 view .LVU218
 893 0092 2546     		mov	r5, r4
 894 0094 09E0     		b	.L69
 895              	.LVL79:
 896              	.L71:
 337:Core/Src/user_diskio_spi.c **** 			if (ocr[2] == 0x01 && ocr[3] == 0xAA) {				/* Is the card supports vcc of 2.7-3.6V? */
 897              		.loc 1 337 28 is_stmt 1 discriminator 3 view .LVU219
 337:Core/Src/user_diskio_spi.c **** 			if (ocr[2] == 0x01 && ocr[3] == 0xAA) {				/* Is the card supports vcc of 2.7-3.6V? */
 898              		.loc 1 337 37 is_stmt 0 discriminator 3 view .LVU220
 899 0096 FF20     		movs	r0, #255
 900 0098 FFF7FEFF 		bl	xchg_spi
 901              	.LVL80:
 337:Core/Src/user_diskio_spi.c **** 			if (ocr[2] == 0x01 && ocr[3] == 0xAA) {				/* Is the card supports vcc of 2.7-3.6V? */
 902              		.loc 1 337 35 discriminator 3 view .LVU221
 903 009c 05F10803 		add	r3, r5, #8
 904 00a0 6B44     		add	r3, sp, r3
 905 00a2 03F8040C 		strb	r0, [r3, #-4]
 337:Core/Src/user_diskio_spi.c **** 			if (ocr[2] == 0x01 && ocr[3] == 0xAA) {				/* Is the card supports vcc of 2.7-3.6V? */
 906              		.loc 1 337 24 is_stmt 1 discriminator 3 view .LVU222
 907 00a6 0135     		adds	r5, r5, #1
 908              	.LVL81:
 337:Core/Src/user_diskio_spi.c **** 			if (ocr[2] == 0x01 && ocr[3] == 0xAA) {				/* Is the card supports vcc of 2.7-3.6V? */
 909              		.loc 1 337 24 is_stmt 0 discriminator 3 view .LVU223
 910 00a8 EDB2     		uxtb	r5, r5
 911              	.LVL82:
 912              	.L69:
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 25


 337:Core/Src/user_diskio_spi.c **** 			if (ocr[2] == 0x01 && ocr[3] == 0xAA) {				/* Is the card supports vcc of 2.7-3.6V? */
 913              		.loc 1 337 18 is_stmt 1 discriminator 2 view .LVU224
 914 00aa 032D     		cmp	r5, #3
 915 00ac F3D9     		bls	.L71
 338:Core/Src/user_diskio_spi.c **** 				while (SPI_Timer_Status() && send_cmd(ACMD41, 1UL << 30)) ;	/* Wait for end of initialization w
 916              		.loc 1 338 4 view .LVU225
 338:Core/Src/user_diskio_spi.c **** 				while (SPI_Timer_Status() && send_cmd(ACMD41, 1UL << 30)) ;	/* Wait for end of initialization w
 917              		.loc 1 338 11 is_stmt 0 view .LVU226
 918 00ae 9DF80630 		ldrb	r3, [sp, #6]	@ zero_extendqisi2
 338:Core/Src/user_diskio_spi.c **** 				while (SPI_Timer_Status() && send_cmd(ACMD41, 1UL << 30)) ;	/* Wait for end of initialization w
 919              		.loc 1 338 7 view .LVU227
 920 00b2 012B     		cmp	r3, #1
 921 00b4 CAD1     		bne	.L68
 338:Core/Src/user_diskio_spi.c **** 				while (SPI_Timer_Status() && send_cmd(ACMD41, 1UL << 30)) ;	/* Wait for end of initialization w
 922              		.loc 1 338 29 discriminator 1 view .LVU228
 923 00b6 9DF80730 		ldrb	r3, [sp, #7]	@ zero_extendqisi2
 338:Core/Src/user_diskio_spi.c **** 				while (SPI_Timer_Status() && send_cmd(ACMD41, 1UL << 30)) ;	/* Wait for end of initialization w
 924              		.loc 1 338 23 discriminator 1 view .LVU229
 925 00ba AA2B     		cmp	r3, #170
 926 00bc C6D1     		bne	.L68
 927              	.L73:
 339:Core/Src/user_diskio_spi.c **** 				if (SPI_Timer_Status() && send_cmd(CMD58, 0) == 0) {		/* Check CCS bit in the OCR */
 928              		.loc 1 339 31 is_stmt 1 discriminator 2 view .LVU230
 339:Core/Src/user_diskio_spi.c **** 				if (SPI_Timer_Status() && send_cmd(CMD58, 0) == 0) {		/* Check CCS bit in the OCR */
 929              		.loc 1 339 12 is_stmt 0 discriminator 2 view .LVU231
 930 00be FFF7FEFF 		bl	SPI_Timer_Status
 931              	.LVL83:
 339:Core/Src/user_diskio_spi.c **** 				if (SPI_Timer_Status() && send_cmd(CMD58, 0) == 0) {		/* Check CCS bit in the OCR */
 932              		.loc 1 339 31 discriminator 2 view .LVU232
 933 00c2 30B1     		cbz	r0, .L72
 339:Core/Src/user_diskio_spi.c **** 				if (SPI_Timer_Status() && send_cmd(CMD58, 0) == 0) {		/* Check CCS bit in the OCR */
 934              		.loc 1 339 34 discriminator 1 view .LVU233
 935 00c4 4FF08041 		mov	r1, #1073741824
 936 00c8 A920     		movs	r0, #169
 937 00ca FFF7FEFF 		bl	send_cmd
 938              	.LVL84:
 339:Core/Src/user_diskio_spi.c **** 				if (SPI_Timer_Status() && send_cmd(CMD58, 0) == 0) {		/* Check CCS bit in the OCR */
 939              		.loc 1 339 31 discriminator 1 view .LVU234
 940 00ce 0028     		cmp	r0, #0
 941 00d0 F5D1     		bne	.L73
 942              	.L72:
 340:Core/Src/user_diskio_spi.c **** 					for (n = 0; n < 4; n++) ocr[n] = xchg_spi(0xFF);
 943              		.loc 1 340 5 is_stmt 1 view .LVU235
 340:Core/Src/user_diskio_spi.c **** 					for (n = 0; n < 4; n++) ocr[n] = xchg_spi(0xFF);
 944              		.loc 1 340 9 is_stmt 0 view .LVU236
 945 00d2 FFF7FEFF 		bl	SPI_Timer_Status
 946              	.LVL85:
 340:Core/Src/user_diskio_spi.c **** 					for (n = 0; n < 4; n++) ocr[n] = xchg_spi(0xFF);
 947              		.loc 1 340 8 discriminator 1 view .LVU237
 948 00d6 08B9     		cbnz	r0, .L94
 333:Core/Src/user_diskio_spi.c **** 	if (send_cmd(CMD0, 0) == 1) {			/* Put the card SPI/Idle state */
 949              		.loc 1 333 5 view .LVU238
 950 00d8 0446     		mov	r4, r0
 951 00da B7E7     		b	.L68
 952              	.L94:
 340:Core/Src/user_diskio_spi.c **** 					for (n = 0; n < 4; n++) ocr[n] = xchg_spi(0xFF);
 953              		.loc 1 340 31 discriminator 1 view .LVU239
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 26


 954 00dc 0021     		movs	r1, #0
 955 00de 3A20     		movs	r0, #58
 956 00e0 FFF7FEFF 		bl	send_cmd
 957              	.LVL86:
 340:Core/Src/user_diskio_spi.c **** 					for (n = 0; n < 4; n++) ocr[n] = xchg_spi(0xFF);
 958              		.loc 1 340 28 discriminator 1 view .LVU240
 959 00e4 0546     		mov	r5, r0
 960              	.LVL87:
 340:Core/Src/user_diskio_spi.c **** 					for (n = 0; n < 4; n++) ocr[n] = xchg_spi(0xFF);
 961              		.loc 1 340 28 discriminator 1 view .LVU241
 962 00e6 50B1     		cbz	r0, .L74
 963 00e8 B0E7     		b	.L68
 964              	.LVL88:
 965              	.L75:
 341:Core/Src/user_diskio_spi.c **** 					ty = (ocr[0] & 0x40) ? CT_SD2 | CT_BLOCK : CT_SD2;	/* Card id SDv2 */
 966              		.loc 1 341 30 is_stmt 1 discriminator 3 view .LVU242
 341:Core/Src/user_diskio_spi.c **** 					ty = (ocr[0] & 0x40) ? CT_SD2 | CT_BLOCK : CT_SD2;	/* Card id SDv2 */
 967              		.loc 1 341 39 is_stmt 0 discriminator 3 view .LVU243
 968 00ea FF20     		movs	r0, #255
 969 00ec FFF7FEFF 		bl	xchg_spi
 970              	.LVL89:
 341:Core/Src/user_diskio_spi.c **** 					ty = (ocr[0] & 0x40) ? CT_SD2 | CT_BLOCK : CT_SD2;	/* Card id SDv2 */
 971              		.loc 1 341 37 discriminator 3 view .LVU244
 972 00f0 05F10803 		add	r3, r5, #8
 973 00f4 6B44     		add	r3, sp, r3
 974 00f6 03F8040C 		strb	r0, [r3, #-4]
 341:Core/Src/user_diskio_spi.c **** 					ty = (ocr[0] & 0x40) ? CT_SD2 | CT_BLOCK : CT_SD2;	/* Card id SDv2 */
 975              		.loc 1 341 26 is_stmt 1 discriminator 3 view .LVU245
 976 00fa 0135     		adds	r5, r5, #1
 977              	.LVL90:
 341:Core/Src/user_diskio_spi.c **** 					ty = (ocr[0] & 0x40) ? CT_SD2 | CT_BLOCK : CT_SD2;	/* Card id SDv2 */
 978              		.loc 1 341 26 is_stmt 0 discriminator 3 view .LVU246
 979 00fc EDB2     		uxtb	r5, r5
 980              	.LVL91:
 981              	.L74:
 341:Core/Src/user_diskio_spi.c **** 					ty = (ocr[0] & 0x40) ? CT_SD2 | CT_BLOCK : CT_SD2;	/* Card id SDv2 */
 982              		.loc 1 341 20 is_stmt 1 discriminator 2 view .LVU247
 983 00fe 032D     		cmp	r5, #3
 984 0100 F3D9     		bls	.L75
 342:Core/Src/user_diskio_spi.c **** 				}
 985              		.loc 1 342 6 view .LVU248
 342:Core/Src/user_diskio_spi.c **** 				}
 986              		.loc 1 342 15 is_stmt 0 view .LVU249
 987 0102 9DF80430 		ldrb	r3, [sp, #4]	@ zero_extendqisi2
 342:Core/Src/user_diskio_spi.c **** 				}
 988              		.loc 1 342 9 view .LVU250
 989 0106 13F0400F 		tst	r3, #64
 990 010a 23D0     		beq	.L84
 342:Core/Src/user_diskio_spi.c **** 				}
 991              		.loc 1 342 9 discriminator 1 view .LVU251
 992 010c 0C24     		movs	r4, #12
 993 010e 9DE7     		b	.L68
 994              	.LVL92:
 995              	.L93:
 346:Core/Src/user_diskio_spi.c **** 				ty = CT_SD1; cmd = ACMD41;	/* SDv1 (ACMD41(0)) */
 996              		.loc 1 346 4 is_stmt 1 view .LVU252
 346:Core/Src/user_diskio_spi.c **** 				ty = CT_SD1; cmd = ACMD41;	/* SDv1 (ACMD41(0)) */
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 27


 997              		.loc 1 346 8 is_stmt 0 view .LVU253
 998 0110 0021     		movs	r1, #0
 999 0112 A920     		movs	r0, #169
 1000 0114 FFF7FEFF 		bl	send_cmd
 1001              	.LVL93:
 346:Core/Src/user_diskio_spi.c **** 				ty = CT_SD1; cmd = ACMD41;	/* SDv1 (ACMD41(0)) */
 1002              		.loc 1 346 7 discriminator 1 view .LVU254
 1003 0118 0128     		cmp	r0, #1
 1004 011a 0ED9     		bls	.L95
 349:Core/Src/user_diskio_spi.c **** 			}
 1005              		.loc 1 349 8 view .LVU255
 1006 011c 2E46     		mov	r6, r5
 1007              	.LVL94:
 1008              	.L78:
 351:Core/Src/user_diskio_spi.c **** 			if (!SPI_Timer_Status() || send_cmd(CMD16, 512) != 0)	/* Set block length: 512 */
 1009              		.loc 1 351 30 is_stmt 1 discriminator 2 view .LVU256
 351:Core/Src/user_diskio_spi.c **** 			if (!SPI_Timer_Status() || send_cmd(CMD16, 512) != 0)	/* Set block length: 512 */
 1010              		.loc 1 351 11 is_stmt 0 discriminator 2 view .LVU257
 1011 011e FFF7FEFF 		bl	SPI_Timer_Status
 1012              	.LVL95:
 351:Core/Src/user_diskio_spi.c **** 			if (!SPI_Timer_Status() || send_cmd(CMD16, 512) != 0)	/* Set block length: 512 */
 1013              		.loc 1 351 30 discriminator 2 view .LVU258
 1014 0122 28B1     		cbz	r0, .L77
 351:Core/Src/user_diskio_spi.c **** 			if (!SPI_Timer_Status() || send_cmd(CMD16, 512) != 0)	/* Set block length: 512 */
 1015              		.loc 1 351 33 discriminator 1 view .LVU259
 1016 0124 0021     		movs	r1, #0
 1017 0126 2846     		mov	r0, r5
 1018 0128 FFF7FEFF 		bl	send_cmd
 1019              	.LVL96:
 351:Core/Src/user_diskio_spi.c **** 			if (!SPI_Timer_Status() || send_cmd(CMD16, 512) != 0)	/* Set block length: 512 */
 1020              		.loc 1 351 30 discriminator 1 view .LVU260
 1021 012c 0028     		cmp	r0, #0
 1022 012e F6D1     		bne	.L78
 1023              	.L77:
 352:Core/Src/user_diskio_spi.c **** 				ty = 0;
 1024              		.loc 1 352 4 is_stmt 1 view .LVU261
 352:Core/Src/user_diskio_spi.c **** 				ty = 0;
 1025              		.loc 1 352 9 is_stmt 0 view .LVU262
 1026 0130 FFF7FEFF 		bl	SPI_Timer_Status
 1027              	.LVL97:
 352:Core/Src/user_diskio_spi.c **** 				ty = 0;
 1028              		.loc 1 352 7 discriminator 1 view .LVU263
 1029 0134 20B9     		cbnz	r0, .L96
 353:Core/Src/user_diskio_spi.c **** 		}
 1030              		.loc 1 353 8 view .LVU264
 1031 0136 0446     		mov	r4, r0
 1032              	.LVL98:
 353:Core/Src/user_diskio_spi.c **** 		}
 1033              		.loc 1 353 8 view .LVU265
 1034 0138 88E7     		b	.L68
 1035              	.LVL99:
 1036              	.L95:
 347:Core/Src/user_diskio_spi.c **** 			} else {
 1037              		.loc 1 347 8 view .LVU266
 1038 013a 0226     		movs	r6, #2
 347:Core/Src/user_diskio_spi.c **** 			} else {
 1039              		.loc 1 347 22 view .LVU267
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 28


 1040 013c A925     		movs	r5, #169
 1041 013e EEE7     		b	.L78
 1042              	.LVL100:
 1043              	.L96:
 352:Core/Src/user_diskio_spi.c **** 				ty = 0;
 1044              		.loc 1 352 31 discriminator 1 view .LVU268
 1045 0140 4FF40071 		mov	r1, #512
 1046 0144 1020     		movs	r0, #16
 1047 0146 FFF7FEFF 		bl	send_cmd
 1048              	.LVL101:
 352:Core/Src/user_diskio_spi.c **** 				ty = 0;
 1049              		.loc 1 352 28 discriminator 1 view .LVU269
 1050 014a 0028     		cmp	r0, #0
 1051 014c 7FF47EAF 		bne	.L68
 1052 0150 3446     		mov	r4, r6
 1053              	.LVL102:
 352:Core/Src/user_diskio_spi.c **** 				ty = 0;
 1054              		.loc 1 352 28 discriminator 1 view .LVU270
 1055 0152 7BE7     		b	.L68
 1056              	.LVL103:
 1057              	.L84:
 342:Core/Src/user_diskio_spi.c **** 				}
 1058              		.loc 1 342 9 discriminator 2 view .LVU271
 1059 0154 0424     		movs	r4, #4
 1060 0156 79E7     		b	.L68
 1061              	.LVL104:
 1062              	.L79:
 363:Core/Src/user_diskio_spi.c **** 	}
 1063              		.loc 1 363 3 is_stmt 1 view .LVU272
 363:Core/Src/user_diskio_spi.c **** 	}
 1064              		.loc 1 363 8 is_stmt 0 view .LVU273
 1065 0158 024B     		ldr	r3, .L97
 1066 015a 0122     		movs	r2, #1
 1067 015c 1A70     		strb	r2, [r3]
 1068 015e 88E7     		b	.L80
 1069              	.LVL105:
 1070              	.L81:
 1071              		.cfi_def_cfa_offset 0
 1072              		.cfi_restore 4
 1073              		.cfi_restore 5
 1074              		.cfi_restore 6
 1075              		.cfi_restore 14
 325:Core/Src/user_diskio_spi.c **** 	//assume SPI already init init_spi();	/* Initialize SPI */
 1076              		.loc 1 325 23 discriminator 1 view .LVU274
 1077 0160 0120     		movs	r0, #1
 1078              	.LVL106:
 1079              		.loc 1 367 1 view .LVU275
 1080 0162 7047     		bx	lr
 1081              	.L98:
 1082              		.align	2
 1083              	.L97:
 1084 0164 00000000 		.word	Stat
 1085 0168 00000000 		.word	hspi2
 1086 016c 00000000 		.word	CardType
 1087              		.cfi_endproc
 1088              	.LFE145:
 1090              		.section	.text.USER_SPI_status,"ax",%progbits
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 29


 1091              		.align	1
 1092              		.global	USER_SPI_status
 1093              		.syntax unified
 1094              		.thumb
 1095              		.thumb_func
 1097              	USER_SPI_status:
 1098              	.LVL107:
 1099              	.LFB146:
 368:Core/Src/user_diskio_spi.c **** 
 369:Core/Src/user_diskio_spi.c **** 
 370:Core/Src/user_diskio_spi.c **** 
 371:Core/Src/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 372:Core/Src/user_diskio_spi.c **** /* Get disk status                                                       */
 373:Core/Src/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 374:Core/Src/user_diskio_spi.c **** 
 375:Core/Src/user_diskio_spi.c **** inline DSTATUS USER_SPI_status (
 376:Core/Src/user_diskio_spi.c **** 	BYTE drv		/* Physical drive number (0) */
 377:Core/Src/user_diskio_spi.c **** )
 378:Core/Src/user_diskio_spi.c **** {
 1100              		.loc 1 378 1 is_stmt 1 view -0
 1101              		.cfi_startproc
 1102              		@ args = 0, pretend = 0, frame = 0
 1103              		@ frame_needed = 0, uses_anonymous_args = 0
 1104              		@ link register save eliminated.
 379:Core/Src/user_diskio_spi.c **** 	if (drv) return STA_NOINIT;		/* Supports only drive 0 */
 1105              		.loc 1 379 2 view .LVU277
 1106              		.loc 1 379 5 is_stmt 0 view .LVU278
 1107 0000 18B9     		cbnz	r0, .L101
 380:Core/Src/user_diskio_spi.c **** 
 381:Core/Src/user_diskio_spi.c **** 	return Stat;	/* Return disk status */
 1108              		.loc 1 381 2 is_stmt 1 view .LVU279
 1109              		.loc 1 381 9 is_stmt 0 view .LVU280
 1110 0002 034B     		ldr	r3, .L102
 1111 0004 1878     		ldrb	r0, [r3]	@ zero_extendqisi2
 1112              	.LVL108:
 1113              		.loc 1 381 9 view .LVU281
 1114 0006 C0B2     		uxtb	r0, r0
 1115 0008 7047     		bx	lr
 1116              	.LVL109:
 1117              	.L101:
 379:Core/Src/user_diskio_spi.c **** 	if (drv) return STA_NOINIT;		/* Supports only drive 0 */
 1118              		.loc 1 379 18 discriminator 1 view .LVU282
 1119 000a 0120     		movs	r0, #1
 1120              	.LVL110:
 382:Core/Src/user_diskio_spi.c **** }
 1121              		.loc 1 382 1 view .LVU283
 1122 000c 7047     		bx	lr
 1123              	.L103:
 1124 000e 00BF     		.align	2
 1125              	.L102:
 1126 0010 00000000 		.word	Stat
 1127              		.cfi_endproc
 1128              	.LFE146:
 1130              		.section	.text.USER_SPI_read,"ax",%progbits
 1131              		.align	1
 1132              		.global	USER_SPI_read
 1133              		.syntax unified
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 30


 1134              		.thumb
 1135              		.thumb_func
 1137              	USER_SPI_read:
 1138              	.LVL111:
 1139              	.LFB147:
 383:Core/Src/user_diskio_spi.c **** 
 384:Core/Src/user_diskio_spi.c **** 
 385:Core/Src/user_diskio_spi.c **** 
 386:Core/Src/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 387:Core/Src/user_diskio_spi.c **** /* Read sector(s)                                                        */
 388:Core/Src/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 389:Core/Src/user_diskio_spi.c **** 
 390:Core/Src/user_diskio_spi.c **** inline DRESULT USER_SPI_read (
 391:Core/Src/user_diskio_spi.c **** 	BYTE drv,		/* Physical drive number (0) */
 392:Core/Src/user_diskio_spi.c **** 	BYTE *buff,		/* Pointer to the data buffer to store read data */
 393:Core/Src/user_diskio_spi.c **** 	DWORD sector,	/* Start sector number (LBA) */
 394:Core/Src/user_diskio_spi.c **** 	UINT count		/* Number of sectors to read (1..128) */
 395:Core/Src/user_diskio_spi.c **** )
 396:Core/Src/user_diskio_spi.c **** {
 1140              		.loc 1 396 1 is_stmt 1 view -0
 1141              		.cfi_startproc
 1142              		@ args = 0, pretend = 0, frame = 0
 1143              		@ frame_needed = 0, uses_anonymous_args = 0
 397:Core/Src/user_diskio_spi.c **** 	if (drv || !count) return RES_PARERR;		/* Check parameter */
 1144              		.loc 1 397 2 view .LVU285
 1145              		.loc 1 397 5 is_stmt 0 view .LVU286
 1146 0000 0028     		cmp	r0, #0
 1147 0002 39D1     		bne	.L111
 396:Core/Src/user_diskio_spi.c **** 	if (drv || !count) return RES_PARERR;		/* Check parameter */
 1148              		.loc 1 396 1 view .LVU287
 1149 0004 38B5     		push	{r3, r4, r5, lr}
 1150              		.cfi_def_cfa_offset 16
 1151              		.cfi_offset 3, -16
 1152              		.cfi_offset 4, -12
 1153              		.cfi_offset 5, -8
 1154              		.cfi_offset 14, -4
 1155 0006 0D46     		mov	r5, r1
 1156 0008 1C46     		mov	r4, r3
 1157              		.loc 1 397 10 discriminator 2 view .LVU288
 1158 000a 002B     		cmp	r3, #0
 1159 000c 36D0     		beq	.L112
 398:Core/Src/user_diskio_spi.c **** 	if (Stat & STA_NOINIT) return RES_NOTRDY;	/* Check if drive is ready */
 1160              		.loc 1 398 2 is_stmt 1 view .LVU289
 1161              		.loc 1 398 11 is_stmt 0 view .LVU290
 1162 000e 1D4B     		ldr	r3, .L120
 1163              	.LVL112:
 1164              		.loc 1 398 11 view .LVU291
 1165 0010 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 1166              		.loc 1 398 5 view .LVU292
 1167 0012 13F0010F 		tst	r3, #1
 1168 0016 33D1     		bne	.L113
 399:Core/Src/user_diskio_spi.c **** 
 400:Core/Src/user_diskio_spi.c **** 	if (!(CardType & CT_BLOCK)) sector *= 512;	/* LBA ot BA conversion (byte addressing cards) */
 1169              		.loc 1 400 2 is_stmt 1 view .LVU293
 1170              		.loc 1 400 17 is_stmt 0 view .LVU294
 1171 0018 1B4B     		ldr	r3, .L120+4
 1172 001a 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 31


 1173              		.loc 1 400 5 view .LVU295
 1174 001c 13F0080F 		tst	r3, #8
 1175 0020 00D1     		bne	.L106
 1176              		.loc 1 400 30 is_stmt 1 discriminator 1 view .LVU296
 1177              		.loc 1 400 37 is_stmt 0 discriminator 1 view .LVU297
 1178 0022 5202     		lsls	r2, r2, #9
 1179              	.LVL113:
 1180              	.L106:
 401:Core/Src/user_diskio_spi.c **** 
 402:Core/Src/user_diskio_spi.c **** 	if (count == 1) {	/* Single sector read */
 1181              		.loc 1 402 2 is_stmt 1 view .LVU298
 1182              		.loc 1 402 5 is_stmt 0 view .LVU299
 1183 0024 012C     		cmp	r4, #1
 1184 0026 18D0     		beq	.L119
 403:Core/Src/user_diskio_spi.c **** 		if ((send_cmd(CMD17, sector) == 0)	/* READ_SINGLE_BLOCK */
 404:Core/Src/user_diskio_spi.c **** 			&& rcvr_datablock(buff, 512)) {
 405:Core/Src/user_diskio_spi.c **** 			count = 0;
 406:Core/Src/user_diskio_spi.c **** 		}
 407:Core/Src/user_diskio_spi.c **** 	}
 408:Core/Src/user_diskio_spi.c **** 	else {				/* Multiple sector read */
 409:Core/Src/user_diskio_spi.c **** 		if (send_cmd(CMD18, sector) == 0) {	/* READ_MULTIPLE_BLOCK */
 1185              		.loc 1 409 3 is_stmt 1 view .LVU300
 1186              		.loc 1 409 7 is_stmt 0 view .LVU301
 1187 0028 1146     		mov	r1, r2
 1188              	.LVL114:
 1189              		.loc 1 409 7 view .LVU302
 1190 002a 1220     		movs	r0, #18
 1191              	.LVL115:
 1192              		.loc 1 409 7 view .LVU303
 1193 002c FFF7FEFF 		bl	send_cmd
 1194              	.LVL116:
 1195              		.loc 1 409 6 discriminator 1 view .LVU304
 1196 0030 68B9     		cbnz	r0, .L108
 1197              	.L110:
 410:Core/Src/user_diskio_spi.c **** 			do {
 1198              		.loc 1 410 4 is_stmt 1 view .LVU305
 411:Core/Src/user_diskio_spi.c **** 				if (!rcvr_datablock(buff, 512)) break;
 1199              		.loc 1 411 5 view .LVU306
 1200              		.loc 1 411 10 is_stmt 0 view .LVU307
 1201 0032 4FF40071 		mov	r1, #512
 1202 0036 2846     		mov	r0, r5
 1203 0038 FFF7FEFF 		bl	rcvr_datablock
 1204              	.LVL117:
 1205              		.loc 1 411 8 discriminator 1 view .LVU308
 1206 003c 18B1     		cbz	r0, .L109
 412:Core/Src/user_diskio_spi.c **** 				buff += 512;
 1207              		.loc 1 412 5 is_stmt 1 view .LVU309
 1208              		.loc 1 412 10 is_stmt 0 view .LVU310
 1209 003e 05F50075 		add	r5, r5, #512
 1210              	.LVL118:
 413:Core/Src/user_diskio_spi.c **** 			} while (--count);
 1211              		.loc 1 413 13 is_stmt 1 view .LVU311
 1212              		.loc 1 413 13 is_stmt 0 view .LVU312
 1213 0042 013C     		subs	r4, r4, #1
 1214              	.LVL119:
 1215              		.loc 1 413 13 view .LVU313
 1216 0044 F5D1     		bne	.L110
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 32


 1217              	.L109:
 414:Core/Src/user_diskio_spi.c **** 			send_cmd(CMD12, 0);				/* STOP_TRANSMISSION */
 1218              		.loc 1 414 4 is_stmt 1 view .LVU314
 1219 0046 0021     		movs	r1, #0
 1220 0048 0C20     		movs	r0, #12
 1221 004a FFF7FEFF 		bl	send_cmd
 1222              	.LVL120:
 1223              	.L108:
 415:Core/Src/user_diskio_spi.c **** 		}
 416:Core/Src/user_diskio_spi.c **** 	}
 417:Core/Src/user_diskio_spi.c **** 	despiselect();
 1224              		.loc 1 417 2 view .LVU315
 1225 004e FFF7FEFF 		bl	despiselect
 1226              	.LVL121:
 418:Core/Src/user_diskio_spi.c **** 
 419:Core/Src/user_diskio_spi.c **** 	return count ? RES_ERROR : RES_OK;	/* Return result */
 1227              		.loc 1 419 2 view .LVU316
 1228              		.loc 1 419 27 is_stmt 0 view .LVU317
 1229 0052 201E     		subs	r0, r4, #0
 1230 0054 18BF     		it	ne
 1231 0056 0120     		movne	r0, #1
 1232              	.LVL122:
 1233              	.L105:
 420:Core/Src/user_diskio_spi.c **** }
 1234              		.loc 1 420 1 view .LVU318
 1235 0058 38BD     		pop	{r3, r4, r5, pc}
 1236              	.LVL123:
 1237              	.L119:
 403:Core/Src/user_diskio_spi.c **** 			&& rcvr_datablock(buff, 512)) {
 1238              		.loc 1 403 3 is_stmt 1 view .LVU319
 403:Core/Src/user_diskio_spi.c **** 			&& rcvr_datablock(buff, 512)) {
 1239              		.loc 1 403 8 is_stmt 0 view .LVU320
 1240 005a 1146     		mov	r1, r2
 1241              	.LVL124:
 403:Core/Src/user_diskio_spi.c **** 			&& rcvr_datablock(buff, 512)) {
 1242              		.loc 1 403 8 view .LVU321
 1243 005c 1120     		movs	r0, #17
 1244              	.LVL125:
 403:Core/Src/user_diskio_spi.c **** 			&& rcvr_datablock(buff, 512)) {
 1245              		.loc 1 403 8 view .LVU322
 1246 005e FFF7FEFF 		bl	send_cmd
 1247              	.LVL126:
 403:Core/Src/user_diskio_spi.c **** 			&& rcvr_datablock(buff, 512)) {
 1248              		.loc 1 403 6 discriminator 1 view .LVU323
 1249 0062 0028     		cmp	r0, #0
 1250 0064 F3D1     		bne	.L108
 404:Core/Src/user_diskio_spi.c **** 			count = 0;
 1251              		.loc 1 404 7 view .LVU324
 1252 0066 4FF40071 		mov	r1, #512
 1253 006a 2846     		mov	r0, r5
 1254 006c FFF7FEFF 		bl	rcvr_datablock
 1255              	.LVL127:
 404:Core/Src/user_diskio_spi.c **** 			count = 0;
 1256              		.loc 1 404 4 discriminator 1 view .LVU325
 1257 0070 0028     		cmp	r0, #0
 1258 0072 ECD0     		beq	.L108
 405:Core/Src/user_diskio_spi.c **** 		}
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 33


 1259              		.loc 1 405 10 view .LVU326
 1260 0074 0024     		movs	r4, #0
 1261              	.LVL128:
 405:Core/Src/user_diskio_spi.c **** 		}
 1262              		.loc 1 405 10 view .LVU327
 1263 0076 EAE7     		b	.L108
 1264              	.LVL129:
 1265              	.L111:
 1266              		.cfi_def_cfa_offset 0
 1267              		.cfi_restore 3
 1268              		.cfi_restore 4
 1269              		.cfi_restore 5
 1270              		.cfi_restore 14
 397:Core/Src/user_diskio_spi.c **** 	if (Stat & STA_NOINIT) return RES_NOTRDY;	/* Check if drive is ready */
 1271              		.loc 1 397 28 discriminator 3 view .LVU328
 1272 0078 0420     		movs	r0, #4
 1273              	.LVL130:
 1274              		.loc 1 420 1 view .LVU329
 1275 007a 7047     		bx	lr
 1276              	.LVL131:
 1277              	.L112:
 1278              		.cfi_def_cfa_offset 16
 1279              		.cfi_offset 3, -16
 1280              		.cfi_offset 4, -12
 1281              		.cfi_offset 5, -8
 1282              		.cfi_offset 14, -4
 397:Core/Src/user_diskio_spi.c **** 	if (Stat & STA_NOINIT) return RES_NOTRDY;	/* Check if drive is ready */
 1283              		.loc 1 397 28 discriminator 3 view .LVU330
 1284 007c 0420     		movs	r0, #4
 1285              	.LVL132:
 397:Core/Src/user_diskio_spi.c **** 	if (Stat & STA_NOINIT) return RES_NOTRDY;	/* Check if drive is ready */
 1286              		.loc 1 397 28 discriminator 3 view .LVU331
 1287 007e EBE7     		b	.L105
 1288              	.LVL133:
 1289              	.L113:
 398:Core/Src/user_diskio_spi.c **** 
 1290              		.loc 1 398 32 discriminator 1 view .LVU332
 1291 0080 0320     		movs	r0, #3
 1292              	.LVL134:
 398:Core/Src/user_diskio_spi.c **** 
 1293              		.loc 1 398 32 discriminator 1 view .LVU333
 1294 0082 E9E7     		b	.L105
 1295              	.L121:
 1296              		.align	2
 1297              	.L120:
 1298 0084 00000000 		.word	Stat
 1299 0088 00000000 		.word	CardType
 1300              		.cfi_endproc
 1301              	.LFE147:
 1303              		.section	.text.USER_SPI_write,"ax",%progbits
 1304              		.align	1
 1305              		.global	USER_SPI_write
 1306              		.syntax unified
 1307              		.thumb
 1308              		.thumb_func
 1310              	USER_SPI_write:
 1311              	.LVL135:
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 34


 1312              	.LFB148:
 421:Core/Src/user_diskio_spi.c **** 
 422:Core/Src/user_diskio_spi.c **** 
 423:Core/Src/user_diskio_spi.c **** 
 424:Core/Src/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 425:Core/Src/user_diskio_spi.c **** /* Write sector(s)                                                       */
 426:Core/Src/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 427:Core/Src/user_diskio_spi.c **** 
 428:Core/Src/user_diskio_spi.c **** #if _USE_WRITE
 429:Core/Src/user_diskio_spi.c **** inline DRESULT USER_SPI_write (
 430:Core/Src/user_diskio_spi.c **** 	BYTE drv,			/* Physical drive number (0) */
 431:Core/Src/user_diskio_spi.c **** 	const BYTE *buff,	/* Ponter to the data to write */
 432:Core/Src/user_diskio_spi.c **** 	DWORD sector,		/* Start sector number (LBA) */
 433:Core/Src/user_diskio_spi.c **** 	UINT count			/* Number of sectors to write (1..128) */
 434:Core/Src/user_diskio_spi.c **** )
 435:Core/Src/user_diskio_spi.c **** {
 1313              		.loc 1 435 1 is_stmt 1 view -0
 1314              		.cfi_startproc
 1315              		@ args = 0, pretend = 0, frame = 0
 1316              		@ frame_needed = 0, uses_anonymous_args = 0
 436:Core/Src/user_diskio_spi.c **** 	if (drv || !count) return RES_PARERR;		/* Check parameter */
 1317              		.loc 1 436 2 view .LVU335
 1318              		.loc 1 436 5 is_stmt 0 view .LVU336
 1319 0000 0028     		cmp	r0, #0
 1320 0002 48D1     		bne	.L130
 435:Core/Src/user_diskio_spi.c **** 	if (drv || !count) return RES_PARERR;		/* Check parameter */
 1321              		.loc 1 435 1 view .LVU337
 1322 0004 70B5     		push	{r4, r5, r6, lr}
 1323              		.cfi_def_cfa_offset 16
 1324              		.cfi_offset 4, -16
 1325              		.cfi_offset 5, -12
 1326              		.cfi_offset 6, -8
 1327              		.cfi_offset 14, -4
 1328 0006 0D46     		mov	r5, r1
 1329 0008 1646     		mov	r6, r2
 1330 000a 1C46     		mov	r4, r3
 1331              		.loc 1 436 10 discriminator 2 view .LVU338
 1332 000c 002B     		cmp	r3, #0
 1333 000e 44D0     		beq	.L131
 437:Core/Src/user_diskio_spi.c **** 	if (Stat & STA_NOINIT) return RES_NOTRDY;	/* Check drive status */
 1334              		.loc 1 437 2 is_stmt 1 view .LVU339
 1335              		.loc 1 437 11 is_stmt 0 view .LVU340
 1336 0010 254B     		ldr	r3, .L142
 1337              	.LVL136:
 1338              		.loc 1 437 11 view .LVU341
 1339 0012 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 1340              		.loc 1 437 5 view .LVU342
 1341 0014 13F0010F 		tst	r3, #1
 1342 0018 41D1     		bne	.L132
 438:Core/Src/user_diskio_spi.c **** 	if (Stat & STA_PROTECT) return RES_WRPRT;	/* Check write protect */
 1343              		.loc 1 438 2 is_stmt 1 view .LVU343
 1344              		.loc 1 438 11 is_stmt 0 view .LVU344
 1345 001a 234B     		ldr	r3, .L142
 1346 001c 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 1347              		.loc 1 438 5 view .LVU345
 1348 001e 13F0040F 		tst	r3, #4
 1349 0022 3ED1     		bne	.L133
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 35


 439:Core/Src/user_diskio_spi.c **** 
 440:Core/Src/user_diskio_spi.c **** 	if (!(CardType & CT_BLOCK)) sector *= 512;	/* LBA ==> BA conversion (byte addressing cards) */
 1350              		.loc 1 440 2 is_stmt 1 view .LVU346
 1351              		.loc 1 440 17 is_stmt 0 view .LVU347
 1352 0024 214B     		ldr	r3, .L142+4
 1353 0026 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 1354              		.loc 1 440 5 view .LVU348
 1355 0028 13F0080F 		tst	r3, #8
 1356 002c 00D1     		bne	.L124
 1357              		.loc 1 440 30 is_stmt 1 discriminator 1 view .LVU349
 1358              		.loc 1 440 37 is_stmt 0 discriminator 1 view .LVU350
 1359 002e 5602     		lsls	r6, r2, #9
 1360              	.LVL137:
 1361              	.L124:
 441:Core/Src/user_diskio_spi.c **** 
 442:Core/Src/user_diskio_spi.c **** 	if (count == 1) {	/* Single sector write */
 1362              		.loc 1 442 2 is_stmt 1 view .LVU351
 1363              		.loc 1 442 5 is_stmt 0 view .LVU352
 1364 0030 012C     		cmp	r4, #1
 1365 0032 1BD0     		beq	.L140
 443:Core/Src/user_diskio_spi.c **** 		if ((send_cmd(CMD24, sector) == 0)	/* WRITE_BLOCK */
 444:Core/Src/user_diskio_spi.c **** 			&& xmit_datablock(buff, 0xFE)) {
 445:Core/Src/user_diskio_spi.c **** 			count = 0;
 446:Core/Src/user_diskio_spi.c **** 		}
 447:Core/Src/user_diskio_spi.c **** 	}
 448:Core/Src/user_diskio_spi.c **** 	else {				/* Multiple sector write */
 449:Core/Src/user_diskio_spi.c **** 		if (CardType & CT_SDC) send_cmd(ACMD23, count);	/* Predefine number of sectors */
 1366              		.loc 1 449 3 is_stmt 1 view .LVU353
 1367              		.loc 1 449 6 is_stmt 0 view .LVU354
 1368 0034 13F0060F 		tst	r3, #6
 1369 0038 26D1     		bne	.L141
 1370              	.LVL138:
 1371              	.L127:
 450:Core/Src/user_diskio_spi.c **** 		if (send_cmd(CMD25, sector) == 0) {	/* WRITE_MULTIPLE_BLOCK */
 1372              		.loc 1 450 3 is_stmt 1 view .LVU355
 1373              		.loc 1 450 7 is_stmt 0 view .LVU356
 1374 003a 3146     		mov	r1, r6
 1375 003c 1920     		movs	r0, #25
 1376 003e FFF7FEFF 		bl	send_cmd
 1377              	.LVL139:
 1378              		.loc 1 450 6 discriminator 1 view .LVU357
 1379 0042 68B9     		cbnz	r0, .L126
 1380              	.L129:
 451:Core/Src/user_diskio_spi.c **** 			do {
 1381              		.loc 1 451 4 is_stmt 1 view .LVU358
 452:Core/Src/user_diskio_spi.c **** 				if (!xmit_datablock(buff, 0xFC)) break;
 1382              		.loc 1 452 5 view .LVU359
 1383              		.loc 1 452 10 is_stmt 0 view .LVU360
 1384 0044 FC21     		movs	r1, #252
 1385 0046 2846     		mov	r0, r5
 1386 0048 FFF7FEFF 		bl	xmit_datablock
 1387              	.LVL140:
 1388              		.loc 1 452 8 discriminator 1 view .LVU361
 1389 004c 18B1     		cbz	r0, .L128
 453:Core/Src/user_diskio_spi.c **** 				buff += 512;
 1390              		.loc 1 453 5 is_stmt 1 view .LVU362
 1391              		.loc 1 453 10 is_stmt 0 view .LVU363
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 36


 1392 004e 05F50075 		add	r5, r5, #512
 1393              	.LVL141:
 454:Core/Src/user_diskio_spi.c **** 			} while (--count);
 1394              		.loc 1 454 13 is_stmt 1 view .LVU364
 1395              		.loc 1 454 13 is_stmt 0 view .LVU365
 1396 0052 013C     		subs	r4, r4, #1
 1397              	.LVL142:
 1398              		.loc 1 454 13 view .LVU366
 1399 0054 F6D1     		bne	.L129
 1400              	.L128:
 455:Core/Src/user_diskio_spi.c **** 			if (!xmit_datablock(0, 0xFD)) count = 1;	/* STOP_TRAN token */
 1401              		.loc 1 455 4 is_stmt 1 view .LVU367
 1402              		.loc 1 455 9 is_stmt 0 view .LVU368
 1403 0056 FD21     		movs	r1, #253
 1404 0058 0020     		movs	r0, #0
 1405 005a FFF7FEFF 		bl	xmit_datablock
 1406              	.LVL143:
 1407              		.loc 1 455 7 discriminator 1 view .LVU369
 1408 005e C0B1     		cbz	r0, .L135
 1409              	.LVL144:
 1410              	.L126:
 456:Core/Src/user_diskio_spi.c **** 		}
 457:Core/Src/user_diskio_spi.c **** 	}
 458:Core/Src/user_diskio_spi.c **** 	despiselect();
 1411              		.loc 1 458 2 is_stmt 1 view .LVU370
 1412 0060 FFF7FEFF 		bl	despiselect
 1413              	.LVL145:
 459:Core/Src/user_diskio_spi.c **** 
 460:Core/Src/user_diskio_spi.c **** 	return count ? RES_ERROR : RES_OK;	/* Return result */
 1414              		.loc 1 460 2 view .LVU371
 1415              		.loc 1 460 27 is_stmt 0 view .LVU372
 1416 0064 201E     		subs	r0, r4, #0
 1417 0066 18BF     		it	ne
 1418 0068 0120     		movne	r0, #1
 1419              	.L123:
 461:Core/Src/user_diskio_spi.c **** }
 1420              		.loc 1 461 1 view .LVU373
 1421 006a 70BD     		pop	{r4, r5, r6, pc}
 1422              	.LVL146:
 1423              	.L140:
 443:Core/Src/user_diskio_spi.c **** 			&& xmit_datablock(buff, 0xFE)) {
 1424              		.loc 1 443 3 is_stmt 1 view .LVU374
 443:Core/Src/user_diskio_spi.c **** 			&& xmit_datablock(buff, 0xFE)) {
 1425              		.loc 1 443 8 is_stmt 0 view .LVU375
 1426 006c 3146     		mov	r1, r6
 1427              	.LVL147:
 443:Core/Src/user_diskio_spi.c **** 			&& xmit_datablock(buff, 0xFE)) {
 1428              		.loc 1 443 8 view .LVU376
 1429 006e 1820     		movs	r0, #24
 1430              	.LVL148:
 443:Core/Src/user_diskio_spi.c **** 			&& xmit_datablock(buff, 0xFE)) {
 1431              		.loc 1 443 8 view .LVU377
 1432 0070 FFF7FEFF 		bl	send_cmd
 1433              	.LVL149:
 443:Core/Src/user_diskio_spi.c **** 			&& xmit_datablock(buff, 0xFE)) {
 1434              		.loc 1 443 6 discriminator 1 view .LVU378
 1435 0074 0028     		cmp	r0, #0
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 37


 1436 0076 F3D1     		bne	.L126
 444:Core/Src/user_diskio_spi.c **** 			count = 0;
 1437              		.loc 1 444 7 view .LVU379
 1438 0078 FE21     		movs	r1, #254
 1439 007a 2846     		mov	r0, r5
 1440 007c FFF7FEFF 		bl	xmit_datablock
 1441              	.LVL150:
 444:Core/Src/user_diskio_spi.c **** 			count = 0;
 1442              		.loc 1 444 4 discriminator 1 view .LVU380
 1443 0080 0028     		cmp	r0, #0
 1444 0082 EDD0     		beq	.L126
 445:Core/Src/user_diskio_spi.c **** 		}
 1445              		.loc 1 445 10 view .LVU381
 1446 0084 0024     		movs	r4, #0
 1447              	.LVL151:
 445:Core/Src/user_diskio_spi.c **** 		}
 1448              		.loc 1 445 10 view .LVU382
 1449 0086 EBE7     		b	.L126
 1450              	.LVL152:
 1451              	.L141:
 449:Core/Src/user_diskio_spi.c **** 		if (send_cmd(CMD25, sector) == 0) {	/* WRITE_MULTIPLE_BLOCK */
 1452              		.loc 1 449 26 is_stmt 1 discriminator 1 view .LVU383
 1453 0088 2146     		mov	r1, r4
 1454              	.LVL153:
 449:Core/Src/user_diskio_spi.c **** 		if (send_cmd(CMD25, sector) == 0) {	/* WRITE_MULTIPLE_BLOCK */
 1455              		.loc 1 449 26 is_stmt 0 discriminator 1 view .LVU384
 1456 008a 9720     		movs	r0, #151
 1457              	.LVL154:
 449:Core/Src/user_diskio_spi.c **** 		if (send_cmd(CMD25, sector) == 0) {	/* WRITE_MULTIPLE_BLOCK */
 1458              		.loc 1 449 26 discriminator 1 view .LVU385
 1459 008c FFF7FEFF 		bl	send_cmd
 1460              	.LVL155:
 1461 0090 D3E7     		b	.L127
 1462              	.L135:
 455:Core/Src/user_diskio_spi.c **** 		}
 1463              		.loc 1 455 40 discriminator 1 view .LVU386
 1464 0092 0124     		movs	r4, #1
 1465              	.LVL156:
 455:Core/Src/user_diskio_spi.c **** 		}
 1466              		.loc 1 455 40 discriminator 1 view .LVU387
 1467 0094 E4E7     		b	.L126
 1468              	.LVL157:
 1469              	.L130:
 1470              		.cfi_def_cfa_offset 0
 1471              		.cfi_restore 4
 1472              		.cfi_restore 5
 1473              		.cfi_restore 6
 1474              		.cfi_restore 14
 436:Core/Src/user_diskio_spi.c **** 	if (Stat & STA_NOINIT) return RES_NOTRDY;	/* Check drive status */
 1475              		.loc 1 436 28 discriminator 3 view .LVU388
 1476 0096 0420     		movs	r0, #4
 1477              	.LVL158:
 1478              		.loc 1 461 1 view .LVU389
 1479 0098 7047     		bx	lr
 1480              	.LVL159:
 1481              	.L131:
 1482              		.cfi_def_cfa_offset 16
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 38


 1483              		.cfi_offset 4, -16
 1484              		.cfi_offset 5, -12
 1485              		.cfi_offset 6, -8
 1486              		.cfi_offset 14, -4
 436:Core/Src/user_diskio_spi.c **** 	if (Stat & STA_NOINIT) return RES_NOTRDY;	/* Check drive status */
 1487              		.loc 1 436 28 discriminator 3 view .LVU390
 1488 009a 0420     		movs	r0, #4
 1489              	.LVL160:
 436:Core/Src/user_diskio_spi.c **** 	if (Stat & STA_NOINIT) return RES_NOTRDY;	/* Check drive status */
 1490              		.loc 1 436 28 discriminator 3 view .LVU391
 1491 009c E5E7     		b	.L123
 1492              	.LVL161:
 1493              	.L132:
 437:Core/Src/user_diskio_spi.c **** 	if (Stat & STA_PROTECT) return RES_WRPRT;	/* Check write protect */
 1494              		.loc 1 437 32 discriminator 1 view .LVU392
 1495 009e 0320     		movs	r0, #3
 1496              	.LVL162:
 437:Core/Src/user_diskio_spi.c **** 	if (Stat & STA_PROTECT) return RES_WRPRT;	/* Check write protect */
 1497              		.loc 1 437 32 discriminator 1 view .LVU393
 1498 00a0 E3E7     		b	.L123
 1499              	.LVL163:
 1500              	.L133:
 438:Core/Src/user_diskio_spi.c **** 
 1501              		.loc 1 438 33 discriminator 1 view .LVU394
 1502 00a2 0220     		movs	r0, #2
 1503              	.LVL164:
 438:Core/Src/user_diskio_spi.c **** 
 1504              		.loc 1 438 33 discriminator 1 view .LVU395
 1505 00a4 E1E7     		b	.L123
 1506              	.L143:
 1507 00a6 00BF     		.align	2
 1508              	.L142:
 1509 00a8 00000000 		.word	Stat
 1510 00ac 00000000 		.word	CardType
 1511              		.cfi_endproc
 1512              	.LFE148:
 1514              		.section	.text.USER_SPI_ioctl,"ax",%progbits
 1515              		.align	1
 1516              		.global	USER_SPI_ioctl
 1517              		.syntax unified
 1518              		.thumb
 1519              		.thumb_func
 1521              	USER_SPI_ioctl:
 1522              	.LVL165:
 1523              	.LFB149:
 462:Core/Src/user_diskio_spi.c **** #endif
 463:Core/Src/user_diskio_spi.c **** 
 464:Core/Src/user_diskio_spi.c **** 
 465:Core/Src/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 466:Core/Src/user_diskio_spi.c **** /* Miscellaneous drive controls other than data read/write               */
 467:Core/Src/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 468:Core/Src/user_diskio_spi.c **** 
 469:Core/Src/user_diskio_spi.c **** #if _USE_IOCTL
 470:Core/Src/user_diskio_spi.c **** inline DRESULT USER_SPI_ioctl (
 471:Core/Src/user_diskio_spi.c **** 	BYTE drv,		/* Physical drive number (0) */
 472:Core/Src/user_diskio_spi.c **** 	BYTE cmd,		/* Control command code */
 473:Core/Src/user_diskio_spi.c **** 	void *buff		/* Pointer to the conrtol data */
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 39


 474:Core/Src/user_diskio_spi.c **** )
 475:Core/Src/user_diskio_spi.c **** {
 1524              		.loc 1 475 1 is_stmt 1 view -0
 1525              		.cfi_startproc
 1526              		@ args = 0, pretend = 0, frame = 16
 1527              		@ frame_needed = 0, uses_anonymous_args = 0
 1528              		.loc 1 475 1 is_stmt 0 view .LVU397
 1529 0000 70B5     		push	{r4, r5, r6, lr}
 1530              		.cfi_def_cfa_offset 16
 1531              		.cfi_offset 4, -16
 1532              		.cfi_offset 5, -12
 1533              		.cfi_offset 6, -8
 1534              		.cfi_offset 14, -4
 1535 0002 84B0     		sub	sp, sp, #16
 1536              		.cfi_def_cfa_offset 32
 476:Core/Src/user_diskio_spi.c **** 	DRESULT res;
 1537              		.loc 1 476 2 is_stmt 1 view .LVU398
 477:Core/Src/user_diskio_spi.c **** 	BYTE n, csd[16];
 1538              		.loc 1 477 2 view .LVU399
 478:Core/Src/user_diskio_spi.c **** 	DWORD *dp, st, ed, csize;
 1539              		.loc 1 478 2 view .LVU400
 479:Core/Src/user_diskio_spi.c **** 
 480:Core/Src/user_diskio_spi.c **** 
 481:Core/Src/user_diskio_spi.c **** 	if (drv) return RES_PARERR;					/* Check parameter */
 1540              		.loc 1 481 2 view .LVU401
 1541              		.loc 1 481 5 is_stmt 0 view .LVU402
 1542 0004 0028     		cmp	r0, #0
 1543 0006 40F00481 		bne	.L159
 1544 000a 0D46     		mov	r5, r1
 1545 000c 1646     		mov	r6, r2
 482:Core/Src/user_diskio_spi.c **** 	if (Stat & STA_NOINIT) return RES_NOTRDY;	/* Check if drive is ready */
 1546              		.loc 1 482 2 is_stmt 1 view .LVU403
 1547              		.loc 1 482 11 is_stmt 0 view .LVU404
 1548 000e 834B     		ldr	r3, .L184
 1549 0010 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 1550              		.loc 1 482 5 view .LVU405
 1551 0012 13F0010F 		tst	r3, #1
 1552 0016 40F0FE80 		bne	.L160
 483:Core/Src/user_diskio_spi.c **** 
 484:Core/Src/user_diskio_spi.c **** 	res = RES_ERROR;
 1553              		.loc 1 484 2 is_stmt 1 view .LVU406
 1554              	.LVL166:
 485:Core/Src/user_diskio_spi.c **** 
 486:Core/Src/user_diskio_spi.c **** 	switch (cmd) {
 1555              		.loc 1 486 2 view .LVU407
 1556 001a 0429     		cmp	r1, #4
 1557 001c 00F2ED80 		bhi	.L161
 1558 0020 DFE811F0 		tbh	[pc, r1, lsl #1]
 1559              	.L148:
 1560 0024 0500     		.2byte	(.L151-.L148)/2
 1561 0026 0C00     		.2byte	(.L150-.L148)/2
 1562 0028 EB00     		.2byte	(.L161-.L148)/2
 1563 002a 5400     		.2byte	(.L149-.L148)/2
 1564 002c AF00     		.2byte	(.L147-.L148)/2
 1565              		.p2align 1
 1566              	.L151:
 487:Core/Src/user_diskio_spi.c **** 	case CTRL_SYNC :		/* Wait for end of internal write process of the drive */
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 40


 488:Core/Src/user_diskio_spi.c **** 		if (spiselect()) res = RES_OK;
 1567              		.loc 1 488 3 view .LVU408
 1568              		.loc 1 488 7 is_stmt 0 view .LVU409
 1569 002e FFF7FEFF 		bl	spiselect
 1570              	.LVL167:
 1571              		.loc 1 488 6 discriminator 1 view .LVU410
 1572 0032 0028     		cmp	r0, #0
 1573 0034 40F0E380 		bne	.L162
 484:Core/Src/user_diskio_spi.c **** 
 1574              		.loc 1 484 6 view .LVU411
 1575 0038 0124     		movs	r4, #1
 1576 003a 06E0     		b	.L146
 1577              	.LVL168:
 1578              	.L150:
 489:Core/Src/user_diskio_spi.c **** 		break;
 490:Core/Src/user_diskio_spi.c **** 
 491:Core/Src/user_diskio_spi.c **** 	case GET_SECTOR_COUNT :	/* Get drive capacity in unit of sector (DWORD) */
 492:Core/Src/user_diskio_spi.c **** 		if ((send_cmd(CMD9, 0) == 0) && rcvr_datablock(csd, 16)) {
 1579              		.loc 1 492 3 is_stmt 1 view .LVU412
 1580              		.loc 1 492 8 is_stmt 0 view .LVU413
 1581 003c 0021     		movs	r1, #0
 1582              	.LVL169:
 1583              		.loc 1 492 8 view .LVU414
 1584 003e 0920     		movs	r0, #9
 1585              	.LVL170:
 1586              		.loc 1 492 8 view .LVU415
 1587 0040 FFF7FEFF 		bl	send_cmd
 1588              	.LVL171:
 1589              		.loc 1 492 6 discriminator 1 view .LVU416
 1590 0044 0446     		mov	r4, r0
 1591 0046 28B1     		cbz	r0, .L176
 484:Core/Src/user_diskio_spi.c **** 
 1592              		.loc 1 484 6 view .LVU417
 1593 0048 2C46     		mov	r4, r5
 1594              	.LVL172:
 1595              	.L146:
 493:Core/Src/user_diskio_spi.c **** 			if ((csd[0] >> 6) == 1) {	/* SDC ver 2.00 */
 494:Core/Src/user_diskio_spi.c **** 				csize = csd[9] + ((WORD)csd[8] << 8) + ((DWORD)(csd[7] & 63) << 16) + 1;
 495:Core/Src/user_diskio_spi.c **** 				*(DWORD*)buff = csize << 10;
 496:Core/Src/user_diskio_spi.c **** 			} else {					/* SDC ver 1.XX or MMC ver 3 */
 497:Core/Src/user_diskio_spi.c **** 				n = (csd[5] & 15) + ((csd[10] & 128) >> 7) + ((csd[9] & 3) << 1) + 2;
 498:Core/Src/user_diskio_spi.c **** 				csize = (csd[8] >> 6) + ((WORD)csd[7] << 2) + ((WORD)(csd[6] & 3) << 10) + 1;
 499:Core/Src/user_diskio_spi.c **** 				*(DWORD*)buff = csize << (n - 9);
 500:Core/Src/user_diskio_spi.c **** 			}
 501:Core/Src/user_diskio_spi.c **** 			res = RES_OK;
 502:Core/Src/user_diskio_spi.c **** 		}
 503:Core/Src/user_diskio_spi.c **** 		break;
 504:Core/Src/user_diskio_spi.c **** 
 505:Core/Src/user_diskio_spi.c **** 	case GET_BLOCK_SIZE :	/* Get erase block size in unit of sector (DWORD) */
 506:Core/Src/user_diskio_spi.c **** 		if (CardType & CT_SD2) {	/* SDC ver 2.00 */
 507:Core/Src/user_diskio_spi.c **** 			if (send_cmd(ACMD13, 0) == 0) {	/* Read SD status */
 508:Core/Src/user_diskio_spi.c **** 				xchg_spi(0xFF);
 509:Core/Src/user_diskio_spi.c **** 				if (rcvr_datablock(csd, 16)) {				/* Read partial block */
 510:Core/Src/user_diskio_spi.c **** 					for (n = 64 - 16; n; n--) xchg_spi(0xFF);	/* Purge trailing data */
 511:Core/Src/user_diskio_spi.c **** 					*(DWORD*)buff = 16UL << (csd[10] >> 4);
 512:Core/Src/user_diskio_spi.c **** 					res = RES_OK;
 513:Core/Src/user_diskio_spi.c **** 				}
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 41


 514:Core/Src/user_diskio_spi.c **** 			}
 515:Core/Src/user_diskio_spi.c **** 		} else {					/* SDC ver 1.XX or MMC */
 516:Core/Src/user_diskio_spi.c **** 			if ((send_cmd(CMD9, 0) == 0) && rcvr_datablock(csd, 16)) {	/* Read CSD */
 517:Core/Src/user_diskio_spi.c **** 				if (CardType & CT_SD1) {	/* SDC ver 1.XX */
 518:Core/Src/user_diskio_spi.c **** 					*(DWORD*)buff = (((csd[10] & 63) << 1) + ((WORD)(csd[11] & 128) >> 7) + 1) << ((csd[13] >> 6) 
 519:Core/Src/user_diskio_spi.c **** 				} else {					/* MMC */
 520:Core/Src/user_diskio_spi.c **** 					*(DWORD*)buff = ((WORD)((csd[10] & 124) >> 2) + 1) * (((csd[11] & 3) << 3) + ((csd[11] & 224) 
 521:Core/Src/user_diskio_spi.c **** 				}
 522:Core/Src/user_diskio_spi.c **** 				res = RES_OK;
 523:Core/Src/user_diskio_spi.c **** 			}
 524:Core/Src/user_diskio_spi.c **** 		}
 525:Core/Src/user_diskio_spi.c **** 		break;
 526:Core/Src/user_diskio_spi.c **** 
 527:Core/Src/user_diskio_spi.c **** 	case CTRL_TRIM :	/* Erase a block of sectors (used when _USE_ERASE == 1) */
 528:Core/Src/user_diskio_spi.c **** 		if (!(CardType & CT_SDC)) break;				/* Check if the card is SDC */
 529:Core/Src/user_diskio_spi.c **** 		if (USER_SPI_ioctl(drv, MMC_GET_CSD, csd)) break;	/* Get CSD */
 530:Core/Src/user_diskio_spi.c **** 		if (!(csd[0] >> 6) && !(csd[10] & 0x40)) break;	/* Check if sector erase can be applied to the ca
 531:Core/Src/user_diskio_spi.c **** 		dp = buff; st = dp[0]; ed = dp[1];				/* Load sector block */
 532:Core/Src/user_diskio_spi.c **** 		if (!(CardType & CT_BLOCK)) {
 533:Core/Src/user_diskio_spi.c **** 			st *= 512; ed *= 512;
 534:Core/Src/user_diskio_spi.c **** 		}
 535:Core/Src/user_diskio_spi.c **** 		if (send_cmd(CMD32, st) == 0 && send_cmd(CMD33, ed) == 0 && send_cmd(CMD38, 0) == 0 && wait_ready
 536:Core/Src/user_diskio_spi.c **** 			res = RES_OK;	/* FatFs does not check result of this command */
 537:Core/Src/user_diskio_spi.c **** 		}
 538:Core/Src/user_diskio_spi.c **** 		break;
 539:Core/Src/user_diskio_spi.c **** 
 540:Core/Src/user_diskio_spi.c **** 	default:
 541:Core/Src/user_diskio_spi.c **** 		res = RES_PARERR;
 542:Core/Src/user_diskio_spi.c **** 	}
 543:Core/Src/user_diskio_spi.c **** 
 544:Core/Src/user_diskio_spi.c **** 	despiselect();
 1596              		.loc 1 544 2 is_stmt 1 view .LVU418
 1597 004a FFF7FEFF 		bl	despiselect
 1598              	.LVL173:
 545:Core/Src/user_diskio_spi.c **** 
 546:Core/Src/user_diskio_spi.c **** 	return res;
 1599              		.loc 1 546 2 view .LVU419
 1600              	.L145:
 547:Core/Src/user_diskio_spi.c **** }
 1601              		.loc 1 547 1 is_stmt 0 view .LVU420
 1602 004e 2046     		mov	r0, r4
 1603 0050 04B0     		add	sp, sp, #16
 1604              		.cfi_remember_state
 1605              		.cfi_def_cfa_offset 16
 1606              		@ sp needed
 1607 0052 70BD     		pop	{r4, r5, r6, pc}
 1608              	.LVL174:
 1609              	.L176:
 1610              		.cfi_restore_state
 492:Core/Src/user_diskio_spi.c **** 			if ((csd[0] >> 6) == 1) {	/* SDC ver 2.00 */
 1611              		.loc 1 492 35 discriminator 1 view .LVU421
 1612 0054 1021     		movs	r1, #16
 1613 0056 6846     		mov	r0, sp
 1614 0058 FFF7FEFF 		bl	rcvr_datablock
 1615              	.LVL175:
 492:Core/Src/user_diskio_spi.c **** 			if ((csd[0] >> 6) == 1) {	/* SDC ver 2.00 */
 1616              		.loc 1 492 32 discriminator 1 view .LVU422
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 42


 1617 005c 0028     		cmp	r0, #0
 1618 005e 00F0D080 		beq	.L164
 493:Core/Src/user_diskio_spi.c **** 				csize = csd[9] + ((WORD)csd[8] << 8) + ((DWORD)(csd[7] & 63) << 16) + 1;
 1619              		.loc 1 493 4 is_stmt 1 view .LVU423
 493:Core/Src/user_diskio_spi.c **** 				csize = csd[9] + ((WORD)csd[8] << 8) + ((DWORD)(csd[7] & 63) << 16) + 1;
 1620              		.loc 1 493 12 is_stmt 0 view .LVU424
 1621 0062 9DF80030 		ldrb	r3, [sp]	@ zero_extendqisi2
 493:Core/Src/user_diskio_spi.c **** 				csize = csd[9] + ((WORD)csd[8] << 8) + ((DWORD)(csd[7] & 63) << 16) + 1;
 1622              		.loc 1 493 22 view .LVU425
 1623 0066 9B09     		lsrs	r3, r3, #6
 493:Core/Src/user_diskio_spi.c **** 				csize = csd[9] + ((WORD)csd[8] << 8) + ((DWORD)(csd[7] & 63) << 16) + 1;
 1624              		.loc 1 493 7 view .LVU426
 1625 0068 012B     		cmp	r3, #1
 1626 006a 1FD0     		beq	.L177
 497:Core/Src/user_diskio_spi.c **** 				csize = (csd[8] >> 6) + ((WORD)csd[7] << 2) + ((WORD)(csd[6] & 3) << 10) + 1;
 1627              		.loc 1 497 5 is_stmt 1 view .LVU427
 497:Core/Src/user_diskio_spi.c **** 				csize = (csd[8] >> 6) + ((WORD)csd[7] << 2) + ((WORD)(csd[6] & 3) << 10) + 1;
 1628              		.loc 1 497 13 is_stmt 0 view .LVU428
 1629 006c 9DF80520 		ldrb	r2, [sp, #5]	@ zero_extendqisi2
 497:Core/Src/user_diskio_spi.c **** 				csize = (csd[8] >> 6) + ((WORD)csd[7] << 2) + ((WORD)(csd[6] & 3) << 10) + 1;
 1630              		.loc 1 497 17 view .LVU429
 1631 0070 02F00F02 		and	r2, r2, #15
 497:Core/Src/user_diskio_spi.c **** 				csize = (csd[8] >> 6) + ((WORD)csd[7] << 2) + ((WORD)(csd[6] & 3) << 10) + 1;
 1632              		.loc 1 497 30 view .LVU430
 1633 0074 9DF80A30 		ldrb	r3, [sp, #10]	@ zero_extendqisi2
 497:Core/Src/user_diskio_spi.c **** 				csize = (csd[8] >> 6) + ((WORD)csd[7] << 2) + ((WORD)(csd[6] & 3) << 10) + 1;
 1634              		.loc 1 497 23 view .LVU431
 1635 0078 02EBD312 		add	r2, r2, r3, lsr #7
 497:Core/Src/user_diskio_spi.c **** 				csize = (csd[8] >> 6) + ((WORD)csd[7] << 2) + ((WORD)(csd[6] & 3) << 10) + 1;
 1636              		.loc 1 497 55 view .LVU432
 1637 007c 9DF80930 		ldrb	r3, [sp, #9]	@ zero_extendqisi2
 497:Core/Src/user_diskio_spi.c **** 				csize = (csd[8] >> 6) + ((WORD)csd[7] << 2) + ((WORD)(csd[6] & 3) << 10) + 1;
 1638              		.loc 1 497 64 view .LVU433
 1639 0080 5B00     		lsls	r3, r3, #1
 1640 0082 03F00603 		and	r3, r3, #6
 497:Core/Src/user_diskio_spi.c **** 				csize = (csd[8] >> 6) + ((WORD)csd[7] << 2) + ((WORD)(csd[6] & 3) << 10) + 1;
 1641              		.loc 1 497 48 view .LVU434
 1642 0086 1A44     		add	r2, r2, r3
 1643              	.LVL176:
 498:Core/Src/user_diskio_spi.c **** 				*(DWORD*)buff = csize << (n - 9);
 1644              		.loc 1 498 5 is_stmt 1 view .LVU435
 498:Core/Src/user_diskio_spi.c **** 				*(DWORD*)buff = csize << (n - 9);
 1645              		.loc 1 498 17 is_stmt 0 view .LVU436
 1646 0088 9DF80810 		ldrb	r1, [sp, #8]	@ zero_extendqisi2
 498:Core/Src/user_diskio_spi.c **** 				*(DWORD*)buff = csize << (n - 9);
 1647              		.loc 1 498 39 view .LVU437
 1648 008c 9DF80730 		ldrb	r3, [sp, #7]	@ zero_extendqisi2
 498:Core/Src/user_diskio_spi.c **** 				*(DWORD*)buff = csize << (n - 9);
 1649              		.loc 1 498 43 view .LVU438
 1650 0090 9B00     		lsls	r3, r3, #2
 498:Core/Src/user_diskio_spi.c **** 				*(DWORD*)buff = csize << (n - 9);
 1651              		.loc 1 498 27 view .LVU439
 1652 0092 03EB9113 		add	r3, r3, r1, lsr #6
 498:Core/Src/user_diskio_spi.c **** 				*(DWORD*)buff = csize << (n - 9);
 1653              		.loc 1 498 62 view .LVU440
 1654 0096 9DF80610 		ldrb	r1, [sp, #6]	@ zero_extendqisi2
 498:Core/Src/user_diskio_spi.c **** 				*(DWORD*)buff = csize << (n - 9);
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 43


 1655              		.loc 1 498 71 view .LVU441
 1656 009a 8902     		lsls	r1, r1, #10
 1657 009c 01F44061 		and	r1, r1, #3072
 498:Core/Src/user_diskio_spi.c **** 				*(DWORD*)buff = csize << (n - 9);
 1658              		.loc 1 498 49 view .LVU442
 1659 00a0 0B44     		add	r3, r3, r1
 498:Core/Src/user_diskio_spi.c **** 				*(DWORD*)buff = csize << (n - 9);
 1660              		.loc 1 498 78 view .LVU443
 1661 00a2 0133     		adds	r3, r3, #1
 1662              	.LVL177:
 499:Core/Src/user_diskio_spi.c **** 			}
 1663              		.loc 1 499 5 is_stmt 1 view .LVU444
 499:Core/Src/user_diskio_spi.c **** 			}
 1664              		.loc 1 499 33 is_stmt 0 view .LVU445
 1665 00a4 073A     		subs	r2, r2, #7
 1666              	.LVL178:
 499:Core/Src/user_diskio_spi.c **** 			}
 1667              		.loc 1 499 27 view .LVU446
 1668 00a6 9340     		lsls	r3, r3, r2
 1669              	.LVL179:
 499:Core/Src/user_diskio_spi.c **** 			}
 1670              		.loc 1 499 19 view .LVU447
 1671 00a8 3360     		str	r3, [r6]
 1672              	.LVL180:
 499:Core/Src/user_diskio_spi.c **** 			}
 1673              		.loc 1 499 19 view .LVU448
 1674 00aa CEE7     		b	.L146
 1675              	.LVL181:
 1676              	.L177:
 494:Core/Src/user_diskio_spi.c **** 				*(DWORD*)buff = csize << 10;
 1677              		.loc 1 494 5 is_stmt 1 view .LVU449
 494:Core/Src/user_diskio_spi.c **** 				*(DWORD*)buff = csize << 10;
 1678              		.loc 1 494 16 is_stmt 0 view .LVU450
 1679 00ac 9DF80930 		ldrb	r3, [sp, #9]	@ zero_extendqisi2
 494:Core/Src/user_diskio_spi.c **** 				*(DWORD*)buff = csize << 10;
 1680              		.loc 1 494 32 view .LVU451
 1681 00b0 9DF80820 		ldrb	r2, [sp, #8]	@ zero_extendqisi2
 494:Core/Src/user_diskio_spi.c **** 				*(DWORD*)buff = csize << 10;
 1682              		.loc 1 494 20 view .LVU452
 1683 00b4 03EB0223 		add	r3, r3, r2, lsl #8
 494:Core/Src/user_diskio_spi.c **** 				*(DWORD*)buff = csize << 10;
 1684              		.loc 1 494 56 view .LVU453
 1685 00b8 9DF80720 		ldrb	r2, [sp, #7]	@ zero_extendqisi2
 494:Core/Src/user_diskio_spi.c **** 				*(DWORD*)buff = csize << 10;
 1686              		.loc 1 494 66 view .LVU454
 1687 00bc 1204     		lsls	r2, r2, #16
 1688 00be 02F47C12 		and	r2, r2, #4128768
 494:Core/Src/user_diskio_spi.c **** 				*(DWORD*)buff = csize << 10;
 1689              		.loc 1 494 42 view .LVU455
 1690 00c2 1344     		add	r3, r3, r2
 494:Core/Src/user_diskio_spi.c **** 				*(DWORD*)buff = csize << 10;
 1691              		.loc 1 494 11 view .LVU456
 1692 00c4 0133     		adds	r3, r3, #1
 1693              	.LVL182:
 495:Core/Src/user_diskio_spi.c **** 			} else {					/* SDC ver 1.XX or MMC ver 3 */
 1694              		.loc 1 495 5 is_stmt 1 view .LVU457
 495:Core/Src/user_diskio_spi.c **** 			} else {					/* SDC ver 1.XX or MMC ver 3 */
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 44


 1695              		.loc 1 495 27 is_stmt 0 view .LVU458
 1696 00c6 9B02     		lsls	r3, r3, #10
 1697              	.LVL183:
 495:Core/Src/user_diskio_spi.c **** 			} else {					/* SDC ver 1.XX or MMC ver 3 */
 1698              		.loc 1 495 19 view .LVU459
 1699 00c8 3360     		str	r3, [r6]
 1700              	.LVL184:
 495:Core/Src/user_diskio_spi.c **** 			} else {					/* SDC ver 1.XX or MMC ver 3 */
 1701              		.loc 1 495 19 view .LVU460
 1702 00ca BEE7     		b	.L146
 1703              	.LVL185:
 1704              	.L149:
 506:Core/Src/user_diskio_spi.c **** 			if (send_cmd(ACMD13, 0) == 0) {	/* Read SD status */
 1705              		.loc 1 506 3 is_stmt 1 view .LVU461
 506:Core/Src/user_diskio_spi.c **** 			if (send_cmd(ACMD13, 0) == 0) {	/* Read SD status */
 1706              		.loc 1 506 16 is_stmt 0 view .LVU462
 1707 00cc 544B     		ldr	r3, .L184+4
 1708 00ce 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 506:Core/Src/user_diskio_spi.c **** 			if (send_cmd(ACMD13, 0) == 0) {	/* Read SD status */
 1709              		.loc 1 506 6 view .LVU463
 1710 00d0 13F0040F 		tst	r3, #4
 1711 00d4 20D0     		beq	.L153
 507:Core/Src/user_diskio_spi.c **** 				xchg_spi(0xFF);
 1712              		.loc 1 507 4 is_stmt 1 view .LVU464
 507:Core/Src/user_diskio_spi.c **** 				xchg_spi(0xFF);
 1713              		.loc 1 507 8 is_stmt 0 view .LVU465
 1714 00d6 0021     		movs	r1, #0
 1715              	.LVL186:
 507:Core/Src/user_diskio_spi.c **** 				xchg_spi(0xFF);
 1716              		.loc 1 507 8 view .LVU466
 1717 00d8 8D20     		movs	r0, #141
 1718              	.LVL187:
 507:Core/Src/user_diskio_spi.c **** 				xchg_spi(0xFF);
 1719              		.loc 1 507 8 view .LVU467
 1720 00da FFF7FEFF 		bl	send_cmd
 1721              	.LVL188:
 507:Core/Src/user_diskio_spi.c **** 				xchg_spi(0xFF);
 1722              		.loc 1 507 7 discriminator 1 view .LVU468
 1723 00de 08B1     		cbz	r0, .L178
 484:Core/Src/user_diskio_spi.c **** 
 1724              		.loc 1 484 6 view .LVU469
 1725 00e0 0124     		movs	r4, #1
 1726 00e2 B2E7     		b	.L146
 1727              	.L178:
 508:Core/Src/user_diskio_spi.c **** 				if (rcvr_datablock(csd, 16)) {				/* Read partial block */
 1728              		.loc 1 508 5 is_stmt 1 view .LVU470
 1729 00e4 FF20     		movs	r0, #255
 1730 00e6 FFF7FEFF 		bl	xchg_spi
 1731              	.LVL189:
 509:Core/Src/user_diskio_spi.c **** 					for (n = 64 - 16; n; n--) xchg_spi(0xFF);	/* Purge trailing data */
 1732              		.loc 1 509 5 view .LVU471
 509:Core/Src/user_diskio_spi.c **** 					for (n = 64 - 16; n; n--) xchg_spi(0xFF);	/* Purge trailing data */
 1733              		.loc 1 509 9 is_stmt 0 view .LVU472
 1734 00ea 1021     		movs	r1, #16
 1735 00ec 6846     		mov	r0, sp
 1736 00ee FFF7FEFF 		bl	rcvr_datablock
 1737              	.LVL190:
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 45


 509:Core/Src/user_diskio_spi.c **** 					for (n = 64 - 16; n; n--) xchg_spi(0xFF);	/* Purge trailing data */
 1738              		.loc 1 509 8 discriminator 1 view .LVU473
 1739 00f2 78B9     		cbnz	r0, .L166
 484:Core/Src/user_diskio_spi.c **** 
 1740              		.loc 1 484 6 view .LVU474
 1741 00f4 0124     		movs	r4, #1
 1742 00f6 A8E7     		b	.L146
 1743              	.LVL191:
 1744              	.L155:
 510:Core/Src/user_diskio_spi.c **** 					*(DWORD*)buff = 16UL << (csd[10] >> 4);
 1745              		.loc 1 510 32 is_stmt 1 discriminator 3 view .LVU475
 1746 00f8 FF20     		movs	r0, #255
 1747 00fa FFF7FEFF 		bl	xchg_spi
 1748              	.LVL192:
 510:Core/Src/user_diskio_spi.c **** 					*(DWORD*)buff = 16UL << (csd[10] >> 4);
 1749              		.loc 1 510 28 discriminator 3 view .LVU476
 1750 00fe 013C     		subs	r4, r4, #1
 1751              	.LVL193:
 510:Core/Src/user_diskio_spi.c **** 					*(DWORD*)buff = 16UL << (csd[10] >> 4);
 1752              		.loc 1 510 28 is_stmt 0 discriminator 3 view .LVU477
 1753 0100 E4B2     		uxtb	r4, r4
 1754              	.LVL194:
 1755              	.L154:
 510:Core/Src/user_diskio_spi.c **** 					*(DWORD*)buff = 16UL << (csd[10] >> 4);
 1756              		.loc 1 510 24 is_stmt 1 discriminator 2 view .LVU478
 1757 0102 002C     		cmp	r4, #0
 1758 0104 F8D1     		bne	.L155
 511:Core/Src/user_diskio_spi.c **** 					res = RES_OK;
 1759              		.loc 1 511 6 view .LVU479
 511:Core/Src/user_diskio_spi.c **** 					res = RES_OK;
 1760              		.loc 1 511 34 is_stmt 0 view .LVU480
 1761 0106 9DF80A20 		ldrb	r2, [sp, #10]	@ zero_extendqisi2
 511:Core/Src/user_diskio_spi.c **** 					res = RES_OK;
 1762              		.loc 1 511 39 view .LVU481
 1763 010a 1209     		lsrs	r2, r2, #4
 511:Core/Src/user_diskio_spi.c **** 					res = RES_OK;
 1764              		.loc 1 511 27 view .LVU482
 1765 010c 1023     		movs	r3, #16
 1766 010e 9340     		lsls	r3, r3, r2
 511:Core/Src/user_diskio_spi.c **** 					res = RES_OK;
 1767              		.loc 1 511 20 view .LVU483
 1768 0110 3360     		str	r3, [r6]
 512:Core/Src/user_diskio_spi.c **** 				}
 1769              		.loc 1 512 6 is_stmt 1 view .LVU484
 1770              	.LVL195:
 512:Core/Src/user_diskio_spi.c **** 				}
 1771              		.loc 1 512 6 is_stmt 0 view .LVU485
 1772 0112 9AE7     		b	.L146
 1773              	.LVL196:
 1774              	.L166:
 510:Core/Src/user_diskio_spi.c **** 					*(DWORD*)buff = 16UL << (csd[10] >> 4);
 1775              		.loc 1 510 13 view .LVU486
 1776 0114 3024     		movs	r4, #48
 1777 0116 F4E7     		b	.L154
 1778              	.LVL197:
 1779              	.L153:
 516:Core/Src/user_diskio_spi.c **** 				if (CardType & CT_SD1) {	/* SDC ver 1.XX */
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 46


 1780              		.loc 1 516 4 is_stmt 1 view .LVU487
 516:Core/Src/user_diskio_spi.c **** 				if (CardType & CT_SD1) {	/* SDC ver 1.XX */
 1781              		.loc 1 516 9 is_stmt 0 view .LVU488
 1782 0118 0021     		movs	r1, #0
 1783              	.LVL198:
 516:Core/Src/user_diskio_spi.c **** 				if (CardType & CT_SD1) {	/* SDC ver 1.XX */
 1784              		.loc 1 516 9 view .LVU489
 1785 011a 0920     		movs	r0, #9
 1786              	.LVL199:
 516:Core/Src/user_diskio_spi.c **** 				if (CardType & CT_SD1) {	/* SDC ver 1.XX */
 1787              		.loc 1 516 9 view .LVU490
 1788 011c FFF7FEFF 		bl	send_cmd
 1789              	.LVL200:
 516:Core/Src/user_diskio_spi.c **** 				if (CardType & CT_SD1) {	/* SDC ver 1.XX */
 1790              		.loc 1 516 7 discriminator 1 view .LVU491
 1791 0120 0546     		mov	r5, r0
 1792              	.LVL201:
 516:Core/Src/user_diskio_spi.c **** 				if (CardType & CT_SD1) {	/* SDC ver 1.XX */
 1793              		.loc 1 516 7 discriminator 1 view .LVU492
 1794 0122 08B1     		cbz	r0, .L179
 484:Core/Src/user_diskio_spi.c **** 
 1795              		.loc 1 484 6 view .LVU493
 1796 0124 0124     		movs	r4, #1
 1797 0126 90E7     		b	.L146
 1798              	.L179:
 516:Core/Src/user_diskio_spi.c **** 				if (CardType & CT_SD1) {	/* SDC ver 1.XX */
 1799              		.loc 1 516 36 discriminator 1 view .LVU494
 1800 0128 1021     		movs	r1, #16
 1801 012a 6846     		mov	r0, sp
 1802 012c FFF7FEFF 		bl	rcvr_datablock
 1803              	.LVL202:
 516:Core/Src/user_diskio_spi.c **** 				if (CardType & CT_SD1) {	/* SDC ver 1.XX */
 1804              		.loc 1 516 33 discriminator 1 view .LVU495
 1805 0130 0028     		cmp	r0, #0
 1806 0132 68D0     		beq	.L168
 517:Core/Src/user_diskio_spi.c **** 					*(DWORD*)buff = (((csd[10] & 63) << 1) + ((WORD)(csd[11] & 128) >> 7) + 1) << ((csd[13] >> 6) 
 1807              		.loc 1 517 5 is_stmt 1 view .LVU496
 517:Core/Src/user_diskio_spi.c **** 					*(DWORD*)buff = (((csd[10] & 63) << 1) + ((WORD)(csd[11] & 128) >> 7) + 1) << ((csd[13] >> 6) 
 1808              		.loc 1 517 18 is_stmt 0 view .LVU497
 1809 0134 3A4B     		ldr	r3, .L184+4
 1810 0136 1C78     		ldrb	r4, [r3]	@ zero_extendqisi2
 517:Core/Src/user_diskio_spi.c **** 					*(DWORD*)buff = (((csd[10] & 63) << 1) + ((WORD)(csd[11] & 128) >> 7) + 1) << ((csd[13] >> 6) 
 1811              		.loc 1 517 8 view .LVU498
 1812 0138 14F00204 		ands	r4, r4, #2
 1813 013c 11D0     		beq	.L156
 518:Core/Src/user_diskio_spi.c **** 				} else {					/* MMC */
 1814              		.loc 1 518 6 is_stmt 1 view .LVU499
 518:Core/Src/user_diskio_spi.c **** 				} else {					/* MMC */
 1815              		.loc 1 518 28 is_stmt 0 view .LVU500
 1816 013e 9DF80A30 		ldrb	r3, [sp, #10]	@ zero_extendqisi2
 518:Core/Src/user_diskio_spi.c **** 				} else {					/* MMC */
 1817              		.loc 1 518 39 view .LVU501
 1818 0142 5B00     		lsls	r3, r3, #1
 1819 0144 03F07E03 		and	r3, r3, #126
 518:Core/Src/user_diskio_spi.c **** 				} else {					/* MMC */
 1820              		.loc 1 518 58 view .LVU502
 1821 0148 9DF80B20 		ldrb	r2, [sp, #11]	@ zero_extendqisi2
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 47


 518:Core/Src/user_diskio_spi.c **** 				} else {					/* MMC */
 1822              		.loc 1 518 45 view .LVU503
 1823 014c 03EBD213 		add	r3, r3, r2, lsr #7
 518:Core/Src/user_diskio_spi.c **** 				} else {					/* MMC */
 1824              		.loc 1 518 76 view .LVU504
 1825 0150 0133     		adds	r3, r3, #1
 518:Core/Src/user_diskio_spi.c **** 				} else {					/* MMC */
 1826              		.loc 1 518 89 view .LVU505
 1827 0152 9DF80D20 		ldrb	r2, [sp, #13]	@ zero_extendqisi2
 518:Core/Src/user_diskio_spi.c **** 				} else {					/* MMC */
 1828              		.loc 1 518 94 view .LVU506
 1829 0156 9209     		lsrs	r2, r2, #6
 518:Core/Src/user_diskio_spi.c **** 				} else {					/* MMC */
 1830              		.loc 1 518 100 view .LVU507
 1831 0158 013A     		subs	r2, r2, #1
 518:Core/Src/user_diskio_spi.c **** 				} else {					/* MMC */
 1832              		.loc 1 518 81 view .LVU508
 1833 015a 9340     		lsls	r3, r3, r2
 518:Core/Src/user_diskio_spi.c **** 				} else {					/* MMC */
 1834              		.loc 1 518 20 view .LVU509
 1835 015c 3360     		str	r3, [r6]
 522:Core/Src/user_diskio_spi.c **** 			}
 1836              		.loc 1 522 9 view .LVU510
 1837 015e 2C46     		mov	r4, r5
 1838 0160 73E7     		b	.L146
 1839              	.L156:
 520:Core/Src/user_diskio_spi.c **** 				}
 1840              		.loc 1 520 6 is_stmt 1 view .LVU511
 520:Core/Src/user_diskio_spi.c **** 				}
 1841              		.loc 1 520 34 is_stmt 0 view .LVU512
 1842 0162 9DF80A20 		ldrb	r2, [sp, #10]	@ zero_extendqisi2
 520:Core/Src/user_diskio_spi.c **** 				}
 1843              		.loc 1 520 23 view .LVU513
 1844 0166 C2F38402 		ubfx	r2, r2, #2, #5
 520:Core/Src/user_diskio_spi.c **** 				}
 1845              		.loc 1 520 65 view .LVU514
 1846 016a 9DF80B10 		ldrb	r1, [sp, #11]	@ zero_extendqisi2
 520:Core/Src/user_diskio_spi.c **** 				}
 1847              		.loc 1 520 75 view .LVU515
 1848 016e CB00     		lsls	r3, r1, #3
 1849 0170 03F01803 		and	r3, r3, #24
 520:Core/Src/user_diskio_spi.c **** 				}
 1850              		.loc 1 520 81 view .LVU516
 1851 0174 03EB5113 		add	r3, r3, r1, lsr #5
 520:Core/Src/user_diskio_spi.c **** 				}
 1852              		.loc 1 520 106 view .LVU517
 1853 0178 0133     		adds	r3, r3, #1
 520:Core/Src/user_diskio_spi.c **** 				}
 1854              		.loc 1 520 57 view .LVU518
 1855 017a 02FB0333 		mla	r3, r2, r3, r3
 520:Core/Src/user_diskio_spi.c **** 				}
 1856              		.loc 1 520 20 view .LVU519
 1857 017e 3360     		str	r3, [r6]
 1858 0180 63E7     		b	.L146
 1859              	.LVL203:
 1860              	.L147:
 528:Core/Src/user_diskio_spi.c **** 		if (USER_SPI_ioctl(drv, MMC_GET_CSD, csd)) break;	/* Get CSD */
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 48


 1861              		.loc 1 528 3 is_stmt 1 view .LVU520
 528:Core/Src/user_diskio_spi.c **** 		if (USER_SPI_ioctl(drv, MMC_GET_CSD, csd)) break;	/* Get CSD */
 1862              		.loc 1 528 18 is_stmt 0 view .LVU521
 1863 0182 274B     		ldr	r3, .L184+4
 1864 0184 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 528:Core/Src/user_diskio_spi.c **** 		if (USER_SPI_ioctl(drv, MMC_GET_CSD, csd)) break;	/* Get CSD */
 1865              		.loc 1 528 6 view .LVU522
 1866 0186 13F0060F 		tst	r3, #6
 1867 018a 01D1     		bne	.L180
 484:Core/Src/user_diskio_spi.c **** 
 1868              		.loc 1 484 6 view .LVU523
 1869 018c 0124     		movs	r4, #1
 1870 018e 5CE7     		b	.L146
 1871              	.L180:
 529:Core/Src/user_diskio_spi.c **** 		if (!(csd[0] >> 6) && !(csd[10] & 0x40)) break;	/* Check if sector erase can be applied to the ca
 1872              		.loc 1 529 3 is_stmt 1 view .LVU524
 529:Core/Src/user_diskio_spi.c **** 		if (!(csd[0] >> 6) && !(csd[10] & 0x40)) break;	/* Check if sector erase can be applied to the ca
 1873              		.loc 1 529 7 is_stmt 0 view .LVU525
 1874 0190 6A46     		mov	r2, sp
 1875              	.LVL204:
 529:Core/Src/user_diskio_spi.c **** 		if (!(csd[0] >> 6) && !(csd[10] & 0x40)) break;	/* Check if sector erase can be applied to the ca
 1876              		.loc 1 529 7 view .LVU526
 1877 0192 0B21     		movs	r1, #11
 1878              	.LVL205:
 529:Core/Src/user_diskio_spi.c **** 		if (!(csd[0] >> 6) && !(csd[10] & 0x40)) break;	/* Check if sector erase can be applied to the ca
 1879              		.loc 1 529 7 view .LVU527
 1880 0194 FFF7FEFF 		bl	USER_SPI_ioctl
 1881              	.LVL206:
 529:Core/Src/user_diskio_spi.c **** 		if (!(csd[0] >> 6) && !(csd[10] & 0x40)) break;	/* Check if sector erase can be applied to the ca
 1882              		.loc 1 529 6 discriminator 1 view .LVU528
 1883 0198 B8BB     		cbnz	r0, .L170
 530:Core/Src/user_diskio_spi.c **** 		dp = buff; st = dp[0]; ed = dp[1];				/* Load sector block */
 1884              		.loc 1 530 3 is_stmt 1 view .LVU529
 530:Core/Src/user_diskio_spi.c **** 		dp = buff; st = dp[0]; ed = dp[1];				/* Load sector block */
 1885              		.loc 1 530 12 is_stmt 0 view .LVU530
 1886 019a 9DF80030 		ldrb	r3, [sp]	@ zero_extendqisi2
 530:Core/Src/user_diskio_spi.c **** 		dp = buff; st = dp[0]; ed = dp[1];				/* Load sector block */
 1887              		.loc 1 530 6 view .LVU531
 1888 019e 9B09     		lsrs	r3, r3, #6
 1889 01a0 04D1     		bne	.L157
 530:Core/Src/user_diskio_spi.c **** 		dp = buff; st = dp[0]; ed = dp[1];				/* Load sector block */
 1890              		.loc 1 530 30 discriminator 1 view .LVU532
 1891 01a2 9DF80A30 		ldrb	r3, [sp, #10]	@ zero_extendqisi2
 530:Core/Src/user_diskio_spi.c **** 		dp = buff; st = dp[0]; ed = dp[1];				/* Load sector block */
 1892              		.loc 1 530 22 discriminator 1 view .LVU533
 1893 01a6 13F0400F 		tst	r3, #64
 1894 01aa 30D0     		beq	.L171
 1895              	.L157:
 531:Core/Src/user_diskio_spi.c **** 		if (!(CardType & CT_BLOCK)) {
 1896              		.loc 1 531 3 is_stmt 1 view .LVU534
 1897              	.LVL207:
 531:Core/Src/user_diskio_spi.c **** 		if (!(CardType & CT_BLOCK)) {
 1898              		.loc 1 531 14 view .LVU535
 531:Core/Src/user_diskio_spi.c **** 		if (!(CardType & CT_BLOCK)) {
 1899              		.loc 1 531 17 is_stmt 0 view .LVU536
 1900 01ac 3168     		ldr	r1, [r6]
 1901              	.LVL208:
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 49


 531:Core/Src/user_diskio_spi.c **** 		if (!(CardType & CT_BLOCK)) {
 1902              		.loc 1 531 26 is_stmt 1 view .LVU537
 531:Core/Src/user_diskio_spi.c **** 		if (!(CardType & CT_BLOCK)) {
 1903              		.loc 1 531 29 is_stmt 0 view .LVU538
 1904 01ae 7468     		ldr	r4, [r6, #4]
 1905              	.LVL209:
 532:Core/Src/user_diskio_spi.c **** 			st *= 512; ed *= 512;
 1906              		.loc 1 532 3 is_stmt 1 view .LVU539
 532:Core/Src/user_diskio_spi.c **** 			st *= 512; ed *= 512;
 1907              		.loc 1 532 18 is_stmt 0 view .LVU540
 1908 01b0 1B4B     		ldr	r3, .L184+4
 1909 01b2 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 532:Core/Src/user_diskio_spi.c **** 			st *= 512; ed *= 512;
 1910              		.loc 1 532 6 view .LVU541
 1911 01b4 13F0080F 		tst	r3, #8
 1912 01b8 01D1     		bne	.L158
 533:Core/Src/user_diskio_spi.c **** 		}
 1913              		.loc 1 533 4 is_stmt 1 view .LVU542
 533:Core/Src/user_diskio_spi.c **** 		}
 1914              		.loc 1 533 7 is_stmt 0 view .LVU543
 1915 01ba 4902     		lsls	r1, r1, #9
 1916              	.LVL210:
 533:Core/Src/user_diskio_spi.c **** 		}
 1917              		.loc 1 533 15 is_stmt 1 view .LVU544
 533:Core/Src/user_diskio_spi.c **** 		}
 1918              		.loc 1 533 18 is_stmt 0 view .LVU545
 1919 01bc 6402     		lsls	r4, r4, #9
 1920              	.LVL211:
 1921              	.L158:
 535:Core/Src/user_diskio_spi.c **** 			res = RES_OK;	/* FatFs does not check result of this command */
 1922              		.loc 1 535 3 is_stmt 1 view .LVU546
 535:Core/Src/user_diskio_spi.c **** 			res = RES_OK;	/* FatFs does not check result of this command */
 1923              		.loc 1 535 7 is_stmt 0 view .LVU547
 1924 01be 2020     		movs	r0, #32
 1925 01c0 FFF7FEFF 		bl	send_cmd
 1926              	.LVL212:
 535:Core/Src/user_diskio_spi.c **** 			res = RES_OK;	/* FatFs does not check result of this command */
 1927              		.loc 1 535 6 discriminator 1 view .LVU548
 1928 01c4 08B1     		cbz	r0, .L181
 484:Core/Src/user_diskio_spi.c **** 
 1929              		.loc 1 484 6 view .LVU549
 1930 01c6 0124     		movs	r4, #1
 1931              	.LVL213:
 484:Core/Src/user_diskio_spi.c **** 
 1932              		.loc 1 484 6 view .LVU550
 1933 01c8 3FE7     		b	.L146
 1934              	.LVL214:
 1935              	.L181:
 535:Core/Src/user_diskio_spi.c **** 			res = RES_OK;	/* FatFs does not check result of this command */
 1936              		.loc 1 535 35 discriminator 1 view .LVU551
 1937 01ca 2146     		mov	r1, r4
 1938 01cc 2120     		movs	r0, #33
 1939 01ce FFF7FEFF 		bl	send_cmd
 1940              	.LVL215:
 535:Core/Src/user_diskio_spi.c **** 			res = RES_OK;	/* FatFs does not check result of this command */
 1941              		.loc 1 535 32 discriminator 1 view .LVU552
 1942 01d2 08B1     		cbz	r0, .L182
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 50


 484:Core/Src/user_diskio_spi.c **** 
 1943              		.loc 1 484 6 view .LVU553
 1944 01d4 0124     		movs	r4, #1
 1945              	.LVL216:
 484:Core/Src/user_diskio_spi.c **** 
 1946              		.loc 1 484 6 view .LVU554
 1947 01d6 38E7     		b	.L146
 1948              	.LVL217:
 1949              	.L182:
 535:Core/Src/user_diskio_spi.c **** 			res = RES_OK;	/* FatFs does not check result of this command */
 1950              		.loc 1 535 63 discriminator 2 view .LVU555
 1951 01d8 0021     		movs	r1, #0
 1952 01da 2620     		movs	r0, #38
 1953 01dc FFF7FEFF 		bl	send_cmd
 1954              	.LVL218:
 535:Core/Src/user_diskio_spi.c **** 			res = RES_OK;	/* FatFs does not check result of this command */
 1955              		.loc 1 535 60 discriminator 1 view .LVU556
 1956 01e0 0446     		mov	r4, r0
 1957              	.LVL219:
 535:Core/Src/user_diskio_spi.c **** 			res = RES_OK;	/* FatFs does not check result of this command */
 1958              		.loc 1 535 60 discriminator 1 view .LVU557
 1959 01e2 08B1     		cbz	r0, .L183
 484:Core/Src/user_diskio_spi.c **** 
 1960              		.loc 1 484 6 view .LVU558
 1961 01e4 0124     		movs	r4, #1
 1962 01e6 30E7     		b	.L146
 1963              	.L183:
 535:Core/Src/user_diskio_spi.c **** 			res = RES_OK;	/* FatFs does not check result of this command */
 1964              		.loc 1 535 90 discriminator 3 view .LVU559
 1965 01e8 47F23050 		movw	r0, #30000
 1966 01ec FFF7FEFF 		bl	wait_ready
 1967              	.LVL220:
 535:Core/Src/user_diskio_spi.c **** 			res = RES_OK;	/* FatFs does not check result of this command */
 1968              		.loc 1 535 87 discriminator 1 view .LVU560
 1969 01f0 0028     		cmp	r0, #0
 1970 01f2 7FF42AAF 		bne	.L146
 484:Core/Src/user_diskio_spi.c **** 
 1971              		.loc 1 484 6 view .LVU561
 1972 01f6 0124     		movs	r4, #1
 1973 01f8 27E7     		b	.L146
 1974              	.LVL221:
 1975              	.L161:
 486:Core/Src/user_diskio_spi.c **** 	case CTRL_SYNC :		/* Wait for end of internal write process of the drive */
 1976              		.loc 1 486 2 view .LVU562
 1977 01fa 0424     		movs	r4, #4
 1978 01fc 25E7     		b	.L146
 1979              	.LVL222:
 1980              	.L162:
 488:Core/Src/user_diskio_spi.c **** 		break;
 1981              		.loc 1 488 24 discriminator 1 view .LVU563
 1982 01fe 2C46     		mov	r4, r5
 1983 0200 23E7     		b	.L146
 1984              	.L164:
 484:Core/Src/user_diskio_spi.c **** 
 1985              		.loc 1 484 6 view .LVU564
 1986 0202 2C46     		mov	r4, r5
 1987 0204 21E7     		b	.L146
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 51


 1988              	.LVL223:
 1989              	.L168:
 484:Core/Src/user_diskio_spi.c **** 
 1990              		.loc 1 484 6 view .LVU565
 1991 0206 0124     		movs	r4, #1
 1992 0208 1FE7     		b	.L146
 1993              	.L170:
 1994 020a 0124     		movs	r4, #1
 1995 020c 1DE7     		b	.L146
 1996              	.L171:
 1997 020e 0124     		movs	r4, #1
 1998 0210 1BE7     		b	.L146
 1999              	.LVL224:
 2000              	.L159:
 481:Core/Src/user_diskio_spi.c **** 	if (Stat & STA_NOINIT) return RES_NOTRDY;	/* Check if drive is ready */
 2001              		.loc 1 481 18 discriminator 1 view .LVU566
 2002 0212 0424     		movs	r4, #4
 2003 0214 1BE7     		b	.L145
 2004              	.L160:
 482:Core/Src/user_diskio_spi.c **** 
 2005              		.loc 1 482 32 discriminator 1 view .LVU567
 2006 0216 0324     		movs	r4, #3
 2007 0218 19E7     		b	.L145
 2008              	.L185:
 2009 021a 00BF     		.align	2
 2010              	.L184:
 2011 021c 00000000 		.word	Stat
 2012 0220 00000000 		.word	CardType
 2013              		.cfi_endproc
 2014              	.LFE149:
 2016              		.global	spiTimerTickDelay
 2017              		.section	.bss.spiTimerTickDelay,"aw",%nobits
 2018              		.align	2
 2021              	spiTimerTickDelay:
 2022 0000 00000000 		.space	4
 2023              		.global	spiTimerTickStart
 2024              		.section	.bss.spiTimerTickStart,"aw",%nobits
 2025              		.align	2
 2028              	spiTimerTickStart:
 2029 0000 00000000 		.space	4
 2030              		.section	.bss.CardType,"aw",%nobits
 2033              	CardType:
 2034 0000 00       		.space	1
 2035              		.section	.data.Stat,"aw"
 2038              	Stat:
 2039 0000 01       		.byte	1
 2040              		.text
 2041              	.Letext0:
 2042              		.file 2 "C:/Users/jonas/AppData/Roaming/VSCodium/User/globalStorage/bmd.stm32-for-vscode/@xpack-de
 2043              		.file 3 "C:/Users/jonas/AppData/Roaming/VSCodium/User/globalStorage/bmd.stm32-for-vscode/@xpack-de
 2044              		.file 4 "Drivers/CMSIS/Device/ST/STM32F4xx/Include/stm32f401xe.h"
 2045              		.file 5 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_def.h"
 2046              		.file 6 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_gpio.h"
 2047              		.file 7 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_dma.h"
 2048              		.file 8 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal_spi.h"
 2049              		.file 9 "Middlewares/Third_Party/FatFs/src/integer.h"
 2050              		.file 10 "Middlewares/Third_Party/FatFs/src/diskio.h"
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 52


 2051              		.file 11 "Drivers/STM32F4xx_HAL_Driver/Inc/stm32f4xx_hal.h"
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 53


DEFINED SYMBOLS
                            *ABS*:00000000 user_diskio_spi.c
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:21     .text.xchg_spi:00000000 $t
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:26     .text.xchg_spi:00000000 xchg_spi
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:62     .text.xchg_spi:00000028 $d
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:67     .text.wait_ready:00000000 $t
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:72     .text.wait_ready:00000000 wait_ready
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:131    .text.rcvr_spi_multi:00000000 $t
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:136    .text.rcvr_spi_multi:00000000 rcvr_spi_multi
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:184    .text.despiselect:00000000 $t
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:189    .text.despiselect:00000000 despiselect
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:215    .text.despiselect:00000014 $d
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:220    .text.spiselect:00000000 $t
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:225    .text.spiselect:00000000 spiselect
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:270    .text.spiselect:0000002c $d
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:275    .text.send_cmd:00000000 $t
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:280    .text.send_cmd:00000000 send_cmd
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:454    .text.xmit_spi_multi:00000000 $t
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:459    .text.xmit_spi_multi:00000000 xmit_spi_multi
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:487    .text.xmit_spi_multi:00000014 $d
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:492    .text.xmit_datablock:00000000 $t
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:497    .text.xmit_datablock:00000000 xmit_datablock
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:576    .text.SPI_Timer_On:00000000 $t
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:582    .text.SPI_Timer_On:00000000 SPI_Timer_On
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:613    .text.SPI_Timer_On:00000014 $d
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:2028   .bss.spiTimerTickStart:00000000 spiTimerTickStart
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:2021   .bss.spiTimerTickDelay:00000000 spiTimerTickDelay
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:619    .text.SPI_Timer_Status:00000000 $t
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:625    .text.SPI_Timer_Status:00000000 SPI_Timer_Status
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:655    .text.SPI_Timer_Status:0000001c $d
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:661    .text.rcvr_datablock:00000000 $t
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:666    .text.rcvr_datablock:00000000 rcvr_datablock
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:740    .text.USER_SPI_initialize:00000000 $t
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:746    .text.USER_SPI_initialize:00000000 USER_SPI_initialize
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:1084   .text.USER_SPI_initialize:00000164 $d
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:2038   .data.Stat:00000000 Stat
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:2033   .bss.CardType:00000000 CardType
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:1091   .text.USER_SPI_status:00000000 $t
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:1097   .text.USER_SPI_status:00000000 USER_SPI_status
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:1126   .text.USER_SPI_status:00000010 $d
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:1131   .text.USER_SPI_read:00000000 $t
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:1137   .text.USER_SPI_read:00000000 USER_SPI_read
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:1298   .text.USER_SPI_read:00000084 $d
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:1304   .text.USER_SPI_write:00000000 $t
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:1310   .text.USER_SPI_write:00000000 USER_SPI_write
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:1509   .text.USER_SPI_write:000000a8 $d
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:1515   .text.USER_SPI_ioctl:00000000 $t
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:1521   .text.USER_SPI_ioctl:00000000 USER_SPI_ioctl
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:1560   .text.USER_SPI_ioctl:00000024 $d
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:1565   .text.USER_SPI_ioctl:0000002e $t
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:2011   .text.USER_SPI_ioctl:0000021c $d
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:2018   .bss.spiTimerTickDelay:00000000 $d
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:2025   .bss.spiTimerTickStart:00000000 $d
C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s:2034   .bss.CardType:00000000 $d

UNDEFINED SYMBOLS
HAL_SPI_TransmitReceive
ARM GAS  C:\Users\jonas\AppData\Local\Temp\cc83hL1b.s 			page 54


hspi2
HAL_GetTick
HAL_GPIO_WritePin
HAL_SPI_Transmit
